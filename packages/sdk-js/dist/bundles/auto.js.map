{"version":3,"file":"auto.js","sources":["../../../../node_modules/js-cookie/dist/js.cookie.mjs","../../src/util.ts","../../src/feature-repository.ts","../../../../node_modules/dom-mutator/dist/dom-mutator.esm.js","../../src/mongrule.ts","../../src/GrowthBook.ts","../../src/sticky-bucket-service.ts","../../src/auto-wrapper.ts"],"sourcesContent":["/*! js-cookie v3.0.5 | MIT */\n/* eslint-disable no-var */\nfunction assign (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n    for (var key in source) {\n      target[key] = source[key];\n    }\n  }\n  return target\n}\n/* eslint-enable no-var */\n\n/* eslint-disable no-var */\nvar defaultConverter = {\n  read: function (value) {\n    if (value[0] === '\"') {\n      value = value.slice(1, -1);\n    }\n    return value.replace(/(%[\\dA-F]{2})+/gi, decodeURIComponent)\n  },\n  write: function (value) {\n    return encodeURIComponent(value).replace(\n      /%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,\n      decodeURIComponent\n    )\n  }\n};\n/* eslint-enable no-var */\n\n/* eslint-disable no-var */\n\nfunction init (converter, defaultAttributes) {\n  function set (name, value, attributes) {\n    if (typeof document === 'undefined') {\n      return\n    }\n\n    attributes = assign({}, defaultAttributes, attributes);\n\n    if (typeof attributes.expires === 'number') {\n      attributes.expires = new Date(Date.now() + attributes.expires * 864e5);\n    }\n    if (attributes.expires) {\n      attributes.expires = attributes.expires.toUTCString();\n    }\n\n    name = encodeURIComponent(name)\n      .replace(/%(2[346B]|5E|60|7C)/g, decodeURIComponent)\n      .replace(/[()]/g, escape);\n\n    var stringifiedAttributes = '';\n    for (var attributeName in attributes) {\n      if (!attributes[attributeName]) {\n        continue\n      }\n\n      stringifiedAttributes += '; ' + attributeName;\n\n      if (attributes[attributeName] === true) {\n        continue\n      }\n\n      // Considers RFC 6265 section 5.2:\n      // ...\n      // 3.  If the remaining unparsed-attributes contains a %x3B (\";\")\n      //     character:\n      // Consume the characters of the unparsed-attributes up to,\n      // not including, the first %x3B (\";\") character.\n      // ...\n      stringifiedAttributes += '=' + attributes[attributeName].split(';')[0];\n    }\n\n    return (document.cookie =\n      name + '=' + converter.write(value, name) + stringifiedAttributes)\n  }\n\n  function get (name) {\n    if (typeof document === 'undefined' || (arguments.length && !name)) {\n      return\n    }\n\n    // To prevent the for loop in the first place assign an empty array\n    // in case there are no cookies at all.\n    var cookies = document.cookie ? document.cookie.split('; ') : [];\n    var jar = {};\n    for (var i = 0; i < cookies.length; i++) {\n      var parts = cookies[i].split('=');\n      var value = parts.slice(1).join('=');\n\n      try {\n        var found = decodeURIComponent(parts[0]);\n        jar[found] = converter.read(value, found);\n\n        if (name === found) {\n          break\n        }\n      } catch (e) {}\n    }\n\n    return name ? jar[name] : jar\n  }\n\n  return Object.create(\n    {\n      set,\n      get,\n      remove: function (name, attributes) {\n        set(\n          name,\n          '',\n          assign({}, attributes, {\n            expires: -1\n          })\n        );\n      },\n      withAttributes: function (attributes) {\n        return init(this.converter, assign({}, this.attributes, attributes))\n      },\n      withConverter: function (converter) {\n        return init(assign({}, this.converter, converter), this.attributes)\n      }\n    },\n    {\n      attributes: { value: Object.freeze(defaultAttributes) },\n      converter: { value: Object.freeze(converter) }\n    }\n  )\n}\n\nvar api = init(defaultConverter, { path: '/' });\n/* eslint-enable no-var */\n\nexport { api as default };\n","import {\n  AutoExperiment,\n  AutoExperimentChangeType,\n  Polyfills,\n  UrlTarget,\n  UrlTargetType,\n  VariationRange,\n} from \"./types/growthbook\";\n\nconst polyfills: Polyfills = {\n  fetch: globalThis.fetch ? globalThis.fetch.bind(globalThis) : undefined,\n  SubtleCrypto: globalThis.crypto ? globalThis.crypto.subtle : undefined,\n  EventSource: globalThis.EventSource,\n};\nexport function getPolyfills(): Polyfills {\n  return polyfills;\n}\n\nfunction hashFnv32a(str: string): number {\n  let hval = 0x811c9dc5;\n  const l = str.length;\n\n  for (let i = 0; i < l; i++) {\n    hval ^= str.charCodeAt(i);\n    hval +=\n      (hval << 1) + (hval << 4) + (hval << 7) + (hval << 8) + (hval << 24);\n  }\n  return hval >>> 0;\n}\n\nexport function hash(\n  seed: string,\n  value: string,\n  version: number\n): number | null {\n  // New unbiased hashing algorithm\n  if (version === 2) {\n    return (hashFnv32a(hashFnv32a(seed + value) + \"\") % 10000) / 10000;\n  }\n  // Original biased hashing algorithm (keep for backwards compatibility)\n  if (version === 1) {\n    return (hashFnv32a(value + seed) % 1000) / 1000;\n  }\n\n  // Unknown hash version\n  return null;\n}\n\nexport function getEqualWeights(n: number): number[] {\n  if (n <= 0) return [];\n  return new Array(n).fill(1 / n);\n}\n\nexport function inRange(n: number, range: VariationRange): boolean {\n  return n >= range[0] && n < range[1];\n}\n\nexport function inNamespace(\n  hashValue: string,\n  namespace: [string, number, number]\n): boolean {\n  const n = hash(\"__\" + namespace[0], hashValue, 1);\n  if (n === null) return false;\n  return n >= namespace[1] && n < namespace[2];\n}\n\nexport function chooseVariation(n: number, ranges: VariationRange[]): number {\n  for (let i = 0; i < ranges.length; i++) {\n    if (inRange(n, ranges[i])) {\n      return i;\n    }\n  }\n  return -1;\n}\n\nexport function getUrlRegExp(regexString: string): RegExp | undefined {\n  try {\n    const escaped = regexString.replace(/([^\\\\])\\//g, \"$1\\\\/\");\n    return new RegExp(escaped);\n  } catch (e) {\n    console.error(e);\n    return undefined;\n  }\n}\n\nexport function isURLTargeted(url: string, targets: UrlTarget[]) {\n  if (!targets.length) return false;\n  let hasIncludeRules = false;\n  let isIncluded = false;\n\n  for (let i = 0; i < targets.length; i++) {\n    const match = _evalURLTarget(url, targets[i].type, targets[i].pattern);\n    if (targets[i].include === false) {\n      if (match) return false;\n    } else {\n      hasIncludeRules = true;\n      if (match) isIncluded = true;\n    }\n  }\n\n  return isIncluded || !hasIncludeRules;\n}\n\nfunction _evalSimpleUrlPart(\n  actual: string,\n  pattern: string,\n  isPath: boolean\n): boolean {\n  try {\n    // Escape special regex characters and change wildcard `_____` to `.*`\n    let escaped = pattern\n      .replace(/[*.+?^${}()|[\\]\\\\]/g, \"\\\\$&\")\n      .replace(/_____/g, \".*\");\n\n    if (isPath) {\n      // When matching pathname, make leading/trailing slashes optional\n      escaped = \"\\\\/?\" + escaped.replace(/(^\\/|\\/$)/g, \"\") + \"\\\\/?\";\n    }\n\n    const regex = new RegExp(\"^\" + escaped + \"$\", \"i\");\n    return regex.test(actual);\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _evalSimpleUrlTarget(actual: URL, pattern: string) {\n  try {\n    // If a protocol is missing, but a host is specified, add `https://` to the front\n    // Use \"_____\" as the wildcard since `*` is not a valid hostname in some browsers\n    const expected = new URL(\n      pattern.replace(/^([^:/?]*)\\./i, \"https://$1.\").replace(/\\*/g, \"_____\"),\n      \"https://_____\"\n    );\n\n    // Compare each part of the URL separately\n    const comps: Array<[string, string, boolean]> = [\n      [actual.host, expected.host, false],\n      [actual.pathname, expected.pathname, true],\n    ];\n    // We only want to compare hashes if it's explicitly being targeted\n    if (expected.hash) {\n      comps.push([actual.hash, expected.hash, false]);\n    }\n\n    expected.searchParams.forEach((v, k) => {\n      comps.push([actual.searchParams.get(k) || \"\", v, false]);\n    });\n\n    // If any comparisons fail, the whole thing fails\n    return !comps.some(\n      (data) => !_evalSimpleUrlPart(data[0], data[1], data[2])\n    );\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _evalURLTarget(\n  url: string,\n  type: UrlTargetType,\n  pattern: string\n): boolean {\n  try {\n    const parsed = new URL(url, \"https://_\");\n\n    if (type === \"regex\") {\n      const regex = getUrlRegExp(pattern);\n      if (!regex) return false;\n      return (\n        regex.test(parsed.href) ||\n        regex.test(parsed.href.substring(parsed.origin.length))\n      );\n    } else if (type === \"simple\") {\n      return _evalSimpleUrlTarget(parsed, pattern);\n    }\n\n    return false;\n  } catch (e) {\n    return false;\n  }\n}\n\nexport function getBucketRanges(\n  numVariations: number,\n  coverage: number | undefined,\n  weights?: number[]\n): VariationRange[] {\n  coverage = coverage === undefined ? 1 : coverage;\n\n  // Make sure coverage is within bounds\n  if (coverage < 0) {\n    if (process.env.NODE_ENV !== \"production\") {\n      console.error(\"Experiment.coverage must be greater than or equal to 0\");\n    }\n    coverage = 0;\n  } else if (coverage > 1) {\n    if (process.env.NODE_ENV !== \"production\") {\n      console.error(\"Experiment.coverage must be less than or equal to 1\");\n    }\n    coverage = 1;\n  }\n\n  // Default to equal weights if missing or invalid\n  const equal = getEqualWeights(numVariations);\n  weights = weights || equal;\n  if (weights.length !== numVariations) {\n    if (process.env.NODE_ENV !== \"production\") {\n      console.error(\n        \"Experiment.weights array must be the same length as Experiment.variations\"\n      );\n    }\n    weights = equal;\n  }\n\n  // If weights don't add up to 1 (or close to it), default to equal weights\n  const totalWeight = weights.reduce((w, sum) => sum + w, 0);\n  if (totalWeight < 0.99 || totalWeight > 1.01) {\n    if (process.env.NODE_ENV !== \"production\") {\n      console.error(\"Experiment.weights must add up to 1\");\n    }\n    weights = equal;\n  }\n\n  // Covert weights to ranges\n  let cumulative = 0;\n  return weights.map((w) => {\n    const start = cumulative;\n    cumulative += w;\n    return [start, start + (coverage as number) * w];\n  }) as VariationRange[];\n}\n\nexport function getQueryStringOverride(\n  id: string,\n  url: string,\n  numVariations: number\n) {\n  if (!url) {\n    return null;\n  }\n\n  const search = url.split(\"?\")[1];\n  if (!search) {\n    return null;\n  }\n\n  const match = search\n    .replace(/#.*/, \"\") // Get rid of anchor\n    .split(\"&\") // Split into key/value pairs\n    .map((kv) => kv.split(\"=\", 2))\n    .filter(([k]) => k === id) // Look for key that matches the experiment id\n    .map(([, v]) => parseInt(v)); // Parse the value into an integer\n\n  if (match.length > 0 && match[0] >= 0 && match[0] < numVariations)\n    return match[0];\n\n  return null;\n}\n\nexport function isIncluded(include: () => boolean) {\n  try {\n    return include();\n  } catch (e) {\n    console.error(e);\n    return false;\n  }\n}\n\nconst base64ToBuf = (b: string) =>\n  Uint8Array.from(atob(b), (c) => c.charCodeAt(0));\n\nexport async function decrypt(\n  encryptedString: string,\n  decryptionKey?: string,\n  subtle?: SubtleCrypto\n): Promise<string> {\n  decryptionKey = decryptionKey || \"\";\n  subtle =\n    subtle ||\n    (globalThis.crypto && globalThis.crypto.subtle) ||\n    polyfills.SubtleCrypto;\n  if (!subtle) {\n    throw new Error(\"No SubtleCrypto implementation found\");\n  }\n  try {\n    const key = await subtle.importKey(\n      \"raw\",\n      base64ToBuf(decryptionKey),\n      { name: \"AES-CBC\", length: 128 },\n      true,\n      [\"encrypt\", \"decrypt\"]\n    );\n    const [iv, cipherText] = encryptedString.split(\".\");\n    const plainTextBuffer = await subtle.decrypt(\n      { name: \"AES-CBC\", iv: base64ToBuf(iv) },\n      key,\n      base64ToBuf(cipherText)\n    );\n\n    return new TextDecoder().decode(plainTextBuffer);\n  } catch (e) {\n    throw new Error(\"Failed to decrypt\");\n  }\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function toString(input: any): string {\n  if (typeof input === \"string\") return input;\n  return JSON.stringify(input);\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function paddedVersionString(input: any): string {\n  if (typeof input === \"number\") {\n    input = input + \"\";\n  }\n  if (!input || typeof input !== \"string\") {\n    input = \"0\";\n  }\n  // Remove build info and leading `v` if any\n  // Split version into parts (both core version numbers and pre-release tags)\n  // \"v1.2.3-rc.1+build123\" -> [\"1\",\"2\",\"3\",\"rc\",\"1\"]\n  const parts = (input as string).replace(/(^v|\\+.*$)/g, \"\").split(/[-.]/);\n\n  // If it's SemVer without a pre-release, add `~` to the end\n  // [\"1\",\"0\",\"0\"] -> [\"1\",\"0\",\"0\",\"~\"]\n  // \"~\" is the largest ASCII character, so this will make \"1.0.0\" greater than \"1.0.0-beta\" for example\n  if (parts.length === 3) {\n    parts.push(\"~\");\n  }\n\n  // Left pad each numeric part with spaces so string comparisons will work (\"9\">\"10\", but \" 9\"<\"10\")\n  // Then, join back together into a single string\n  return parts\n    .map((v) => (v.match(/^[0-9]+$/) ? v.padStart(5, \" \") : v))\n    .join(\"-\");\n}\n\nexport function loadSDKVersion(): string {\n  let version: string;\n  try {\n    // @ts-expect-error right-hand value to be replaced by build with string literal\n    version = __SDK_VERSION__;\n  } catch (e) {\n    version = \"\";\n  }\n  return version;\n}\n\nexport function mergeQueryStrings(oldUrl: string, newUrl: string): string {\n  let currUrl: URL;\n  let redirectUrl: URL;\n  try {\n    currUrl = new URL(oldUrl);\n    redirectUrl = new URL(newUrl);\n  } catch (e) {\n    console.error(`Unable to merge query strings: ${e}`);\n    return newUrl;\n  }\n\n  currUrl.searchParams.forEach((value, key) => {\n    // skip  if search param already exists in redirectUrl\n    if (redirectUrl.searchParams.has(key)) {\n      return;\n    }\n    redirectUrl.searchParams.set(key, value);\n  });\n\n  return redirectUrl.toString();\n}\n\nfunction isObj(x: unknown): x is Record<string, unknown> {\n  return typeof x === \"object\" && x !== null;\n}\n\nexport function getAutoExperimentChangeType(\n  exp: AutoExperiment\n): AutoExperimentChangeType {\n  if (\n    exp.urlPatterns &&\n    exp.variations.some(\n      (variation) => isObj(variation) && \"urlRedirect\" in variation\n    )\n  ) {\n    return \"redirect\";\n  } else if (\n    exp.variations.some(\n      (variation) =>\n        isObj(variation) &&\n        (variation.domMutations || \"js\" in variation || \"css\" in variation)\n    )\n  ) {\n    return \"visual\";\n  }\n\n  return \"unknown\";\n}\n","import {\n  Attributes,\n  CacheSettings,\n  FeatureApiResponse,\n  FetchResponse,\n  Helpers,\n  Polyfills,\n} from \"./types/growthbook\";\nimport { getPolyfills } from \"./util\";\nimport type { GrowthBook } from \".\";\n\ntype CacheEntry = {\n  data: FeatureApiResponse;\n  sse?: boolean;\n  version: string;\n  staleAt: Date;\n};\ntype ScopedChannel = {\n  src: EventSource | null;\n  cb: (event: MessageEvent<string>) => void;\n  host: string;\n  clientKey: string;\n  headers?: Record<string, string>;\n  errors: number;\n  state: \"active\" | \"idle\" | \"disabled\";\n};\n\n// Config settings\nconst cacheSettings: CacheSettings = {\n  // Consider a fetch stale after 1 minute\n  staleTTL: 1000 * 60,\n  // Max time to keep a fetch in cache (24 hours default)\n  maxAge: 1000 * 60 * 60 * 24,\n  cacheKey: \"gbFeaturesCache\",\n  backgroundSync: true,\n  maxEntries: 10,\n  disableIdleStreams: false,\n  idleStreamInterval: 20000,\n  disableCache: false,\n};\n\nconst polyfills = getPolyfills();\n\nexport const helpers: Helpers = {\n  fetchFeaturesCall: ({ host, clientKey, headers }) => {\n    return (polyfills.fetch as typeof globalThis.fetch)(\n      `${host}/api/features/${clientKey}`,\n      { headers }\n    );\n  },\n  fetchRemoteEvalCall: ({ host, clientKey, payload, headers }) => {\n    const options = {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\", ...headers },\n      body: JSON.stringify(payload),\n    };\n    return (polyfills.fetch as typeof globalThis.fetch)(\n      `${host}/api/eval/${clientKey}`,\n      options\n    );\n  },\n  eventSourceCall: ({ host, clientKey, headers }) => {\n    if (headers) {\n      return new polyfills.EventSource(`${host}/sub/${clientKey}`, {\n        headers,\n      });\n    }\n    return new polyfills.EventSource(`${host}/sub/${clientKey}`);\n  },\n  startIdleListener: () => {\n    let idleTimeout: number | undefined;\n    const isBrowser =\n      typeof window !== \"undefined\" && typeof document !== \"undefined\";\n    if (!isBrowser) return;\n    const onVisibilityChange = () => {\n      if (document.visibilityState === \"visible\") {\n        window.clearTimeout(idleTimeout);\n        onVisible();\n      } else if (document.visibilityState === \"hidden\") {\n        idleTimeout = window.setTimeout(\n          onHidden,\n          cacheSettings.idleStreamInterval\n        );\n      }\n    };\n    document.addEventListener(\"visibilitychange\", onVisibilityChange);\n    return () =>\n      document.removeEventListener(\"visibilitychange\", onVisibilityChange);\n  },\n  stopIdleListener: () => {\n    // No-op, replaced by startIdleListener\n  },\n};\n\ntry {\n  if (globalThis.localStorage) {\n    polyfills.localStorage = globalThis.localStorage;\n  }\n} catch (e) {\n  // Ignore localStorage errors\n}\n\n// Global state\nconst subscribedInstances: Map<string, Set<GrowthBook>> = new Map();\nlet cacheInitialized = false;\nconst cache: Map<string, CacheEntry> = new Map();\nconst activeFetches: Map<string, Promise<FetchResponse>> = new Map();\nconst streams: Map<string, ScopedChannel> = new Map();\nconst supportsSSE: Set<string> = new Set();\n\n// Public functions\nexport function setPolyfills(overrides: Partial<Polyfills>): void {\n  Object.assign(polyfills, overrides);\n}\nexport function configureCache(overrides: Partial<CacheSettings>): void {\n  Object.assign(cacheSettings, overrides);\n  if (!cacheSettings.backgroundSync) {\n    clearAutoRefresh();\n  }\n}\n\nexport async function clearCache(): Promise<void> {\n  cache.clear();\n  activeFetches.clear();\n  clearAutoRefresh();\n  cacheInitialized = false;\n  await updatePersistentCache();\n}\n\n// Get or fetch features and refresh the SDK instance\nexport async function refreshFeatures({\n  instance,\n  timeout,\n  skipCache,\n  allowStale,\n  backgroundSync,\n}: {\n  instance: GrowthBook;\n  timeout?: number;\n  skipCache?: boolean;\n  allowStale?: boolean;\n  backgroundSync?: boolean;\n}): Promise<FetchResponse> {\n  if (!backgroundSync) {\n    cacheSettings.backgroundSync = false;\n  }\n\n  return fetchFeaturesWithCache({\n    instance,\n    allowStale,\n    timeout,\n    skipCache,\n  });\n}\n\n// Subscribe a GrowthBook instance to feature changes\nexport function subscribe(instance: GrowthBook): void {\n  const key = getKey(instance);\n  const subs = subscribedInstances.get(key) || new Set();\n  subs.add(instance);\n  subscribedInstances.set(key, subs);\n}\nexport function unsubscribe(instance: GrowthBook): void {\n  subscribedInstances.forEach((s) => s.delete(instance));\n}\n\nexport function onHidden() {\n  streams.forEach((channel) => {\n    if (!channel) return;\n    channel.state = \"idle\";\n    disableChannel(channel);\n  });\n}\n\nexport function onVisible() {\n  streams.forEach((channel) => {\n    if (!channel) return;\n    if (channel.state !== \"idle\") return;\n    enableChannel(channel);\n  });\n}\n\n// Private functions\n\nasync function updatePersistentCache() {\n  try {\n    if (!polyfills.localStorage) return;\n    await polyfills.localStorage.setItem(\n      cacheSettings.cacheKey,\n      JSON.stringify(Array.from(cache.entries()))\n    );\n  } catch (e) {\n    // Ignore localStorage errors\n  }\n}\n\n// SWR wrapper for fetching features. May indirectly or directly start SSE streaming.\nasync function fetchFeaturesWithCache({\n  instance,\n  allowStale,\n  timeout,\n  skipCache,\n}: {\n  instance: GrowthBook;\n  allowStale?: boolean;\n  timeout?: number;\n  skipCache?: boolean;\n}): Promise<FetchResponse> {\n  const key = getKey(instance);\n  const cacheKey = getCacheKey(instance);\n  const now = new Date();\n\n  const minStaleAt = new Date(\n    now.getTime() - cacheSettings.maxAge + cacheSettings.staleTTL\n  );\n\n  await initializeCache();\n  const existing =\n    !cacheSettings.disableCache && !skipCache ? cache.get(cacheKey) : undefined;\n  if (\n    existing &&\n    (allowStale || existing.staleAt > now) &&\n    existing.staleAt > minStaleAt\n  ) {\n    // Restore from cache whether SSE is supported\n    if (existing.sse) supportsSSE.add(key);\n\n    // Reload features in the background if stale\n    if (existing.staleAt < now) {\n      fetchFeatures(instance);\n    }\n    // Otherwise, if we don't need to refresh now, start a background sync\n    else {\n      startAutoRefresh(instance);\n    }\n    return { data: existing.data, success: true, source: \"cache\" };\n  } else {\n    const res = await promiseTimeout(fetchFeatures(instance), timeout);\n    return (\n      res || {\n        data: null,\n        success: false,\n        source: \"timeout\",\n        error: new Error(\"Timeout\"),\n      }\n    );\n  }\n}\n\nfunction getKey(instance: GrowthBook): string {\n  const [apiHost, clientKey] = instance.getApiInfo();\n  return `${apiHost}||${clientKey}`;\n}\n\nfunction getCacheKey(instance: GrowthBook): string {\n  const baseKey = getKey(instance);\n  if (!instance.isRemoteEval()) return baseKey;\n\n  const attributes = instance.getAttributes();\n  const cacheKeyAttributes =\n    instance.getCacheKeyAttributes() || Object.keys(instance.getAttributes());\n  const ca: Attributes = {};\n  cacheKeyAttributes.forEach((key) => {\n    ca[key] = attributes[key];\n  });\n\n  const fv = instance.getForcedVariations();\n  const url = instance.getUrl();\n\n  return `${baseKey}||${JSON.stringify({\n    ca,\n    fv,\n    url,\n  })}`;\n}\n\n// Guarantee the promise always resolves within {timeout} ms\n// Resolved value will be `null` when there's an error or it takes too long\n// Note: The promise will continue running in the background, even if the timeout is hit\nfunction promiseTimeout<T>(\n  promise: Promise<T>,\n  timeout?: number\n): Promise<T | null> {\n  return new Promise((resolve) => {\n    let resolved = false;\n    let timer: NodeJS.Timeout | undefined;\n    const finish = (data?: T) => {\n      if (resolved) return;\n      resolved = true;\n      timer && clearTimeout(timer);\n      resolve(data || null);\n    };\n\n    if (timeout) {\n      timer = setTimeout(() => finish(), timeout);\n    }\n\n    promise.then((data) => finish(data)).catch(() => finish());\n  });\n}\n\n// Populate cache from localStorage (if available)\nasync function initializeCache(): Promise<void> {\n  if (cacheInitialized) return;\n  cacheInitialized = true;\n  try {\n    if (polyfills.localStorage) {\n      const value = await polyfills.localStorage.getItem(\n        cacheSettings.cacheKey\n      );\n      if (!cacheSettings.disableCache && value) {\n        const parsed: [string, CacheEntry][] = JSON.parse(value);\n        if (parsed && Array.isArray(parsed)) {\n          parsed.forEach(([key, data]) => {\n            cache.set(key, {\n              ...data,\n              staleAt: new Date(data.staleAt),\n            });\n          });\n        }\n        cleanupCache();\n      }\n    }\n  } catch (e) {\n    // Ignore localStorage errors\n  }\n  if (!cacheSettings.disableIdleStreams) {\n    const cleanupFn = helpers.startIdleListener();\n    if (cleanupFn) {\n      helpers.stopIdleListener = cleanupFn;\n    }\n  }\n}\n\n// Enforce the maxEntries limit\nfunction cleanupCache() {\n  const entriesWithTimestamps = Array.from(cache.entries())\n    .map(([key, value]) => ({\n      key,\n      staleAt: value.staleAt.getTime(),\n    }))\n    .sort((a, b) => a.staleAt - b.staleAt);\n\n  const entriesToRemoveCount = Math.min(\n    Math.max(0, cache.size - cacheSettings.maxEntries),\n    cache.size\n  );\n\n  for (let i = 0; i < entriesToRemoveCount; i++) {\n    cache.delete(entriesWithTimestamps[i].key);\n  }\n}\n\n// Called whenever new features are fetched from the API\nfunction onNewFeatureData(\n  key: string,\n  cacheKey: string,\n  data: FeatureApiResponse\n): void {\n  // If contents haven't changed, ignore the update, extend the stale TTL\n  const version = data.dateUpdated || \"\";\n  const staleAt = new Date(Date.now() + cacheSettings.staleTTL);\n  const existing = !cacheSettings.disableCache\n    ? cache.get(cacheKey)\n    : undefined;\n  if (existing && version && existing.version === version) {\n    existing.staleAt = staleAt;\n    updatePersistentCache();\n    return;\n  }\n\n  if (!cacheSettings.disableCache) {\n    // Update in-memory cache\n    cache.set(cacheKey, {\n      data,\n      version,\n      staleAt,\n      sse: supportsSSE.has(key),\n    });\n    cleanupCache();\n  }\n  // Update local storage (don't await this, just update asynchronously)\n  updatePersistentCache();\n\n  // Update features for all subscribed GrowthBook instances\n  const instances = subscribedInstances.get(key);\n  instances && instances.forEach((instance) => refreshInstance(instance, data));\n}\n\nasync function refreshInstance(\n  instance: GrowthBook,\n  data: FeatureApiResponse | null\n): Promise<void> {\n  await instance.setPayload(data || instance.getPayload());\n}\n\n// Fetch the features payload from helper function or from in-mem injected payload\nasync function fetchFeatures(instance: GrowthBook): Promise<FetchResponse> {\n  const { apiHost, apiRequestHeaders } = instance.getApiHosts();\n  const clientKey = instance.getClientKey();\n  const remoteEval = instance.isRemoteEval();\n  const key = getKey(instance);\n  const cacheKey = getCacheKey(instance);\n\n  let promise = activeFetches.get(cacheKey);\n  if (!promise) {\n    const fetcher: Promise<Response> = remoteEval\n      ? helpers.fetchRemoteEvalCall({\n          host: apiHost,\n          clientKey,\n          payload: {\n            attributes: instance.getAttributes(),\n            forcedVariations: instance.getForcedVariations(),\n            forcedFeatures: Array.from(instance.getForcedFeatures().entries()),\n            url: instance.getUrl(),\n          },\n          headers: apiRequestHeaders,\n        })\n      : helpers.fetchFeaturesCall({\n          host: apiHost,\n          clientKey,\n          headers: apiRequestHeaders,\n        });\n\n    // TODO: auto-retry if status code indicates a temporary error\n    promise = fetcher\n      .then((res) => {\n        if (!res.ok) {\n          throw new Error(`HTTP error: ${res.status}`);\n        }\n        if (res.headers.get(\"x-sse-support\") === \"enabled\") {\n          supportsSSE.add(key);\n        }\n        return res.json();\n      })\n      .then((data: FeatureApiResponse) => {\n        onNewFeatureData(key, cacheKey, data);\n        startAutoRefresh(instance);\n        activeFetches.delete(cacheKey);\n        return { data, success: true, source: \"network\" as const };\n      })\n      .catch((e) => {\n        process.env.NODE_ENV !== \"production\" &&\n          instance.log(\"Error fetching features\", {\n            apiHost,\n            clientKey,\n            error: e ? e.message : null,\n          });\n        activeFetches.delete(cacheKey);\n\n        return {\n          data: null,\n          source: \"error\" as const,\n          success: false,\n          error: e,\n        };\n      });\n    activeFetches.set(cacheKey, promise);\n  }\n  return promise;\n}\n\n// Start SSE streaming, listens to feature payload changes and triggers a refresh or re-fetch\nexport function startAutoRefresh(\n  instance: GrowthBook,\n  forceSSE: boolean = false\n): void {\n  const key = getKey(instance);\n  const cacheKey = getCacheKey(instance);\n  const { streamingHost, streamingHostRequestHeaders } = instance.getApiHosts();\n  const clientKey = instance.getClientKey();\n\n  if (forceSSE) {\n    supportsSSE.add(key);\n  }\n\n  if (\n    cacheSettings.backgroundSync &&\n    supportsSSE.has(key) &&\n    polyfills.EventSource\n  ) {\n    if (streams.has(key)) return;\n    const channel: ScopedChannel = {\n      src: null,\n      host: streamingHost,\n      clientKey,\n      headers: streamingHostRequestHeaders,\n      cb: (event: MessageEvent<string>) => {\n        try {\n          if (event.type === \"features-updated\") {\n            const instances = subscribedInstances.get(key);\n            instances &&\n              instances.forEach((instance) => {\n                fetchFeatures(instance);\n              });\n          } else if (event.type === \"features\") {\n            const json: FeatureApiResponse = JSON.parse(event.data);\n            onNewFeatureData(key, cacheKey, json);\n          }\n          // Reset error count on success\n          channel.errors = 0;\n        } catch (e) {\n          process.env.NODE_ENV !== \"production\" &&\n            instance.log(\"SSE Error\", {\n              streamingHost,\n              clientKey,\n              error: e ? (e as Error).message : null,\n            });\n          onSSEError(channel);\n        }\n      },\n      errors: 0,\n      state: \"active\",\n    };\n    streams.set(key, channel);\n    enableChannel(channel);\n  }\n}\n\nfunction onSSEError(channel: ScopedChannel) {\n  if (channel.state === \"idle\") return;\n  channel.errors++;\n  if (channel.errors > 3 || (channel.src && channel.src.readyState === 2)) {\n    // exponential backoff after 4 errors, with jitter\n    const delay =\n      Math.pow(3, channel.errors - 3) * (1000 + Math.random() * 1000);\n    disableChannel(channel);\n    setTimeout(() => {\n      if ([\"idle\", \"active\"].includes(channel.state)) return;\n      enableChannel(channel);\n    }, Math.min(delay, 300000)); // 5 minutes max\n  }\n}\n\nfunction disableChannel(channel: ScopedChannel) {\n  if (!channel.src) return;\n  channel.src.onopen = null;\n  channel.src.onerror = null;\n  channel.src.close();\n  channel.src = null;\n  if (channel.state === \"active\") {\n    channel.state = \"disabled\";\n  }\n}\n\nfunction enableChannel(channel: ScopedChannel) {\n  channel.src = helpers.eventSourceCall({\n    host: channel.host,\n    clientKey: channel.clientKey,\n    headers: channel.headers,\n  }) as EventSource;\n  channel.state = \"active\";\n  channel.src.addEventListener(\"features\", channel.cb);\n  channel.src.addEventListener(\"features-updated\", channel.cb);\n  channel.src.onerror = () => onSSEError(channel);\n  channel.src.onopen = () => {\n    channel.errors = 0;\n  };\n}\n\nfunction destroyChannel(channel: ScopedChannel, key: string) {\n  disableChannel(channel);\n  streams.delete(key);\n}\n\nfunction clearAutoRefresh() {\n  // Clear list of which keys are auto-updated\n  supportsSSE.clear();\n\n  // Stop listening for any SSE events\n  streams.forEach(destroyChannel);\n\n  // Remove all references to GrowthBook instances\n  subscribedInstances.clear();\n\n  // Run the idle stream cleanup function\n  helpers.stopIdleListener();\n}\n","var validAttributeName = /^[a-zA-Z:_][a-zA-Z0-9:_.-]*$/;\nvar nullController = {\n  revert: function revert() {}\n};\nvar elements = /*#__PURE__*/new Map();\nvar mutations = /*#__PURE__*/new Set();\n\nfunction getObserverInit(attr) {\n  return attr === 'html' ? {\n    childList: true,\n    subtree: true,\n    attributes: true,\n    characterData: true\n  } : {\n    childList: false,\n    subtree: false,\n    attributes: true,\n    attributeFilter: [attr]\n  };\n}\n\nfunction getElementRecord(element) {\n  var record = elements.get(element);\n\n  if (!record) {\n    record = {\n      element: element,\n      attributes: {}\n    };\n    elements.set(element, record);\n  }\n\n  return record;\n}\n\nfunction createElementPropertyRecord(el, attr, getCurrentValue, setValue, mutationRunner) {\n  var currentValue = getCurrentValue(el);\n  var record = {\n    isDirty: false,\n    originalValue: currentValue,\n    virtualValue: currentValue,\n    mutations: [],\n    el: el,\n    _positionTimeout: null,\n    observer: new MutationObserver(function () {\n      // enact a 1 second timeout that blocks subsequent firing of the\n      // observer until the timeout is complete. This will prevent multiple\n      // mutations from firing in quick succession, which can cause the\n      // mutation to be reverted before the DOM has a chance to update.\n      if (attr === 'position' && record._positionTimeout) return;else if (attr === 'position') record._positionTimeout = setTimeout(function () {\n        record._positionTimeout = null;\n      }, 1000);\n      var currentValue = getCurrentValue(el);\n      if (attr === 'position' && currentValue.parentNode === record.virtualValue.parentNode && currentValue.insertBeforeNode === record.virtualValue.insertBeforeNode) return;\n      if (currentValue === record.virtualValue) return;\n      record.originalValue = currentValue;\n      mutationRunner(record);\n    }),\n    mutationRunner: mutationRunner,\n    setValue: setValue,\n    getCurrentValue: getCurrentValue\n  };\n\n  if (attr === 'position' && el.parentNode) {\n    record.observer.observe(el.parentNode, {\n      childList: true,\n      subtree: true,\n      attributes: false,\n      characterData: false\n    });\n  } else {\n    record.observer.observe(el, getObserverInit(attr));\n  }\n\n  return record;\n}\n\nfunction queueIfNeeded(val, record) {\n  var currentVal = record.getCurrentValue(record.el);\n  record.virtualValue = val;\n\n  if (val && typeof val !== 'string') {\n    if (!currentVal || val.parentNode !== currentVal.parentNode || val.insertBeforeNode !== currentVal.insertBeforeNode) {\n      record.isDirty = true;\n      runDOMUpdates();\n    }\n  } else if (val !== currentVal) {\n    record.isDirty = true;\n    runDOMUpdates();\n  }\n}\n\nfunction htmlMutationRunner(record) {\n  var val = record.originalValue;\n  record.mutations.forEach(function (m) {\n    return val = m.mutate(val);\n  });\n  queueIfNeeded(getTransformedHTML(val), record);\n}\n\nfunction classMutationRunner(record) {\n  var val = new Set(record.originalValue.split(/\\s+/).filter(Boolean));\n  record.mutations.forEach(function (m) {\n    return m.mutate(val);\n  });\n  queueIfNeeded(Array.from(val).filter(Boolean).join(' '), record);\n}\n\nfunction attrMutationRunner(record) {\n  var val = record.originalValue;\n  record.mutations.forEach(function (m) {\n    return val = m.mutate(val);\n  });\n  queueIfNeeded(val, record);\n}\n\nfunction _loadDOMNodes(_ref) {\n  var parentSelector = _ref.parentSelector,\n      insertBeforeSelector = _ref.insertBeforeSelector;\n  var parentNode = document.querySelector(parentSelector);\n  if (!parentNode) return null;\n  var insertBeforeNode = insertBeforeSelector ? document.querySelector(insertBeforeSelector) : null;\n  if (insertBeforeSelector && !insertBeforeNode) return null;\n  return {\n    parentNode: parentNode,\n    insertBeforeNode: insertBeforeNode\n  };\n}\n\nfunction positionMutationRunner(record) {\n  var val = record.originalValue;\n  record.mutations.forEach(function (m) {\n    var selectors = m.mutate();\n\n    var newNodes = _loadDOMNodes(selectors);\n\n    val = newNodes || val;\n  });\n  queueIfNeeded(val, record);\n}\n\nvar getHTMLValue = function getHTMLValue(el) {\n  return el.innerHTML;\n};\n\nvar setHTMLValue = function setHTMLValue(el, value) {\n  return el.innerHTML = value;\n};\n\nfunction getElementHTMLRecord(element) {\n  var elementRecord = getElementRecord(element);\n\n  if (!elementRecord.html) {\n    elementRecord.html = createElementPropertyRecord(element, 'html', getHTMLValue, setHTMLValue, htmlMutationRunner);\n  }\n\n  return elementRecord.html;\n}\n\nvar getElementPosition = function getElementPosition(el) {\n  return {\n    parentNode: el.parentElement,\n    insertBeforeNode: el.nextElementSibling\n  };\n};\n\nvar setElementPosition = function setElementPosition(el, value) {\n  if (value.insertBeforeNode && !value.parentNode.contains(value.insertBeforeNode)) {\n    // skip position mutation - insertBeforeNode not a child of parent. happens\n    // when mutation observer for indvidual element fires out of order\n    return;\n  }\n\n  value.parentNode.insertBefore(el, value.insertBeforeNode);\n};\n\nfunction getElementPositionRecord(element) {\n  var elementRecord = getElementRecord(element);\n\n  if (!elementRecord.position) {\n    elementRecord.position = createElementPropertyRecord(element, 'position', getElementPosition, setElementPosition, positionMutationRunner);\n  }\n\n  return elementRecord.position;\n}\n\nvar setClassValue = function setClassValue(el, val) {\n  return val ? el.className = val : el.removeAttribute('class');\n};\n\nvar getClassValue = function getClassValue(el) {\n  return el.className;\n};\n\nfunction getElementClassRecord(el) {\n  var elementRecord = getElementRecord(el);\n\n  if (!elementRecord.classes) {\n    elementRecord.classes = createElementPropertyRecord(el, 'class', getClassValue, setClassValue, classMutationRunner);\n  }\n\n  return elementRecord.classes;\n}\n\nvar getAttrValue = function getAttrValue(attrName) {\n  return function (el) {\n    var _el$getAttribute;\n\n    return (_el$getAttribute = el.getAttribute(attrName)) != null ? _el$getAttribute : null;\n  };\n};\n\nvar setAttrValue = function setAttrValue(attrName) {\n  return function (el, val) {\n    return val !== null ? el.setAttribute(attrName, val) : el.removeAttribute(attrName);\n  };\n};\n\nfunction getElementAttributeRecord(el, attr) {\n  var elementRecord = getElementRecord(el);\n\n  if (!elementRecord.attributes[attr]) {\n    elementRecord.attributes[attr] = createElementPropertyRecord(el, attr, getAttrValue(attr), setAttrValue(attr), attrMutationRunner);\n  }\n\n  return elementRecord.attributes[attr];\n}\n\nfunction deleteElementPropertyRecord(el, attr) {\n  var element = elements.get(el);\n  if (!element) return;\n\n  if (attr === 'html') {\n    var _element$html, _element$html$observe;\n\n    (_element$html = element.html) == null ? void 0 : (_element$html$observe = _element$html.observer) == null ? void 0 : _element$html$observe.disconnect();\n    delete element.html;\n  } else if (attr === 'class') {\n    var _element$classes, _element$classes$obse;\n\n    (_element$classes = element.classes) == null ? void 0 : (_element$classes$obse = _element$classes.observer) == null ? void 0 : _element$classes$obse.disconnect();\n    delete element.classes;\n  } else if (attr === 'position') {\n    var _element$position, _element$position$obs;\n\n    (_element$position = element.position) == null ? void 0 : (_element$position$obs = _element$position.observer) == null ? void 0 : _element$position$obs.disconnect();\n    delete element.position;\n  } else {\n    var _element$attributes, _element$attributes$a, _element$attributes$a2;\n\n    (_element$attributes = element.attributes) == null ? void 0 : (_element$attributes$a = _element$attributes[attr]) == null ? void 0 : (_element$attributes$a2 = _element$attributes$a.observer) == null ? void 0 : _element$attributes$a2.disconnect();\n    delete element.attributes[attr];\n  }\n}\n\nvar transformContainer;\n\nfunction getTransformedHTML(html) {\n  if (!transformContainer) {\n    transformContainer = document.createElement('div');\n  }\n\n  transformContainer.innerHTML = html;\n  return transformContainer.innerHTML;\n}\n\nfunction setPropertyValue(el, attr, m) {\n  if (!m.isDirty) return;\n  m.isDirty = false;\n  var val = m.virtualValue;\n\n  if (!m.mutations.length) {\n    deleteElementPropertyRecord(el, attr);\n  }\n\n  m.setValue(el, val);\n}\n\nfunction setValue(m, el) {\n  m.html && setPropertyValue(el, 'html', m.html);\n  m.classes && setPropertyValue(el, 'class', m.classes);\n  m.position && setPropertyValue(el, 'position', m.position);\n  Object.keys(m.attributes).forEach(function (attr) {\n    setPropertyValue(el, attr, m.attributes[attr]);\n  });\n}\n\nfunction runDOMUpdates() {\n  elements.forEach(setValue);\n} // find or create ElementPropertyRecord, add mutation to it, then run\n\n\nfunction startMutating(mutation, element) {\n  var record = null;\n\n  if (mutation.kind === 'html') {\n    record = getElementHTMLRecord(element);\n  } else if (mutation.kind === 'class') {\n    record = getElementClassRecord(element);\n  } else if (mutation.kind === 'attribute') {\n    record = getElementAttributeRecord(element, mutation.attribute);\n  } else if (mutation.kind === 'position') {\n    record = getElementPositionRecord(element);\n  }\n\n  if (!record) return;\n  record.mutations.push(mutation);\n  record.mutationRunner(record);\n} // get (existing) ElementPropertyRecord, remove mutation from it, then run\n\n\nfunction stopMutating(mutation, el) {\n  var record = null;\n\n  if (mutation.kind === 'html') {\n    record = getElementHTMLRecord(el);\n  } else if (mutation.kind === 'class') {\n    record = getElementClassRecord(el);\n  } else if (mutation.kind === 'attribute') {\n    record = getElementAttributeRecord(el, mutation.attribute);\n  } else if (mutation.kind === 'position') {\n    record = getElementPositionRecord(el);\n  }\n\n  if (!record) return;\n  var index = record.mutations.indexOf(mutation);\n  if (index !== -1) record.mutations.splice(index, 1);\n  record.mutationRunner(record);\n} // maintain list of elements associated with mutation\n\n\nfunction refreshElementsSet(mutation) {\n  // if a position mutation has already found an element to move, don't move\n  // any more elements\n  if (mutation.kind === 'position' && mutation.elements.size === 1) return;\n  var existingElements = new Set(mutation.elements);\n  var matchingElements = document.querySelectorAll(mutation.selector);\n  matchingElements.forEach(function (el) {\n    if (!existingElements.has(el)) {\n      mutation.elements.add(el);\n      startMutating(mutation, el);\n    }\n  });\n}\n\nfunction revertMutation(mutation) {\n  mutation.elements.forEach(function (el) {\n    return stopMutating(mutation, el);\n  });\n  mutation.elements.clear();\n  mutations[\"delete\"](mutation);\n}\n\nfunction refreshAllElementSets() {\n  mutations.forEach(refreshElementsSet);\n} // Observer for elements that don't exist in the DOM yet\n\n\nvar observer;\nfunction disconnectGlobalObserver() {\n  observer && observer.disconnect();\n}\nfunction connectGlobalObserver() {\n  if (typeof document === 'undefined') return;\n\n  if (!observer) {\n    observer = new MutationObserver(function () {\n      refreshAllElementSets();\n    });\n  }\n\n  refreshAllElementSets();\n  observer.observe(document.documentElement, {\n    childList: true,\n    subtree: true,\n    attributes: false,\n    characterData: false\n  });\n} // run on init\n\nconnectGlobalObserver();\n\nfunction newMutation(m) {\n  // Not in a browser\n  if (typeof document === 'undefined') return nullController; // add to global index of mutations\n\n  mutations.add(m); // run refresh on init to establish list of elements associated w/ mutation\n\n  refreshElementsSet(m);\n  return {\n    revert: function revert() {\n      revertMutation(m);\n    }\n  };\n}\n\nfunction html(selector, mutate) {\n  return newMutation({\n    kind: 'html',\n    elements: new Set(),\n    mutate: mutate,\n    selector: selector\n  });\n}\n\nfunction position(selector, mutate) {\n  return newMutation({\n    kind: 'position',\n    elements: new Set(),\n    mutate: mutate,\n    selector: selector\n  });\n}\n\nfunction classes(selector, mutate) {\n  return newMutation({\n    kind: 'class',\n    elements: new Set(),\n    mutate: mutate,\n    selector: selector\n  });\n}\n\nfunction attribute(selector, attribute, mutate) {\n  if (!validAttributeName.test(attribute)) return nullController;\n\n  if (attribute === 'class' || attribute === 'className') {\n    return classes(selector, function (classnames) {\n      var mutatedClassnames = mutate(Array.from(classnames).join(' '));\n      classnames.clear();\n      if (!mutatedClassnames) return;\n      mutatedClassnames.split(/\\s+/g).filter(Boolean).forEach(function (c) {\n        return classnames.add(c);\n      });\n    });\n  }\n\n  return newMutation({\n    kind: 'attribute',\n    attribute: attribute,\n    elements: new Set(),\n    mutate: mutate,\n    selector: selector\n  });\n}\n\nfunction declarative(_ref2) {\n  var selector = _ref2.selector,\n      action = _ref2.action,\n      value = _ref2.value,\n      attr = _ref2.attribute,\n      parentSelector = _ref2.parentSelector,\n      insertBeforeSelector = _ref2.insertBeforeSelector;\n\n  if (attr === 'html') {\n    if (action === 'append') {\n      return html(selector, function (val) {\n        return val + (value != null ? value : '');\n      });\n    } else if (action === 'set') {\n      return html(selector, function () {\n        return value != null ? value : '';\n      });\n    }\n  } else if (attr === 'class') {\n    if (action === 'append') {\n      return classes(selector, function (val) {\n        if (value) val.add(value);\n      });\n    } else if (action === 'remove') {\n      return classes(selector, function (val) {\n        if (value) val[\"delete\"](value);\n      });\n    } else if (action === 'set') {\n      return classes(selector, function (val) {\n        val.clear();\n        if (value) val.add(value);\n      });\n    }\n  } else if (attr === 'position') {\n    if (action === 'set' && parentSelector) {\n      return position(selector, function () {\n        return {\n          insertBeforeSelector: insertBeforeSelector,\n          parentSelector: parentSelector\n        };\n      });\n    }\n  } else {\n    if (action === 'append') {\n      return attribute(selector, attr, function (val) {\n        return val !== null ? val + (value != null ? value : '') : value != null ? value : '';\n      });\n    } else if (action === 'set') {\n      return attribute(selector, attr, function () {\n        return value != null ? value : '';\n      });\n    } else if (action === 'remove') {\n      return attribute(selector, attr, function () {\n        return null;\n      });\n    }\n  }\n\n  return nullController;\n}\n\nvar index = {\n  html: html,\n  classes: classes,\n  attribute: attribute,\n  position: position,\n  declarative: declarative\n};\n\nexport default index;\nexport { connectGlobalObserver, disconnectGlobalObserver, validAttributeName };\n//# sourceMappingURL=dom-mutator.esm.js.map\n","/* eslint-disable @typescript-eslint/no-explicit-any */\n\nimport {\n  ConditionInterface,\n  TestedObj,\n  ConditionValue,\n  Operator,\n  OperatorConditionValue,\n  VarType,\n} from \"./types/mongrule\";\nimport { paddedVersionString } from \"./util\";\n\nconst _regexCache: { [key: string]: RegExp } = {};\n\n// The top-level condition evaluation function\nexport function evalCondition(\n  obj: TestedObj,\n  condition: ConditionInterface\n): boolean {\n  // Condition is an object, keys are either specific operators or object paths\n  // values are either arguments for operators or conditions for paths\n  for (const [k, v] of Object.entries(condition)) {\n    switch (k) {\n      case \"$or\":\n        if (!evalOr(obj, v as ConditionInterface[])) return false;\n        break;\n      case \"$nor\":\n        if (evalOr(obj, v as ConditionInterface[])) return false;\n        break;\n      case \"$and\":\n        if (!evalAnd(obj, v as ConditionInterface[])) return false;\n        break;\n      case \"$not\":\n        if (evalCondition(obj, v as ConditionInterface)) return false;\n        break;\n      default:\n        if (!evalConditionValue(v, getPath(obj, k))) return false;\n    }\n  }\n  return true;\n}\n\n// Return value at dot-separated path of an object\nfunction getPath(obj: TestedObj, path: string) {\n  const parts = path.split(\".\");\n  let current: any = obj;\n  for (let i = 0; i < parts.length; i++) {\n    if (current && typeof current === \"object\" && parts[i] in current) {\n      current = current[parts[i]];\n    } else {\n      return null;\n    }\n  }\n  return current;\n}\n\n// Transform a regex string into a real RegExp object\nfunction getRegex(regex: string): RegExp {\n  if (!_regexCache[regex]) {\n    _regexCache[regex] = new RegExp(regex.replace(/([^\\\\])\\//g, \"$1\\\\/\"));\n  }\n  return _regexCache[regex];\n}\n\n// Evaluate a single value against a condition\nfunction evalConditionValue(condition: ConditionValue, value: any) {\n  // Simple equality comparisons\n  if (typeof condition === \"string\") {\n    return value + \"\" === condition;\n  }\n  if (typeof condition === \"number\") {\n    return value * 1 === condition;\n  }\n  if (typeof condition === \"boolean\") {\n    return !!value === condition;\n  }\n\n  if (condition === null) {\n    return value === null;\n  }\n\n  if (Array.isArray(condition) || !isOperatorObject(condition)) {\n    return JSON.stringify(value) === JSON.stringify(condition);\n  }\n\n  // This is a special operator condition and we should evaluate each one separately\n  for (const op in condition) {\n    if (\n      !evalOperatorCondition(\n        op as Operator,\n        value,\n        condition[op as keyof OperatorConditionValue]\n      )\n    ) {\n      return false;\n    }\n  }\n  return true;\n}\n\n// If the object has only keys that start with '$'\nfunction isOperatorObject(obj: any): boolean {\n  const keys = Object.keys(obj);\n  return (\n    keys.length > 0 && keys.filter((k) => k[0] === \"$\").length === keys.length\n  );\n}\n\n// Return the data type of a value\nfunction getType(v: any): VarType | \"unknown\" {\n  if (v === null) return \"null\";\n  if (Array.isArray(v)) return \"array\";\n  const t = typeof v;\n  if ([\"string\", \"number\", \"boolean\", \"object\", \"undefined\"].includes(t)) {\n    return t as VarType;\n  }\n  return \"unknown\";\n}\n\n// At least one element of actual must match the expected condition/value\nfunction elemMatch(actual: any, expected: any) {\n  if (!Array.isArray(actual)) return false;\n  const check = isOperatorObject(expected)\n    ? (v: any) => evalConditionValue(expected, v)\n    : (v: any) => evalCondition(v, expected);\n  for (let i = 0; i < actual.length; i++) {\n    if (actual[i] && check(actual[i])) {\n      return true;\n    }\n  }\n  return false;\n}\n\nfunction isIn(actual: any, expected: Array<any>): boolean {\n  // Do an intersection is attribute is an array\n  if (Array.isArray(actual)) {\n    return actual.some((el) => expected.includes(el));\n  }\n  return expected.includes(actual);\n}\n\n// Evaluate a single operator condition\nfunction evalOperatorCondition(\n  operator: Operator,\n  actual: any,\n  expected: any\n): boolean {\n  switch (operator) {\n    case \"$veq\":\n      return paddedVersionString(actual) === paddedVersionString(expected);\n    case \"$vne\":\n      return paddedVersionString(actual) !== paddedVersionString(expected);\n    case \"$vgt\":\n      return paddedVersionString(actual) > paddedVersionString(expected);\n    case \"$vgte\":\n      return paddedVersionString(actual) >= paddedVersionString(expected);\n    case \"$vlt\":\n      return paddedVersionString(actual) < paddedVersionString(expected);\n    case \"$vlte\":\n      return paddedVersionString(actual) <= paddedVersionString(expected);\n    case \"$eq\":\n      return actual === expected;\n    case \"$ne\":\n      return actual !== expected;\n    case \"$lt\":\n      return actual < expected;\n    case \"$lte\":\n      return actual <= expected;\n    case \"$gt\":\n      return actual > expected;\n    case \"$gte\":\n      return actual >= expected;\n    case \"$exists\":\n      // Using `!=` and `==` instead of strict checks so it also matches for undefined\n      return expected ? actual != null : actual == null;\n    case \"$in\":\n      if (!Array.isArray(expected)) return false;\n      return isIn(actual, expected);\n    case \"$nin\":\n      if (!Array.isArray(expected)) return false;\n      return !isIn(actual, expected);\n    case \"$not\":\n      return !evalConditionValue(expected, actual);\n    case \"$size\":\n      if (!Array.isArray(actual)) return false;\n      return evalConditionValue(expected, actual.length);\n    case \"$elemMatch\":\n      return elemMatch(actual, expected);\n    case \"$all\":\n      if (!Array.isArray(actual)) return false;\n      for (let i = 0; i < expected.length; i++) {\n        let passed = false;\n        for (let j = 0; j < actual.length; j++) {\n          if (evalConditionValue(expected[i], actual[j])) {\n            passed = true;\n            break;\n          }\n        }\n        if (!passed) return false;\n      }\n      return true;\n    case \"$regex\":\n      try {\n        return getRegex(expected).test(actual);\n      } catch (e) {\n        return false;\n      }\n    case \"$type\":\n      return getType(actual) === expected;\n    default:\n      console.error(\"Unknown operator: \" + operator);\n      return false;\n  }\n}\n\n// Recursive $or rule\nfunction evalOr(obj: TestedObj, conditions: ConditionInterface[]): boolean {\n  if (!conditions.length) return true;\n  for (let i = 0; i < conditions.length; i++) {\n    if (evalCondition(obj, conditions[i])) {\n      return true;\n    }\n  }\n  return false;\n}\n\n// Recursive $and rule\nfunction evalAnd(obj: TestedObj, conditions: ConditionInterface[]): boolean {\n  for (let i = 0; i < conditions.length; i++) {\n    if (!evalCondition(obj, conditions[i])) {\n      return false;\n    }\n  }\n  return true;\n}\n","import mutate, { DeclarativeMutation } from \"dom-mutator\";\nimport type {\n  ApiHost,\n  Attributes,\n  AutoExperiment,\n  AutoExperimentVariation,\n  ClientKey,\n  Context,\n  Experiment,\n  FeatureApiResponse,\n  FeatureDefinition,\n  FeatureResult,\n  FeatureResultSource,\n  Filter,\n  LoadFeaturesOptions,\n  RealtimeUsageData,\n  RefreshFeaturesOptions,\n  RenderFunction,\n  Result,\n  StickyAssignments,\n  StickyAssignmentsDocument,\n  StickyAttributeKey,\n  StickyExperimentKey,\n  SubscriptionFunction,\n  TrackingCallback,\n  TrackingData,\n  VariationMeta,\n  VariationRange,\n  WidenPrimitives,\n  FeatureEvalContext,\n  InitOptions,\n  InitResponse,\n  InitSyncOptions,\n  PrefetchOptions,\n} from \"./types/growthbook\";\nimport type { ConditionInterface } from \"./types/mongrule\";\nimport {\n  chooseVariation,\n  decrypt,\n  getAutoExperimentChangeType,\n  getBucketRanges,\n  getQueryStringOverride,\n  getUrlRegExp,\n  hash,\n  inNamespace,\n  inRange,\n  isIncluded,\n  isURLTargeted,\n  loadSDKVersion,\n  mergeQueryStrings,\n  toString,\n} from \"./util\";\nimport { evalCondition } from \"./mongrule\";\nimport {\n  refreshFeatures,\n  startAutoRefresh,\n  subscribe,\n  unsubscribe,\n} from \"./feature-repository\";\n\nconst isBrowser =\n  typeof window !== \"undefined\" && typeof document !== \"undefined\";\n\nconst SDK_VERSION = loadSDKVersion();\n\nexport class GrowthBook<\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  AppFeatures extends Record<string, any> = Record<string, any>\n> {\n  // context is technically private, but some tools depend on it so we can't mangle the name\n  // _ctx below is a clone of this property that we use internally\n  private context: Context;\n  public debug: boolean;\n  public ready: boolean;\n  public version: string;\n\n  // Properties and methods that start with \"_\" are mangled by Terser (saves ~150 bytes)\n  private _ctx: Context;\n  private _renderer: null | RenderFunction;\n  private _redirectedUrl: string;\n  private _trackedExperiments: Set<string>;\n  private _completedChangeIds: Set<string>;\n  private _trackedFeatures: Record<string, string>;\n  private _subscriptions: Set<SubscriptionFunction>;\n  private _rtQueue: RealtimeUsageData[];\n  private _rtTimer: number;\n  private _assigned: Map<\n    string,\n    {\n      // eslint-disable-next-line\n      experiment: Experiment<any>;\n      // eslint-disable-next-line\n      result: Result<any>;\n    }\n  >;\n  // eslint-disable-next-line\n  private _forcedFeatureValues: Map<string, any>;\n  private _attributeOverrides: Attributes;\n  private _activeAutoExperiments: Map<\n    AutoExperiment,\n    { valueHash: string; undo: () => void }\n  >;\n  private _triggeredExpKeys: Set<string>;\n  private _initialized: boolean;\n  private _deferredTrackingCalls: Map<string, TrackingData>;\n\n  private _payload: FeatureApiResponse | undefined;\n  private _decryptedPayload: FeatureApiResponse | undefined;\n\n  private _autoExperimentsAllowed: boolean;\n\n  constructor(context?: Context) {\n    context = context || {};\n    // These properties are all initialized in the constructor instead of above\n    // This saves ~80 bytes in the final output\n    this.version = SDK_VERSION;\n    this._ctx = this.context = context;\n    this._renderer = context.renderer || null;\n    this._trackedExperiments = new Set();\n    this._completedChangeIds = new Set();\n    this._trackedFeatures = {};\n    this.debug = !!context.debug;\n    this._subscriptions = new Set();\n    this._rtQueue = [];\n    this._rtTimer = 0;\n    this.ready = false;\n    this._assigned = new Map();\n    this._forcedFeatureValues = new Map();\n    this._attributeOverrides = {};\n    this._activeAutoExperiments = new Map();\n    this._triggeredExpKeys = new Set();\n    this._initialized = false;\n    this._redirectedUrl = \"\";\n    this._deferredTrackingCalls = new Map();\n    this._autoExperimentsAllowed = !context.disableExperimentsOnLoad;\n\n    if (context.remoteEval) {\n      if (context.decryptionKey) {\n        throw new Error(\"Encryption is not available for remoteEval\");\n      }\n      if (!context.clientKey) {\n        throw new Error(\"Missing clientKey\");\n      }\n      let isGbHost = false;\n      try {\n        isGbHost = !!new URL(context.apiHost || \"\").hostname.match(\n          /growthbook\\.io$/i\n        );\n      } catch (e) {\n        // ignore invalid URLs\n      }\n      if (isGbHost) {\n        throw new Error(\"Cannot use remoteEval on GrowthBook Cloud\");\n      }\n    } else {\n      if (context.cacheKeyAttributes) {\n        throw new Error(\"cacheKeyAttributes are only used for remoteEval\");\n      }\n    }\n\n    if (context.features) {\n      this.ready = true;\n    }\n\n    if (isBrowser && context.enableDevMode) {\n      window._growthbook = this;\n      document.dispatchEvent(new Event(\"gbloaded\"));\n    }\n\n    if (context.experiments) {\n      this.ready = true;\n      this._updateAllAutoExperiments();\n    } else if (context.antiFlicker) {\n      this._setAntiFlicker();\n    }\n\n    // Hydrate sticky bucket service\n    if (this._ctx.stickyBucketService && this._ctx.stickyBucketAssignmentDocs) {\n      for (const key in this._ctx.stickyBucketAssignmentDocs) {\n        const doc = this._ctx.stickyBucketAssignmentDocs[key];\n        if (doc) {\n          this._ctx.stickyBucketService.saveAssignments(doc).catch(() => {\n            // Ignore hydration errors\n          });\n        }\n      }\n    }\n\n    // Legacy - passing in features/experiments into the constructor instead of using init\n    if (this.ready) {\n      this.refreshStickyBuckets(this.getPayload());\n    }\n  }\n\n  public async setPayload(payload: FeatureApiResponse): Promise<void> {\n    this._payload = payload;\n    const data = await this.decryptPayload(payload);\n    this._decryptedPayload = data;\n    await this.refreshStickyBuckets(data);\n    if (data.features) {\n      this._ctx.features = data.features;\n    }\n    if (data.experiments) {\n      this._ctx.experiments = data.experiments;\n      this._updateAllAutoExperiments();\n    }\n    this.ready = true;\n    this._render();\n  }\n\n  public initSync(options: InitSyncOptions): GrowthBook {\n    this._initialized = true;\n\n    const payload = options.payload;\n\n    if (payload.encryptedExperiments || payload.encryptedFeatures) {\n      throw new Error(\"initSync does not support encrypted payloads\");\n    }\n\n    if (\n      this._ctx.stickyBucketService &&\n      !this._ctx.stickyBucketAssignmentDocs\n    ) {\n      throw new Error(\n        \"initSync requires you to pass stickyBucketAssignmentDocs into the GrowthBook constructor\"\n      );\n    }\n\n    this._payload = payload;\n    this._decryptedPayload = payload;\n    if (payload.features) {\n      this._ctx.features = payload.features;\n    }\n    if (payload.experiments) {\n      this._ctx.experiments = payload.experiments;\n      this._updateAllAutoExperiments();\n    }\n\n    this.ready = true;\n\n    if (options.streaming) {\n      if (!this._ctx.clientKey) {\n        throw new Error(\"Must specify clientKey to enable streaming\");\n      }\n      startAutoRefresh(this, true);\n      subscribe(this);\n    }\n\n    return this;\n  }\n\n  public async init(options?: InitOptions): Promise<InitResponse> {\n    this._initialized = true;\n\n    options = options || {};\n    if (options.payload) {\n      await this.setPayload(options.payload);\n      if (options.streaming) {\n        if (!this._ctx.clientKey) {\n          throw new Error(\"Must specify clientKey to enable streaming\");\n        }\n        startAutoRefresh(this, true);\n        subscribe(this);\n      }\n\n      return {\n        success: true,\n        source: \"init\",\n      };\n    } else {\n      const { data, ...res } = await this._refresh({\n        ...options,\n        allowStale: true,\n      });\n      if (options.streaming) {\n        subscribe(this);\n      }\n\n      await this.setPayload(data || {});\n      return res;\n    }\n  }\n\n  /** @deprecated Use {@link init} */\n  public async loadFeatures(options?: LoadFeaturesOptions): Promise<void> {\n    this._initialized = true;\n\n    options = options || {};\n    if (options.autoRefresh) {\n      // interpret deprecated autoRefresh option as subscribeToChanges\n      this._ctx.subscribeToChanges = true;\n    }\n    const { data } = await this._refresh({\n      ...options,\n      allowStale: true,\n    });\n    await this.setPayload(data || {});\n\n    if (this._canSubscribe()) {\n      subscribe(this);\n    }\n  }\n\n  public async refreshFeatures(\n    options?: RefreshFeaturesOptions\n  ): Promise<void> {\n    const res = await this._refresh({\n      ...(options || {}),\n      allowStale: false,\n    });\n    if (res.data) {\n      await this.setPayload(res.data);\n    }\n  }\n\n  public getApiInfo(): [ApiHost, ClientKey] {\n    return [this.getApiHosts().apiHost, this.getClientKey()];\n  }\n  public getApiHosts(): {\n    apiHost: string;\n    streamingHost: string;\n    apiRequestHeaders?: Record<string, string>;\n    streamingHostRequestHeaders?: Record<string, string>;\n  } {\n    const defaultHost = this._ctx.apiHost || \"https://cdn.growthbook.io\";\n    return {\n      apiHost: defaultHost.replace(/\\/*$/, \"\"),\n      streamingHost: (this._ctx.streamingHost || defaultHost).replace(\n        /\\/*$/,\n        \"\"\n      ),\n      apiRequestHeaders: this._ctx.apiHostRequestHeaders,\n      streamingHostRequestHeaders: this._ctx.streamingHostRequestHeaders,\n    };\n  }\n  public getClientKey(): string {\n    return this._ctx.clientKey || \"\";\n  }\n  public getPayload(): FeatureApiResponse {\n    return (\n      this._payload || {\n        features: this.getFeatures(),\n        experiments: this.getExperiments(),\n      }\n    );\n  }\n  public getDecryptedPayload(): FeatureApiResponse {\n    return this._decryptedPayload || this.getPayload();\n  }\n\n  public isRemoteEval(): boolean {\n    return this._ctx.remoteEval || false;\n  }\n\n  public getCacheKeyAttributes(): (keyof Attributes)[] | undefined {\n    return this._ctx.cacheKeyAttributes;\n  }\n\n  private async _refresh({\n    timeout,\n    skipCache,\n    allowStale,\n    streaming,\n  }: RefreshFeaturesOptions & {\n    allowStale?: boolean;\n    streaming?: boolean;\n  }) {\n    if (!this._ctx.clientKey) {\n      throw new Error(\"Missing clientKey\");\n    }\n    // Trigger refresh in feature repository\n    return refreshFeatures({\n      instance: this,\n      timeout,\n      skipCache: skipCache || this._ctx.disableCache,\n      allowStale,\n      backgroundSync: streaming ?? this._ctx.backgroundSync ?? true,\n    });\n  }\n\n  private _render() {\n    if (this._renderer) {\n      try {\n        this._renderer();\n      } catch (e) {\n        console.error(\"Failed to render\", e);\n      }\n    }\n  }\n\n  /** @deprecated Use {@link setPayload} */\n  public setFeatures(features: Record<string, FeatureDefinition>) {\n    this._ctx.features = features;\n    this.ready = true;\n    this._render();\n  }\n\n  /** @deprecated Use {@link setPayload} */\n  public async setEncryptedFeatures(\n    encryptedString: string,\n    decryptionKey?: string,\n    subtle?: SubtleCrypto\n  ): Promise<void> {\n    const featuresJSON = await decrypt(\n      encryptedString,\n      decryptionKey || this._ctx.decryptionKey,\n      subtle\n    );\n    this.setFeatures(\n      JSON.parse(featuresJSON) as Record<string, FeatureDefinition>\n    );\n  }\n\n  /** @deprecated Use {@link setPayload} */\n  public setExperiments(experiments: AutoExperiment[]): void {\n    this._ctx.experiments = experiments;\n    this.ready = true;\n    this._updateAllAutoExperiments();\n  }\n\n  /** @deprecated Use {@link setPayload} */\n  public async setEncryptedExperiments(\n    encryptedString: string,\n    decryptionKey?: string,\n    subtle?: SubtleCrypto\n  ): Promise<void> {\n    const experimentsJSON = await decrypt(\n      encryptedString,\n      decryptionKey || this._ctx.decryptionKey,\n      subtle\n    );\n    this.setExperiments(JSON.parse(experimentsJSON) as AutoExperiment[]);\n  }\n\n  public async decryptPayload(\n    data: FeatureApiResponse,\n    decryptionKey?: string,\n    subtle?: SubtleCrypto\n  ): Promise<FeatureApiResponse> {\n    data = { ...data };\n    if (data.encryptedFeatures) {\n      data.features = JSON.parse(\n        await decrypt(\n          data.encryptedFeatures,\n          decryptionKey || this._ctx.decryptionKey,\n          subtle\n        )\n      );\n      delete data.encryptedFeatures;\n    }\n    if (data.encryptedExperiments) {\n      data.experiments = JSON.parse(\n        await decrypt(\n          data.encryptedExperiments,\n          decryptionKey || this._ctx.decryptionKey,\n          subtle\n        )\n      );\n      delete data.encryptedExperiments;\n    }\n    return data;\n  }\n\n  public async setAttributes(attributes: Attributes) {\n    this._ctx.attributes = attributes;\n    if (this._ctx.stickyBucketService) {\n      await this.refreshStickyBuckets();\n    }\n    if (this._ctx.remoteEval) {\n      await this._refreshForRemoteEval();\n      return;\n    }\n    this._render();\n    this._updateAllAutoExperiments();\n  }\n\n  public async updateAttributes(attributes: Attributes) {\n    return this.setAttributes({ ...this._ctx.attributes, ...attributes });\n  }\n\n  public async setAttributeOverrides(overrides: Attributes) {\n    this._attributeOverrides = overrides;\n    if (this._ctx.stickyBucketService) {\n      await this.refreshStickyBuckets();\n    }\n    if (this._ctx.remoteEval) {\n      await this._refreshForRemoteEval();\n      return;\n    }\n    this._render();\n    this._updateAllAutoExperiments();\n  }\n\n  public async setForcedVariations(vars: Record<string, number>) {\n    this._ctx.forcedVariations = vars || {};\n    if (this._ctx.remoteEval) {\n      await this._refreshForRemoteEval();\n      return;\n    }\n    this._render();\n    this._updateAllAutoExperiments();\n  }\n\n  // eslint-disable-next-line\n  public setForcedFeatures(map: Map<string, any>) {\n    this._forcedFeatureValues = map;\n    this._render();\n  }\n\n  public async setURL(url: string) {\n    this._ctx.url = url;\n    this._redirectedUrl = \"\";\n    if (this._ctx.remoteEval) {\n      await this._refreshForRemoteEval();\n      this._updateAllAutoExperiments(true);\n      return;\n    }\n    this._updateAllAutoExperiments(true);\n  }\n\n  public getAttributes() {\n    return { ...this._ctx.attributes, ...this._attributeOverrides };\n  }\n\n  public getForcedVariations() {\n    return this._ctx.forcedVariations || {};\n  }\n\n  public getForcedFeatures() {\n    // eslint-disable-next-line\n    return this._forcedFeatureValues || new Map<string, any>();\n  }\n\n  public getStickyBucketAssignmentDocs() {\n    return this._ctx.stickyBucketAssignmentDocs || {};\n  }\n\n  public getUrl() {\n    return this._ctx.url || \"\";\n  }\n\n  public getFeatures() {\n    return this._ctx.features || {};\n  }\n\n  public getExperiments() {\n    return this._ctx.experiments || [];\n  }\n\n  public getCompletedChangeIds(): string[] {\n    return Array.from(this._completedChangeIds);\n  }\n\n  public subscribe(cb: SubscriptionFunction): () => void {\n    this._subscriptions.add(cb);\n    return () => {\n      this._subscriptions.delete(cb);\n    };\n  }\n\n  private _canSubscribe() {\n    return (this._ctx.backgroundSync ?? true) && this._ctx.subscribeToChanges;\n  }\n\n  private async _refreshForRemoteEval() {\n    if (!this._ctx.remoteEval) return;\n    if (!this._initialized) return;\n    const res = await this._refresh({\n      allowStale: false,\n    });\n    if (res.data) {\n      await this.setPayload(res.data);\n    }\n  }\n\n  public getAllResults() {\n    return new Map(this._assigned);\n  }\n\n  public destroy() {\n    // Release references to save memory\n    this._subscriptions.clear();\n    this._assigned.clear();\n    this._trackedExperiments.clear();\n    this._completedChangeIds.clear();\n    this._deferredTrackingCalls.clear();\n    this._trackedFeatures = {};\n    this._rtQueue = [];\n    this._payload = undefined;\n    if (this._rtTimer) {\n      clearTimeout(this._rtTimer);\n    }\n    unsubscribe(this);\n\n    if (isBrowser && window._growthbook === this) {\n      delete window._growthbook;\n    }\n\n    // Undo any active auto experiments\n    this._activeAutoExperiments.forEach((exp) => {\n      exp.undo();\n    });\n    this._activeAutoExperiments.clear();\n    this._triggeredExpKeys.clear();\n  }\n\n  public setRenderer(renderer: null | RenderFunction) {\n    this._renderer = renderer;\n  }\n\n  public forceVariation(key: string, variation: number) {\n    this._ctx.forcedVariations = this._ctx.forcedVariations || {};\n    this._ctx.forcedVariations[key] = variation;\n    if (this._ctx.remoteEval) {\n      this._refreshForRemoteEval();\n      return;\n    }\n    this._updateAllAutoExperiments();\n    this._render();\n  }\n\n  public run<T>(experiment: Experiment<T>): Result<T> {\n    const result = this._run(experiment, null);\n    this._fireSubscriptions(experiment, result);\n    return result;\n  }\n\n  public triggerExperiment(key: string) {\n    this._triggeredExpKeys.add(key);\n    if (!this._ctx.experiments) return null;\n    const experiments = this._ctx.experiments.filter((exp) => exp.key === key);\n    return experiments\n      .map((exp) => {\n        return this._runAutoExperiment(exp);\n      })\n      .filter((res) => res !== null);\n  }\n\n  public triggerAutoExperiments() {\n    this._autoExperimentsAllowed = true;\n    this._updateAllAutoExperiments(true);\n  }\n\n  private _runAutoExperiment(experiment: AutoExperiment, forceRerun?: boolean) {\n    const existing = this._activeAutoExperiments.get(experiment);\n\n    // If this is a manual experiment and it's not already running, skip\n    if (\n      experiment.manual &&\n      !this._triggeredExpKeys.has(experiment.key) &&\n      !existing\n    )\n      return null;\n\n    // Check if this particular experiment is blocked by context settings\n    // For example, if all visualEditor experiments are disabled\n    const isBlocked = this._isAutoExperimentBlockedByContext(experiment);\n    if (isBlocked) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Auto experiment blocked\", { id: experiment.key });\n    }\n\n    // Run the experiment (if blocked exclude)\n    const result = isBlocked\n      ? this._getResult(experiment, -1, false, \"\")\n      : this.run(experiment);\n\n    // A hash to quickly tell if the assigned value changed\n    const valueHash = JSON.stringify(result.value);\n\n    // If the changes are already active, no need to re-apply them\n    if (\n      !forceRerun &&\n      result.inExperiment &&\n      existing &&\n      existing.valueHash === valueHash\n    ) {\n      return result;\n    }\n\n    // Undo any existing changes\n    if (existing) this._undoActiveAutoExperiment(experiment);\n\n    // Apply new changes\n    if (result.inExperiment) {\n      const changeType = getAutoExperimentChangeType(experiment);\n\n      if (\n        changeType === \"redirect\" &&\n        result.value.urlRedirect &&\n        experiment.urlPatterns\n      ) {\n        const url = experiment.persistQueryString\n          ? mergeQueryStrings(this._getContextUrl(), result.value.urlRedirect)\n          : result.value.urlRedirect;\n\n        if (isURLTargeted(url, experiment.urlPatterns)) {\n          this.log(\n            \"Skipping redirect because original URL matches redirect URL\",\n            {\n              id: experiment.key,\n            }\n          );\n          return result;\n        }\n        this._redirectedUrl = url;\n        const navigate = this._getNavigateFunction();\n        if (navigate) {\n          if (isBrowser) {\n            this._setAntiFlicker();\n            window.setTimeout(() => {\n              try {\n                navigate(url);\n              } catch (e) {\n                console.error(e);\n              }\n            }, this._ctx.navigateDelay ?? 100);\n          } else {\n            try {\n              navigate(url);\n            } catch (e) {\n              console.error(e);\n            }\n          }\n        }\n      } else if (changeType === \"visual\") {\n        const undo = this._ctx.applyDomChangesCallback\n          ? this._ctx.applyDomChangesCallback(result.value)\n          : this._applyDOMChanges(result.value);\n        if (undo) {\n          this._activeAutoExperiments.set(experiment, {\n            undo,\n            valueHash,\n          });\n        }\n      }\n    }\n\n    return result;\n  }\n\n  private _undoActiveAutoExperiment(exp: AutoExperiment) {\n    const data = this._activeAutoExperiments.get(exp);\n    if (data) {\n      data.undo();\n      this._activeAutoExperiments.delete(exp);\n    }\n  }\n\n  private _updateAllAutoExperiments(forceRerun?: boolean) {\n    if (!this._autoExperimentsAllowed) return;\n\n    const experiments = this._ctx.experiments || [];\n\n    // Stop any experiments that are no longer defined\n    const keys = new Set(experiments);\n    this._activeAutoExperiments.forEach((v, k) => {\n      if (!keys.has(k)) {\n        v.undo();\n        this._activeAutoExperiments.delete(k);\n      }\n    });\n\n    // Re-run all new/updated experiments\n    for (const exp of experiments) {\n      const result = this._runAutoExperiment(exp, forceRerun);\n\n      // Once you're in a redirect experiment, break out of the loop and don't run any further experiments\n      if (\n        result?.inExperiment &&\n        getAutoExperimentChangeType(exp) === \"redirect\"\n      ) {\n        break;\n      }\n    }\n  }\n\n  private _fireSubscriptions<T>(experiment: Experiment<T>, result: Result<T>) {\n    const key = experiment.key;\n\n    // If assigned variation has changed, fire subscriptions\n    const prev = this._assigned.get(key);\n    // TODO: what if the experiment definition has changed?\n    if (\n      !prev ||\n      prev.result.inExperiment !== result.inExperiment ||\n      prev.result.variationId !== result.variationId\n    ) {\n      this._assigned.set(key, { experiment, result });\n      this._subscriptions.forEach((cb) => {\n        try {\n          cb(experiment, result);\n        } catch (e) {\n          console.error(e);\n        }\n      });\n    }\n  }\n\n  private _trackFeatureUsage(key: string, res: FeatureResult): void {\n    // Don't track feature usage that was forced via an override\n    if (res.source === \"override\") return;\n\n    // Only track a feature once, unless the assigned value changed\n    const stringifiedValue = JSON.stringify(res.value);\n    if (this._trackedFeatures[key] === stringifiedValue) return;\n    this._trackedFeatures[key] = stringifiedValue;\n\n    // Fire user-supplied callback\n    if (this._ctx.onFeatureUsage) {\n      try {\n        this._ctx.onFeatureUsage(key, res);\n      } catch (e) {\n        // Ignore feature usage callback errors\n      }\n    }\n\n    // In browser environments, queue up feature usage to be tracked in batches\n    if (!isBrowser || !window.fetch) return;\n    this._rtQueue.push({\n      key,\n      on: res.on,\n    });\n    if (!this._rtTimer) {\n      this._rtTimer = window.setTimeout(() => {\n        // Reset the queue\n        this._rtTimer = 0;\n        const q = [...this._rtQueue];\n        this._rtQueue = [];\n\n        // Skip logging if a real-time usage key is not configured\n        if (!this._ctx.realtimeKey) return;\n\n        window\n          .fetch(\n            `https://rt.growthbook.io/?key=${\n              this._ctx.realtimeKey\n            }&events=${encodeURIComponent(JSON.stringify(q))}`,\n\n            {\n              cache: \"no-cache\",\n              mode: \"no-cors\",\n            }\n          )\n          .catch(() => {\n            // TODO: retry in case of network errors?\n          });\n      }, this._ctx.realtimeInterval || 2000);\n    }\n  }\n\n  private _getFeatureResult<T>(\n    key: string,\n    value: T,\n    source: FeatureResultSource,\n    ruleId?: string,\n    experiment?: Experiment<T>,\n    result?: Result<T>\n  ): FeatureResult<T> {\n    const ret: FeatureResult = {\n      value,\n      on: !!value,\n      off: !value,\n      source,\n      ruleId: ruleId || \"\",\n    };\n    if (experiment) ret.experiment = experiment;\n    if (result) ret.experimentResult = result;\n\n    // Track the usage of this feature in real-time\n    this._trackFeatureUsage(key, ret);\n\n    return ret;\n  }\n\n  public isOn<K extends string & keyof AppFeatures = string>(key: K): boolean {\n    return this.evalFeature(key).on;\n  }\n\n  public isOff<K extends string & keyof AppFeatures = string>(key: K): boolean {\n    return this.evalFeature(key).off;\n  }\n\n  public getFeatureValue<\n    V extends AppFeatures[K],\n    K extends string & keyof AppFeatures = string\n  >(key: K, defaultValue: V): WidenPrimitives<V> {\n    const value = this.evalFeature<WidenPrimitives<V>, K>(key).value;\n    return value === null ? (defaultValue as WidenPrimitives<V>) : value;\n  }\n\n  /**\n   * @deprecated Use {@link evalFeature}\n   * @param id\n   */\n  // eslint-disable-next-line\n  public feature<\n    V extends AppFeatures[K],\n    K extends string & keyof AppFeatures = string\n  >(id: K): FeatureResult<V | null> {\n    return this.evalFeature(id);\n  }\n\n  public evalFeature<\n    V extends AppFeatures[K],\n    K extends string & keyof AppFeatures = string\n  >(id: K): FeatureResult<V | null> {\n    return this._evalFeature(id);\n  }\n\n  private _evalFeature<\n    V extends AppFeatures[K],\n    K extends string & keyof AppFeatures = string\n  >(id: K, evalCtx?: FeatureEvalContext): FeatureResult<V | null> {\n    evalCtx = evalCtx || { evaluatedFeatures: new Set() };\n\n    if (evalCtx.evaluatedFeatures.has(id)) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\n          `evalFeature: circular dependency detected: ${evalCtx.id} -> ${id}`,\n          { from: evalCtx.id, to: id }\n        );\n      return this._getFeatureResult(id, null, \"cyclicPrerequisite\");\n    }\n    evalCtx.evaluatedFeatures.add(id);\n    evalCtx.id = id;\n\n    // Global override\n    if (this._forcedFeatureValues.has(id)) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Global override\", {\n          id,\n          value: this._forcedFeatureValues.get(id),\n        });\n      return this._getFeatureResult(\n        id,\n        this._forcedFeatureValues.get(id),\n        \"override\"\n      );\n    }\n\n    // Unknown feature id\n    if (!this._ctx.features || !this._ctx.features[id]) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Unknown feature\", { id });\n      return this._getFeatureResult(id, null, \"unknownFeature\");\n    }\n\n    // Get the feature\n    const feature: FeatureDefinition<V> = this._ctx.features[id];\n\n    // Loop through the rules\n    if (feature.rules) {\n      rules: for (const rule of feature.rules) {\n        // If there are prerequisite flag(s), evaluate them\n        if (rule.parentConditions) {\n          for (const parentCondition of rule.parentConditions) {\n            const parentResult = this._evalFeature(parentCondition.id, evalCtx);\n            // break out for cyclic prerequisites\n            if (parentResult.source === \"cyclicPrerequisite\") {\n              return this._getFeatureResult(id, null, \"cyclicPrerequisite\");\n            }\n\n            const evalObj = { value: parentResult.value };\n            const evaled = evalCondition(\n              evalObj,\n              parentCondition.condition || {}\n            );\n            if (!evaled) {\n              // blocking prerequisite eval failed: feature evaluation fails\n              if (parentCondition.gate) {\n                process.env.NODE_ENV !== \"production\" &&\n                  this.log(\"Feature blocked by prerequisite\", { id, rule });\n                return this._getFeatureResult(id, null, \"prerequisite\");\n              }\n              // non-blocking prerequisite eval failed: break out of parentConditions loop, jump to the next rule\n              process.env.NODE_ENV !== \"production\" &&\n                this.log(\"Skip rule because prerequisite evaluation fails\", {\n                  id,\n                  rule,\n                });\n              continue rules;\n            }\n          }\n        }\n\n        // If there are filters for who is included (e.g. namespaces)\n        if (rule.filters && this._isFilteredOut(rule.filters)) {\n          process.env.NODE_ENV !== \"production\" &&\n            this.log(\"Skip rule because of filters\", {\n              id,\n              rule,\n            });\n          continue;\n        }\n\n        // Feature value is being forced\n        if (\"force\" in rule) {\n          // If it's a conditional rule, skip if the condition doesn't pass\n          if (rule.condition && !this._conditionPasses(rule.condition)) {\n            process.env.NODE_ENV !== \"production\" &&\n              this.log(\"Skip rule because of condition ff\", {\n                id,\n                rule,\n              });\n            continue;\n          }\n\n          // If this is a percentage rollout, skip if not included\n          if (\n            !this._isIncludedInRollout(\n              rule.seed || id,\n              rule.hashAttribute,\n              this._ctx.stickyBucketService && !rule.disableStickyBucketing\n                ? rule.fallbackAttribute\n                : undefined,\n              rule.range,\n              rule.coverage,\n              rule.hashVersion\n            )\n          ) {\n            process.env.NODE_ENV !== \"production\" &&\n              this.log(\"Skip rule because user not included in rollout\", {\n                id,\n                rule,\n              });\n            continue;\n          }\n\n          process.env.NODE_ENV !== \"production\" &&\n            this.log(\"Force value from rule\", {\n              id,\n              rule,\n            });\n\n          // If this was a remotely evaluated experiment, fire the tracking callbacks\n          if (rule.tracks) {\n            rule.tracks.forEach((t) => {\n              this._track(t.experiment, t.result);\n            });\n          }\n\n          return this._getFeatureResult(id, rule.force as V, \"force\", rule.id);\n        }\n        if (!rule.variations) {\n          process.env.NODE_ENV !== \"production\" &&\n            this.log(\"Skip invalid rule\", {\n              id,\n              rule,\n            });\n\n          continue;\n        }\n\n        // For experiment rules, run an experiment\n        const exp: Experiment<V> = {\n          variations: rule.variations as [V, V, ...V[]],\n          key: rule.key || id,\n        };\n        if (\"coverage\" in rule) exp.coverage = rule.coverage;\n        if (rule.weights) exp.weights = rule.weights;\n        if (rule.hashAttribute) exp.hashAttribute = rule.hashAttribute;\n        if (rule.fallbackAttribute)\n          exp.fallbackAttribute = rule.fallbackAttribute;\n        if (rule.disableStickyBucketing)\n          exp.disableStickyBucketing = rule.disableStickyBucketing;\n        if (rule.bucketVersion !== undefined)\n          exp.bucketVersion = rule.bucketVersion;\n        if (rule.minBucketVersion !== undefined)\n          exp.minBucketVersion = rule.minBucketVersion;\n        if (rule.namespace) exp.namespace = rule.namespace;\n        if (rule.meta) exp.meta = rule.meta;\n        if (rule.ranges) exp.ranges = rule.ranges;\n        if (rule.name) exp.name = rule.name;\n        if (rule.phase) exp.phase = rule.phase;\n        if (rule.seed) exp.seed = rule.seed;\n        if (rule.hashVersion) exp.hashVersion = rule.hashVersion;\n        if (rule.filters) exp.filters = rule.filters;\n        if (rule.condition) exp.condition = rule.condition;\n\n        // Only return a value if the user is part of the experiment\n        const res = this._run(exp, id);\n        this._fireSubscriptions(exp, res);\n        if (res.inExperiment && !res.passthrough) {\n          return this._getFeatureResult(\n            id,\n            res.value,\n            \"experiment\",\n            rule.id,\n            exp,\n            res\n          );\n        }\n      }\n    }\n\n    process.env.NODE_ENV !== \"production\" &&\n      this.log(\"Use default value\", {\n        id,\n        value: feature.defaultValue,\n      });\n\n    // Fall back to using the default value\n    return this._getFeatureResult(\n      id,\n      feature.defaultValue === undefined ? null : feature.defaultValue,\n      \"defaultValue\"\n    );\n  }\n\n  private _isIncludedInRollout(\n    seed: string,\n    hashAttribute: string | undefined,\n    fallbackAttribute: string | undefined,\n    range: VariationRange | undefined,\n    coverage: number | undefined,\n    hashVersion: number | undefined\n  ): boolean {\n    if (!range && coverage === undefined) return true;\n\n    if (!range && coverage === 0) return false;\n\n    const { hashValue } = this._getHashAttribute(\n      hashAttribute,\n      fallbackAttribute\n    );\n    if (!hashValue) {\n      return false;\n    }\n\n    const n = hash(seed, hashValue, hashVersion || 1);\n    if (n === null) return false;\n\n    return range\n      ? inRange(n, range)\n      : coverage !== undefined\n      ? n <= coverage\n      : true;\n  }\n\n  private _conditionPasses(condition: ConditionInterface): boolean {\n    return evalCondition(this.getAttributes(), condition);\n  }\n\n  private _isFilteredOut(filters: Filter[]): boolean {\n    return filters.some((filter) => {\n      const { hashValue } = this._getHashAttribute(filter.attribute);\n      if (!hashValue) return true;\n      const n = hash(filter.seed, hashValue, filter.hashVersion || 2);\n      if (n === null) return true;\n      return !filter.ranges.some((r) => inRange(n, r));\n    });\n  }\n\n  private _run<T>(\n    experiment: Experiment<T>,\n    featureId: string | null\n  ): Result<T> {\n    const key = experiment.key;\n    const numVariations = experiment.variations.length;\n\n    // 1. If experiment has less than 2 variations, return immediately\n    if (numVariations < 2) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Invalid experiment\", { id: key });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 2. If the context is disabled, return immediately\n    if (this._ctx.enabled === false) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Context disabled\", { id: key });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 2.5. Merge in experiment overrides from the context\n    experiment = this._mergeOverrides(experiment);\n\n    // 2.6 New, more powerful URL targeting\n    if (\n      experiment.urlPatterns &&\n      !isURLTargeted(this._getContextUrl(), experiment.urlPatterns)\n    ) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of url targeting\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 3. If a variation is forced from a querystring, return the forced variation\n    const qsOverride = getQueryStringOverride(\n      key,\n      this._getContextUrl(),\n      numVariations\n    );\n    if (qsOverride !== null) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Force via querystring\", {\n          id: key,\n          variation: qsOverride,\n        });\n      return this._getResult(experiment, qsOverride, false, featureId);\n    }\n\n    // 4. If a variation is forced in the context, return the forced variation\n    if (this._ctx.forcedVariations && key in this._ctx.forcedVariations) {\n      const variation = this._ctx.forcedVariations[key];\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Force via dev tools\", {\n          id: key,\n          variation,\n        });\n      return this._getResult(experiment, variation, false, featureId);\n    }\n\n    // 5. Exclude if a draft experiment or not active\n    if (experiment.status === \"draft\" || experiment.active === false) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because inactive\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 6. Get the hash attribute and return if empty\n    const { hashAttribute, hashValue } = this._getHashAttribute(\n      experiment.hashAttribute,\n      this._ctx.stickyBucketService && !experiment.disableStickyBucketing\n        ? experiment.fallbackAttribute\n        : undefined\n    );\n    if (!hashValue) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because missing hashAttribute\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    let assigned = -1;\n\n    let foundStickyBucket = false;\n    let stickyBucketVersionIsBlocked = false;\n    if (this._ctx.stickyBucketService && !experiment.disableStickyBucketing) {\n      const { variation, versionIsBlocked } = this._getStickyBucketVariation({\n        expKey: experiment.key,\n        expBucketVersion: experiment.bucketVersion,\n        expHashAttribute: experiment.hashAttribute,\n        expFallbackAttribute: experiment.fallbackAttribute,\n        expMinBucketVersion: experiment.minBucketVersion,\n        expMeta: experiment.meta,\n      });\n      foundStickyBucket = variation >= 0;\n      assigned = variation;\n      stickyBucketVersionIsBlocked = !!versionIsBlocked;\n    }\n\n    // Some checks are not needed if we already have a sticky bucket\n    if (!foundStickyBucket) {\n      // 7. Exclude if user is filtered out (used to be called \"namespace\")\n      if (experiment.filters) {\n        if (this._isFilteredOut(experiment.filters)) {\n          process.env.NODE_ENV !== \"production\" &&\n            this.log(\"Skip because of filters\", {\n              id: key,\n            });\n          return this._getResult(experiment, -1, false, featureId);\n        }\n      } else if (\n        experiment.namespace &&\n        !inNamespace(hashValue, experiment.namespace)\n      ) {\n        process.env.NODE_ENV !== \"production\" &&\n          this.log(\"Skip because of namespace\", {\n            id: key,\n          });\n        return this._getResult(experiment, -1, false, featureId);\n      }\n\n      // 7.5. Exclude if experiment.include returns false or throws\n      if (experiment.include && !isIncluded(experiment.include)) {\n        process.env.NODE_ENV !== \"production\" &&\n          this.log(\"Skip because of include function\", {\n            id: key,\n          });\n        return this._getResult(experiment, -1, false, featureId);\n      }\n\n      // 8. Exclude if condition is false\n      if (\n        experiment.condition &&\n        !this._conditionPasses(experiment.condition)\n      ) {\n        process.env.NODE_ENV !== \"production\" &&\n          this.log(\"Skip because of condition exp\", {\n            id: key,\n          });\n        return this._getResult(experiment, -1, false, featureId);\n      }\n\n      // 8.05. Exclude if prerequisites are not met\n      if (experiment.parentConditions) {\n        for (const parentCondition of experiment.parentConditions) {\n          const parentResult = this._evalFeature(parentCondition.id);\n          // break out for cyclic prerequisites\n          if (parentResult.source === \"cyclicPrerequisite\") {\n            return this._getResult(experiment, -1, false, featureId);\n          }\n\n          const evalObj = { value: parentResult.value };\n          if (!evalCondition(evalObj, parentCondition.condition || {})) {\n            process.env.NODE_ENV !== \"production\" &&\n              this.log(\"Skip because prerequisite evaluation fails\", {\n                id: key,\n              });\n            return this._getResult(experiment, -1, false, featureId);\n          }\n        }\n      }\n\n      // 8.1. Exclude if user is not in a required group\n      if (\n        experiment.groups &&\n        !this._hasGroupOverlap(experiment.groups as string[])\n      ) {\n        process.env.NODE_ENV !== \"production\" &&\n          this.log(\"Skip because of groups\", {\n            id: key,\n          });\n        return this._getResult(experiment, -1, false, featureId);\n      }\n    }\n\n    // 8.2. Old style URL targeting\n    if (experiment.url && !this._urlIsValid(experiment.url as RegExp)) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of url\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 9. Get the variation from the sticky bucket or get bucket ranges and choose variation\n    const n = hash(\n      experiment.seed || key,\n      hashValue,\n      experiment.hashVersion || 1\n    );\n    if (n === null) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of invalid hash version\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    if (!foundStickyBucket) {\n      const ranges =\n        experiment.ranges ||\n        getBucketRanges(\n          numVariations,\n          experiment.coverage === undefined ? 1 : experiment.coverage,\n          experiment.weights\n        );\n      assigned = chooseVariation(n, ranges);\n    }\n\n    // 9.5 Unenroll if any prior sticky buckets are blocked by version\n    if (stickyBucketVersionIsBlocked) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because sticky bucket version is blocked\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId, undefined, true);\n    }\n\n    // 10. Return if not in experiment\n    if (assigned < 0) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of coverage\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 11. Experiment has a forced variation\n    if (\"force\" in experiment) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Force variation\", {\n          id: key,\n          variation: experiment.force,\n        });\n      return this._getResult(\n        experiment,\n        experiment.force === undefined ? -1 : experiment.force,\n        false,\n        featureId\n      );\n    }\n\n    // 12. Exclude if in QA mode\n    if (this._ctx.qaMode) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because QA mode\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 12.5. Exclude if experiment is stopped\n    if (experiment.status === \"stopped\") {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because stopped\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 13. Build the result object\n    const result = this._getResult(\n      experiment,\n      assigned,\n      true,\n      featureId,\n      n,\n      foundStickyBucket\n    );\n\n    // 13.5. Persist sticky bucket\n    if (this._ctx.stickyBucketService && !experiment.disableStickyBucketing) {\n      const {\n        changed,\n        key: attrKey,\n        doc,\n      } = this._generateStickyBucketAssignmentDoc(\n        hashAttribute,\n        toString(hashValue),\n        {\n          [this._getStickyBucketExperimentKey(\n            experiment.key,\n            experiment.bucketVersion\n          )]: result.key,\n        }\n      );\n      if (changed) {\n        // update local docs\n        this._ctx.stickyBucketAssignmentDocs =\n          this._ctx.stickyBucketAssignmentDocs || {};\n        this._ctx.stickyBucketAssignmentDocs[attrKey] = doc;\n        // save doc\n        this._ctx.stickyBucketService.saveAssignments(doc);\n      }\n    }\n\n    // 14. Fire the tracking callback\n    this._track(experiment, result);\n\n    // 14.1 Keep track of completed changeIds\n    \"changeId\" in experiment &&\n      experiment.changeId &&\n      this._completedChangeIds.add(experiment.changeId as string);\n\n    // 15. Return the result\n    process.env.NODE_ENV !== \"production\" &&\n      this.log(\"In experiment\", {\n        id: key,\n        variation: result.variationId,\n      });\n    return result;\n  }\n\n  log(msg: string, ctx: Record<string, unknown>) {\n    if (!this.debug) return;\n    if (this._ctx.log) this._ctx.log(msg, ctx);\n    else console.log(msg, ctx);\n  }\n\n  public getDeferredTrackingCalls(): TrackingData[] {\n    return Array.from(this._deferredTrackingCalls.values());\n  }\n\n  public setDeferredTrackingCalls(calls: TrackingData[]) {\n    this._deferredTrackingCalls = new Map(\n      calls\n        .filter((c) => c && c.experiment && c.result)\n        .map((c) => {\n          return [this._getTrackKey(c.experiment, c.result), c];\n        })\n    );\n  }\n\n  public fireDeferredTrackingCalls() {\n    if (!this._ctx.trackingCallback) return;\n\n    this._deferredTrackingCalls.forEach((call: TrackingData) => {\n      if (!call || !call.experiment || !call.result) {\n        console.error(\"Invalid deferred tracking call\", { call: call });\n      } else {\n        this._track(call.experiment, call.result);\n      }\n    });\n\n    this._deferredTrackingCalls.clear();\n  }\n\n  public setTrackingCallback(callback: TrackingCallback) {\n    this._ctx.trackingCallback = callback;\n    this.fireDeferredTrackingCalls();\n  }\n\n  private _getTrackKey(\n    experiment: Experiment<unknown>,\n    result: Result<unknown>\n  ) {\n    return (\n      result.hashAttribute +\n      result.hashValue +\n      experiment.key +\n      result.variationId\n    );\n  }\n\n  private _track<T>(experiment: Experiment<T>, result: Result<T>) {\n    const k = this._getTrackKey(experiment, result);\n\n    if (!this._ctx.trackingCallback) {\n      // Add to deferred tracking if it hasn't already been added\n      if (!this._deferredTrackingCalls.has(k)) {\n        this._deferredTrackingCalls.set(k, { experiment, result });\n      }\n      return;\n    }\n\n    // Make sure a tracking callback is only fired once per unique experiment\n    if (this._trackedExperiments.has(k)) return;\n    this._trackedExperiments.add(k);\n\n    try {\n      this._ctx.trackingCallback(experiment, result);\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  private _mergeOverrides<T>(experiment: Experiment<T>): Experiment<T> {\n    const key = experiment.key;\n    const o = this._ctx.overrides;\n    if (o && o[key]) {\n      experiment = Object.assign({}, experiment, o[key]);\n      if (typeof experiment.url === \"string\") {\n        experiment.url = getUrlRegExp(\n          // eslint-disable-next-line\n          experiment.url as any\n        );\n      }\n    }\n\n    return experiment;\n  }\n\n  private _getHashAttribute(attr?: string, fallback?: string) {\n    let hashAttribute = attr || \"id\";\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    let hashValue: any = \"\";\n\n    if (this._attributeOverrides[hashAttribute]) {\n      hashValue = this._attributeOverrides[hashAttribute];\n    } else if (this._ctx.attributes) {\n      hashValue = this._ctx.attributes[hashAttribute] || \"\";\n    } else if (this._ctx.user) {\n      hashValue = this._ctx.user[hashAttribute] || \"\";\n    }\n\n    // if no match, try fallback\n    if (!hashValue && fallback) {\n      if (this._attributeOverrides[fallback]) {\n        hashValue = this._attributeOverrides[fallback];\n      } else if (this._ctx.attributes) {\n        hashValue = this._ctx.attributes[fallback] || \"\";\n      } else if (this._ctx.user) {\n        hashValue = this._ctx.user[fallback] || \"\";\n      }\n      if (hashValue) {\n        hashAttribute = fallback;\n      }\n    }\n\n    return { hashAttribute, hashValue };\n  }\n\n  private _getResult<T>(\n    experiment: Experiment<T>,\n    variationIndex: number,\n    hashUsed: boolean,\n    featureId: string | null,\n    bucket?: number,\n    stickyBucketUsed?: boolean\n  ): Result<T> {\n    let inExperiment = true;\n    // If assigned variation is not valid, use the baseline and mark the user as not in the experiment\n    if (variationIndex < 0 || variationIndex >= experiment.variations.length) {\n      variationIndex = 0;\n      inExperiment = false;\n    }\n\n    const { hashAttribute, hashValue } = this._getHashAttribute(\n      experiment.hashAttribute,\n      this._ctx.stickyBucketService && !experiment.disableStickyBucketing\n        ? experiment.fallbackAttribute\n        : undefined\n    );\n\n    const meta: Partial<VariationMeta> = experiment.meta\n      ? experiment.meta[variationIndex]\n      : {};\n\n    const res: Result<T> = {\n      key: meta.key || \"\" + variationIndex,\n      featureId,\n      inExperiment,\n      hashUsed,\n      variationId: variationIndex,\n      value: experiment.variations[variationIndex],\n      hashAttribute,\n      hashValue,\n      stickyBucketUsed: !!stickyBucketUsed,\n    };\n\n    if (meta.name) res.name = meta.name;\n    if (bucket !== undefined) res.bucket = bucket;\n    if (meta.passthrough) res.passthrough = meta.passthrough;\n\n    return res;\n  }\n\n  private _getContextUrl() {\n    return this._ctx.url || (isBrowser ? window.location.href : \"\");\n  }\n\n  private _urlIsValid(urlRegex: RegExp): boolean {\n    const url = this._getContextUrl();\n    if (!url) return false;\n\n    const pathOnly = url.replace(/^https?:\\/\\//, \"\").replace(/^[^/]*\\//, \"/\");\n\n    if (urlRegex.test(url)) return true;\n    if (urlRegex.test(pathOnly)) return true;\n    return false;\n  }\n\n  private _hasGroupOverlap(expGroups: string[]): boolean {\n    const groups = this._ctx.groups || {};\n    for (let i = 0; i < expGroups.length; i++) {\n      if (groups[expGroups[i]]) return true;\n    }\n    return false;\n  }\n\n  private _isAutoExperimentBlockedByContext(\n    experiment: AutoExperiment\n  ): boolean {\n    const changeType = getAutoExperimentChangeType(experiment);\n    if (changeType === \"visual\") {\n      if (this._ctx.disableVisualExperiments) return true;\n\n      if (this._ctx.disableJsInjection) {\n        if (experiment.variations.some((v) => v.js)) {\n          return true;\n        }\n      }\n    } else if (changeType === \"redirect\") {\n      if (this._ctx.disableUrlRedirectExperiments) return true;\n\n      // Validate URLs\n      try {\n        const current = new URL(this._getContextUrl());\n        for (const v of experiment.variations) {\n          if (!v || !v.urlRedirect) continue;\n          const url = new URL(v.urlRedirect);\n\n          // If we're blocking cross origin redirects, block if the protocol or host is different\n          if (this._ctx.disableCrossOriginUrlRedirectExperiments) {\n            if (url.protocol !== current.protocol) return true;\n            if (url.host !== current.host) return true;\n          }\n        }\n      } catch (e) {\n        // Problem parsing one of the URLs\n        this.log(\"Error parsing current or redirect URL\", {\n          id: experiment.key,\n          error: e,\n        });\n        return true;\n      }\n    } else {\n      // Block any unknown changeTypes\n      return true;\n    }\n\n    if (\n      experiment.changeId &&\n      (this._ctx.blockedChangeIds || []).includes(experiment.changeId)\n    ) {\n      return true;\n    }\n\n    return false;\n  }\n\n  public getRedirectUrl(): string {\n    return this._redirectedUrl;\n  }\n\n  private _getNavigateFunction():\n    | null\n    | ((url: string) => void | Promise<void>) {\n    if (this._ctx.navigate) {\n      return this._ctx.navigate;\n    } else if (isBrowser) {\n      return (url: string) => {\n        window.location.replace(url);\n      };\n    }\n    return null;\n  }\n\n  private _setAntiFlicker() {\n    if (!this._ctx.antiFlicker || !isBrowser) return;\n    try {\n      const styleTag = document.createElement(\"style\");\n      styleTag.innerHTML =\n        \".gb-anti-flicker { opacity: 0 !important; pointer-events: none; }\";\n      document.head.appendChild(styleTag);\n      document.documentElement.classList.add(\"gb-anti-flicker\");\n\n      // Fallback if GrowthBook fails to load in specified time or 3.5 seconds\n      setTimeout(() => {\n        document.documentElement.classList.remove(\"gb-anti-flicker\");\n      }, this._ctx.antiFlickerTimeout ?? 3500);\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  private _applyDOMChanges(changes: AutoExperimentVariation) {\n    if (!isBrowser) return;\n    const undo: (() => void)[] = [];\n    if (changes.css) {\n      const s = document.createElement(\"style\");\n      s.innerHTML = changes.css;\n      document.head.appendChild(s);\n      undo.push(() => s.remove());\n    }\n    if (changes.js) {\n      const script = document.createElement(\"script\");\n      script.innerHTML = changes.js;\n      if (this._ctx.jsInjectionNonce) {\n        script.nonce = this._ctx.jsInjectionNonce;\n      }\n      document.head.appendChild(script);\n      undo.push(() => script.remove());\n    }\n    if (changes.domMutations) {\n      changes.domMutations.forEach((mutation) => {\n        undo.push(mutate.declarative(mutation as DeclarativeMutation).revert);\n      });\n    }\n    return () => {\n      undo.forEach((fn) => fn());\n    };\n  }\n\n  private _deriveStickyBucketIdentifierAttributes(data?: FeatureApiResponse) {\n    const attributes = new Set<string>();\n    const features = data && data.features ? data.features : this.getFeatures();\n    const experiments =\n      data && data.experiments ? data.experiments : this.getExperiments();\n    Object.keys(features).forEach((id) => {\n      const feature = features[id];\n      if (feature.rules) {\n        for (const rule of feature.rules) {\n          if (rule.variations) {\n            attributes.add(rule.hashAttribute || \"id\");\n            if (rule.fallbackAttribute) {\n              attributes.add(rule.fallbackAttribute);\n            }\n          }\n        }\n      }\n    });\n    experiments.map((experiment) => {\n      attributes.add(experiment.hashAttribute || \"id\");\n      if (experiment.fallbackAttribute) {\n        attributes.add(experiment.fallbackAttribute);\n      }\n    });\n    return Array.from(attributes);\n  }\n\n  public async refreshStickyBuckets(data?: FeatureApiResponse) {\n    if (this._ctx.stickyBucketService) {\n      const attributes = this._getStickyBucketAttributes(data);\n      this._ctx.stickyBucketAssignmentDocs = await this._ctx.stickyBucketService.getAllAssignments(\n        attributes\n      );\n    }\n  }\n\n  private _getStickyBucketAssignments(\n    expHashAttribute: string,\n    expFallbackAttribute?: string\n  ): StickyAssignments {\n    if (!this._ctx.stickyBucketAssignmentDocs) return {};\n    const { hashAttribute, hashValue } = this._getHashAttribute(\n      expHashAttribute\n    );\n    const hashKey = `${hashAttribute}||${toString(hashValue)}`;\n\n    const {\n      hashAttribute: fallbackAttribute,\n      hashValue: fallbackValue,\n    } = this._getHashAttribute(expFallbackAttribute);\n    const fallbackKey = fallbackValue\n      ? `${fallbackAttribute}||${toString(fallbackValue)}`\n      : null;\n\n    const assignments: StickyAssignments = {};\n    if (fallbackKey && this._ctx.stickyBucketAssignmentDocs[fallbackKey]) {\n      Object.assign(\n        assignments,\n        this._ctx.stickyBucketAssignmentDocs[fallbackKey].assignments || {}\n      );\n    }\n    if (this._ctx.stickyBucketAssignmentDocs[hashKey]) {\n      Object.assign(\n        assignments,\n        this._ctx.stickyBucketAssignmentDocs[hashKey].assignments || {}\n      );\n    }\n    return assignments;\n  }\n\n  private _getStickyBucketVariation({\n    expKey,\n    expBucketVersion,\n    expHashAttribute,\n    expFallbackAttribute,\n    expMinBucketVersion,\n    expMeta,\n  }: {\n    expKey: string;\n    expBucketVersion?: number;\n    expHashAttribute?: string;\n    expFallbackAttribute?: string;\n    expMinBucketVersion?: number;\n    expMeta?: VariationMeta[];\n  }): {\n    variation: number;\n    versionIsBlocked?: boolean;\n  } {\n    expBucketVersion = expBucketVersion || 0;\n    expMinBucketVersion = expMinBucketVersion || 0;\n    expHashAttribute = expHashAttribute || \"id\";\n    expMeta = expMeta || [];\n    const id = this._getStickyBucketExperimentKey(expKey, expBucketVersion);\n    const assignments = this._getStickyBucketAssignments(\n      expHashAttribute,\n      expFallbackAttribute\n    );\n\n    // users with any blocked bucket version (0 to minExperimentBucketVersion) are excluded from the test\n    if (expMinBucketVersion > 0) {\n      for (let i = 0; i <= expMinBucketVersion; i++) {\n        const blockedKey = this._getStickyBucketExperimentKey(expKey, i);\n        if (assignments[blockedKey] !== undefined) {\n          return {\n            variation: -1,\n            versionIsBlocked: true,\n          };\n        }\n      }\n    }\n    const variationKey = assignments[id];\n    if (variationKey === undefined)\n      // no assignment found\n      return { variation: -1 };\n    const variation = expMeta.findIndex((m) => m.key === variationKey);\n    if (variation < 0)\n      // invalid assignment, treat as \"no assignment found\"\n      return { variation: -1 };\n\n    return { variation };\n  }\n\n  private _getStickyBucketExperimentKey(\n    experimentKey: string,\n    experimentBucketVersion?: number\n  ): StickyExperimentKey {\n    experimentBucketVersion = experimentBucketVersion || 0;\n    return `${experimentKey}__${experimentBucketVersion}`;\n  }\n\n  private _getStickyBucketAttributes(\n    data?: FeatureApiResponse\n  ): Record<string, string> {\n    const attributes: Record<string, string> = {};\n    this._ctx.stickyBucketIdentifierAttributes = !this._ctx\n      .stickyBucketIdentifierAttributes\n      ? this._deriveStickyBucketIdentifierAttributes(data)\n      : this._ctx.stickyBucketIdentifierAttributes;\n    this._ctx.stickyBucketIdentifierAttributes.forEach((attr) => {\n      const { hashValue } = this._getHashAttribute(attr);\n      attributes[attr] = toString(hashValue);\n    });\n    return attributes;\n  }\n\n  private _generateStickyBucketAssignmentDoc(\n    attributeName: string,\n    attributeValue: string,\n    assignments: StickyAssignments\n  ): {\n    key: StickyAttributeKey;\n    doc: StickyAssignmentsDocument;\n    changed: boolean;\n  } {\n    const key = `${attributeName}||${attributeValue}`;\n    const existingAssignments =\n      this._ctx.stickyBucketAssignmentDocs &&\n      this._ctx.stickyBucketAssignmentDocs[key]\n        ? this._ctx.stickyBucketAssignmentDocs[key].assignments || {}\n        : {};\n    const newAssignments = { ...existingAssignments, ...assignments };\n    const changed =\n      JSON.stringify(existingAssignments) !== JSON.stringify(newAssignments);\n\n    return {\n      key,\n      doc: {\n        attributeName,\n        attributeValue,\n        assignments: newAssignments,\n      },\n      changed,\n    };\n  }\n}\n\nexport async function prefetchPayload(options: PrefetchOptions) {\n  // Create a temporary instance, just to fetch the payload\n  const instance = new GrowthBook(options);\n\n  await refreshFeatures({\n    instance,\n    skipCache: options.skipCache,\n    allowStale: false,\n    backgroundSync: options.streaming,\n  });\n\n  instance.destroy();\n}\n","import {\n  LocalStorageCompat,\n  StickyAssignmentsDocument,\n  StickyAttributeKey,\n} from \"./types/growthbook\";\n\nexport interface CookieAttributes {\n  expires?: number | Date | undefined;\n  path?: string | undefined;\n  domain?: string | undefined;\n  secure?: boolean | undefined;\n  sameSite?: \"strict\" | \"Strict\" | \"lax\" | \"Lax\" | \"none\" | \"None\" | undefined;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  [property: string]: any;\n}\nexport interface JsCookiesCompat<T = string> {\n  set(\n    name: string,\n    value: string | T,\n    options?: CookieAttributes\n  ): string | undefined;\n  get(name: string): string | T | undefined;\n  get(): { [key: string]: string };\n  remove(name: string, options?: CookieAttributes): void;\n}\n\nexport interface IORedisCompat {\n  mget(...keys: string[]): Promise<string[]>;\n  set(key: string, value: string): Promise<string>;\n}\n\nexport interface RequestCompat {\n  cookies: Record<string, string>;\n  [key: string]: unknown;\n}\nexport interface ResponseCompat {\n  cookie(\n    name: string,\n    value: string,\n    options?: CookieAttributes\n  ): ResponseCompat;\n  [key: string]: unknown;\n}\n\n/**\n * Responsible for reading and writing documents which describe sticky bucket assignments.\n */\nexport abstract class StickyBucketService {\n  abstract getAssignments(\n    attributeName: string,\n    attributeValue: string\n  ): Promise<StickyAssignmentsDocument | null>;\n\n  abstract saveAssignments(doc: StickyAssignmentsDocument): Promise<unknown>;\n\n  /**\n   * The SDK calls getAllAssignments to populate sticky buckets. This in turn will\n   * typically loop through individual getAssignments calls. However, some StickyBucketService\n   * instances (i.e. Redis) will instead perform a multi-query inside getAllAssignments instead.\n   */\n  async getAllAssignments(\n    attributes: Record<string, string>\n  ): Promise<Record<StickyAttributeKey, StickyAssignmentsDocument>> {\n    const docs: Record<string, StickyAssignmentsDocument> = {};\n    (\n      await Promise.all(\n        Object.entries(attributes).map(([attributeName, attributeValue]) =>\n          this.getAssignments(attributeName, attributeValue)\n        )\n      )\n    ).forEach((doc) => {\n      if (doc) {\n        const key = `${doc.attributeName}||${doc.attributeValue}`;\n        docs[key] = doc;\n      }\n    });\n    return docs;\n  }\n}\n\nexport class LocalStorageStickyBucketService extends StickyBucketService {\n  private prefix: string;\n  private localStorage: LocalStorageCompat | undefined;\n  constructor(opts?: { prefix?: string; localStorage?: LocalStorageCompat }) {\n    opts = opts || {};\n    super();\n    this.prefix = opts.prefix || \"gbStickyBuckets__\";\n    try {\n      this.localStorage = opts.localStorage || globalThis.localStorage;\n    } catch (e) {\n      // Ignore localStorage errors\n    }\n  }\n  async getAssignments(attributeName: string, attributeValue: string) {\n    const key = `${attributeName}||${attributeValue}`;\n    let doc: StickyAssignmentsDocument | null = null;\n    if (!this.localStorage) return doc;\n    try {\n      const raw = (await this.localStorage.getItem(this.prefix + key)) || \"{}\";\n      const data = JSON.parse(raw);\n      if (data.attributeName && data.attributeValue && data.assignments) {\n        doc = data;\n      }\n    } catch (e) {\n      // Ignore localStorage errors\n    }\n    return doc;\n  }\n  async saveAssignments(doc: StickyAssignmentsDocument) {\n    const key = `${doc.attributeName}||${doc.attributeValue}`;\n    if (!this.localStorage) return;\n    try {\n      await this.localStorage.setItem(this.prefix + key, JSON.stringify(doc));\n    } catch (e) {\n      // Ignore localStorage errors\n    }\n  }\n}\n\nexport class ExpressCookieStickyBucketService extends StickyBucketService {\n  /**\n   * Intended to be used with cookieParser() middleware from npm: 'cookie-parser'.\n   * Assumes:\n   *  - reading a cookie is automatically decoded via decodeURIComponent() or similar\n   *  - writing a cookie name & value must be manually encoded via encodeURIComponent() or similar\n   *  - all cookie bodies are JSON encoded strings and are manually encoded/decoded\n   */\n  private prefix: string;\n  private req: RequestCompat;\n  private res: ResponseCompat;\n  private cookieAttributes: CookieAttributes;\n  constructor({\n    prefix = \"gbStickyBuckets__\",\n    req,\n    res,\n    cookieAttributes = {},\n  }: {\n    prefix?: string;\n    req: RequestCompat;\n    res: ResponseCompat;\n    cookieAttributes?: CookieAttributes;\n  }) {\n    super();\n    this.prefix = prefix;\n    this.req = req;\n    this.res = res;\n    this.cookieAttributes = cookieAttributes;\n  }\n  async getAssignments(attributeName: string, attributeValue: string) {\n    const key = `${attributeName}||${attributeValue}`;\n    let doc: StickyAssignmentsDocument | null = null;\n    if (!this.req) return doc;\n    try {\n      const raw = this.req.cookies[this.prefix + key] || \"{}\";\n      const data = JSON.parse(raw);\n      if (data.attributeName && data.attributeValue && data.assignments) {\n        doc = data;\n      }\n    } catch (e) {\n      // Ignore cookie errors\n    }\n    return doc;\n  }\n  async saveAssignments(doc: StickyAssignmentsDocument) {\n    const key = `${doc.attributeName}||${doc.attributeValue}`;\n    if (!this.res) return;\n    const str = JSON.stringify(doc);\n    this.res.cookie(\n      encodeURIComponent(this.prefix + key),\n      encodeURIComponent(str),\n      this.cookieAttributes\n    );\n  }\n}\n\nexport class BrowserCookieStickyBucketService extends StickyBucketService {\n  /**\n   * Intended to be used with npm: 'js-cookie'.\n   * Assumes:\n   *  - reading a cookie is automatically decoded via decodeURIComponent() or similar\n   *  - writing a cookie name & value is automatically encoded via encodeURIComponent() or similar\n   *  - all cookie bodies are JSON encoded strings and are manually encoded/decoded\n   */\n  private prefix: string;\n  private jsCookie: JsCookiesCompat;\n  private cookieAttributes: CookieAttributes;\n  constructor({\n    prefix = \"gbStickyBuckets__\",\n    jsCookie,\n    cookieAttributes = {},\n  }: {\n    prefix?: string;\n    jsCookie: JsCookiesCompat;\n    cookieAttributes?: CookieAttributes;\n  }) {\n    super();\n    this.prefix = prefix;\n    this.jsCookie = jsCookie;\n    this.cookieAttributes = cookieAttributes;\n  }\n  async getAssignments(attributeName: string, attributeValue: string) {\n    const key = `${attributeName}||${attributeValue}`;\n    let doc: StickyAssignmentsDocument | null = null;\n    if (!this.jsCookie) return doc;\n    try {\n      const raw = this.jsCookie.get(this.prefix + key);\n      const data = JSON.parse(raw || \"{}\");\n      if (data.attributeName && data.attributeValue && data.assignments) {\n        doc = data;\n      }\n    } catch (e) {\n      // Ignore cookie errors\n    }\n    return doc;\n  }\n  async saveAssignments(doc: StickyAssignmentsDocument) {\n    const key = `${doc.attributeName}||${doc.attributeValue}`;\n    if (!this.jsCookie) return;\n    const str = JSON.stringify(doc);\n    this.jsCookie.set(this.prefix + key, str, this.cookieAttributes);\n  }\n}\n\nexport class RedisStickyBucketService extends StickyBucketService {\n  /** Intended to be used with npm: 'ioredis'. **/\n  private redis: IORedisCompat | undefined;\n  constructor({ redis }: { redis: IORedisCompat }) {\n    super();\n    this.redis = redis;\n  }\n\n  async getAllAssignments(\n    attributes: Record<string, string>\n  ): Promise<Record<StickyAttributeKey, StickyAssignmentsDocument>> {\n    const docs: Record<StickyAttributeKey, StickyAssignmentsDocument> = {};\n    const keys = Object.entries(attributes).map(\n      ([attributeName, attributeValue]) => `${attributeName}||${attributeValue}`\n    );\n    if (!this.redis) return docs;\n    await this.redis.mget(...keys).then((values) => {\n      values.forEach((raw) => {\n        try {\n          const data = JSON.parse(raw || \"{}\");\n          if (data.attributeName && data.attributeValue && data.assignments) {\n            const key = `${data.attributeName}||${data.attributeValue}`;\n            docs[key] = data;\n          }\n        } catch (e) {\n          // ignore redis doc parse errors\n        }\n      });\n    });\n    return docs;\n  }\n\n  async getAssignments(_attributeName: string, _attributeValue: string) {\n    // not implemented\n    return null;\n  }\n\n  async saveAssignments(doc: StickyAssignmentsDocument) {\n    const key = `${doc.attributeName}||${doc.attributeValue}`;\n    if (!this.redis) return;\n    await this.redis.set(key, JSON.stringify(doc));\n  }\n}\n","import Cookies from \"js-cookie\";\nimport {\n  BrowserCookieStickyBucketService,\n  Context,\n  FeatureApiResponse,\n  GrowthBook,\n  LocalStorageStickyBucketService,\n  StickyBucketService,\n} from \"./index\";\n\ntype WindowContext = Context & {\n  uuidCookieName?: string;\n  uuidKey?: string;\n  uuid?: string;\n  persistUuidOnLoad?: boolean;\n  noStreaming?: boolean;\n  useStickyBucketService?: \"cookie\" | \"localStorage\";\n  stickyBucketPrefix?: string;\n  payload?: FeatureApiResponse;\n};\ndeclare global {\n  interface Window {\n    _growthbook?: GrowthBook;\n    growthbook_queue?:\n      | Array<(gb: GrowthBook) => void>\n      | { push: (cb: (gb: GrowthBook) => void) => void };\n    growthbook_config?: WindowContext;\n    // eslint-disable-next-line\n    dataLayer?: any[];\n    analytics?: {\n      track?: (name: string, props?: Record<string, unknown>) => void;\n    };\n    // eslint-disable-next-line\n    gtag?: (...args: any) => void;\n  }\n}\n\n// Ensure dataLayer exists\nwindow.dataLayer = window.dataLayer || [];\n\nconst currentScript = document.currentScript;\nconst dataContext: DOMStringMap = currentScript ? currentScript.dataset : {};\nconst windowContext: WindowContext = window.growthbook_config || {};\n\nfunction setCookie(name: string, value: string) {\n  const d = new Date();\n  const COOKIE_DAYS = 400; // 400 days is the max cookie duration for chrome\n  d.setTime(d.getTime() + 24 * 60 * 60 * 1000 * COOKIE_DAYS);\n  document.cookie = name + \"=\" + value + \";path=/;expires=\" + d.toUTCString();\n}\n\nfunction getCookie(name: string): string {\n  const value = \"; \" + document.cookie;\n  const parts = value.split(`; ${name}=`);\n  return parts.length === 2 ? parts[1].split(\";\")[0] : \"\";\n}\n\n// Use the browsers crypto.randomUUID if set to generate a UUID\nfunction genUUID() {\n  if (window.crypto && crypto.randomUUID) return crypto.randomUUID();\n  return (\"\" + 1e7 + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, (c) =>\n    (\n      ((c as unknown) as number) ^\n      (crypto.getRandomValues(new Uint8Array(1))[0] &\n        (15 >> (((c as unknown) as number) / 4)))\n    ).toString(16)\n  );\n}\n\nconst COOKIE_NAME =\n  windowContext.uuidCookieName || dataContext.uuidCookieName || \"gbuuid\";\nconst uuidKey = windowContext.uuidKey || dataContext.uuidKey || \"id\";\nlet uuid = windowContext.uuid || dataContext.uuid || \"\";\nfunction persistUUID() {\n  setCookie(COOKIE_NAME, uuid);\n}\nfunction getUUID(persist = true) {\n  // Already stored in memory, return\n  if (uuid) return uuid;\n\n  // If cookie is already set, return\n  uuid = getCookie(COOKIE_NAME);\n  if (uuid) return uuid;\n\n  // Generate a new UUID and optionally persist it in a cookie\n  uuid = genUUID();\n  if (persist) {\n    persistUUID();\n  }\n\n  return uuid;\n}\n\nfunction getUtmAttributes() {\n  // Store utm- params in sessionStorage for future page loads\n  let utms: Record<string, string> = {};\n  try {\n    const existing = sessionStorage.getItem(\"utm_params\");\n    if (existing) {\n      utms = JSON.parse(existing);\n    }\n\n    // Add utm params from querystring\n    if (location.search) {\n      const params = new URLSearchParams(location.search);\n      let hasChanges = false;\n      [\"source\", \"medium\", \"campaign\", \"term\", \"content\"].forEach((k) => {\n        // Querystring is in snake_case\n        const param = `utm_${k}`;\n        // Attribute keys are camelCase\n        const attr = `utm` + k[0].toUpperCase() + k.slice(1);\n\n        if (params.has(param)) {\n          utms[attr] = params.get(param) || \"\";\n          hasChanges = true;\n        }\n      });\n\n      // Write back to sessionStorage\n      if (hasChanges) {\n        sessionStorage.setItem(\"utm_params\", JSON.stringify(utms));\n      }\n    }\n  } catch (e) {\n    // Do nothing if sessionStorage is disabled (e.g. incognito window)\n  }\n\n  return utms;\n}\n\nfunction getDataLayerVariables() {\n  if (!window.dataLayer || !window.dataLayer.forEach) return {};\n  const obj: Record<string, unknown> = {};\n  window.dataLayer.forEach((item: unknown) => {\n    // Skip empty and non-object entries\n    if (!item || typeof item !== \"object\" || \"length\" in item) return;\n\n    // Skip events\n    if (\"event\" in item) return;\n\n    Object.keys(item).forEach((k) => {\n      // Filter out known properties that aren't useful\n      if (typeof k !== \"string\" || k.match(/^(gtm)/)) return;\n\n      const val = (item as Record<string, unknown>)[k];\n\n      // Only add primitive variable values\n      const valueType = typeof val;\n      if ([\"string\", \"number\", \"boolean\"].includes(valueType)) {\n        obj[k] = val;\n      }\n    });\n  });\n  return obj;\n}\n\nfunction getAutoAttributes(\n  dataContext: DOMStringMap,\n  windowContext: WindowContext\n) {\n  const useCookies = dataContext.noAutoCookies == null;\n\n  const ua = navigator.userAgent;\n\n  const browser = ua.match(/Edg/)\n    ? \"edge\"\n    : ua.match(/Chrome/)\n    ? \"chrome\"\n    : ua.match(/Firefox/)\n    ? \"firefox\"\n    : ua.match(/Safari/)\n    ? \"safari\"\n    : \"unknown\";\n\n  const _uuid = getUUID(useCookies);\n  if (\n    (windowContext.persistUuidOnLoad || dataContext.persistUuidOnLoad) &&\n    useCookies\n  ) {\n    persistUUID();\n  }\n\n  return {\n    ...getDataLayerVariables(),\n    [uuidKey]: _uuid,\n    url: location.href,\n    path: location.pathname,\n    host: location.host,\n    query: location.search,\n    pageTitle: document && document.title,\n    deviceType: ua.match(/Mobi/) ? \"mobile\" : \"desktop\",\n    browser,\n    ...getUtmAttributes(),\n  };\n}\n\nfunction getAttributes() {\n  // Merge auto attributes and user-supplied attributes\n  const attributes = dataContext[\"noAutoAttributes\"]\n    ? {}\n    : getAutoAttributes(dataContext, windowContext);\n  if (windowContext.attributes) {\n    Object.assign(attributes, windowContext.attributes);\n  }\n  return attributes;\n}\n\n// Create sticky bucket service\nlet stickyBucketService: StickyBucketService | undefined = undefined;\nif (\n  windowContext.useStickyBucketService === \"cookie\" ||\n  dataContext.useStickyBucketService === \"cookie\"\n) {\n  stickyBucketService = new BrowserCookieStickyBucketService({\n    prefix:\n      windowContext.stickyBucketPrefix ||\n      dataContext.stickyBucketPrefix ||\n      undefined,\n    jsCookie: Cookies,\n  });\n} else if (\n  windowContext.useStickyBucketService === \"localStorage\" ||\n  dataContext.useStickyBucketService === \"localStorage\"\n) {\n  stickyBucketService = new LocalStorageStickyBucketService({\n    prefix:\n      windowContext.stickyBucketPrefix ||\n      dataContext.stickyBucketPrefix ||\n      undefined,\n  });\n}\n// Create GrowthBook instance\nconst gb = new GrowthBook({\n  ...dataContext,\n  remoteEval: !!dataContext.remoteEval,\n  trackingCallback: (e, r) => {\n    const p = { experiment_id: e.key, variation_id: r.key };\n\n    // GA4 - gtag\n    window.gtag && window.gtag(\"event\", \"experiment_viewed\", p);\n\n    // GTM - dataLayer\n    window.dataLayer &&\n      window.dataLayer.push({ event: \"experiment_viewed\", ...p });\n\n    // Segment - analytics.js\n    window.analytics &&\n      window.analytics.track &&\n      window.analytics.track(\"Experiment Viewed\", p);\n  },\n  ...windowContext,\n  attributes: getAttributes(),\n  stickyBucketService,\n});\n\n// Set the renderer to fire a custom DOM event\n// This will let us attach multiple listeners\ngb.setRenderer(() => {\n  document.dispatchEvent(new CustomEvent(\"growthbookdata\"));\n});\n\ngb.init({\n  payload: windowContext.payload,\n  streaming: !(\n    windowContext.noStreaming ||\n    dataContext.noStreaming ||\n    windowContext.backgroundSync === false\n  ),\n});\n\n// Poll for URL changes and update GrowthBook\nlet currentUrl = location.href;\nsetInterval(() => {\n  if (location.href !== currentUrl) {\n    currentUrl = location.href;\n    gb.setURL(currentUrl);\n    gb.updateAttributes(getAttributes());\n  }\n}, 500);\n\n// Listen for a custom event to update URL and attributes\ndocument.addEventListener(\"growthbookrefresh\", () => {\n  if (location.href !== currentUrl) {\n    currentUrl = location.href;\n    gb.setURL(currentUrl);\n  }\n  gb.updateAttributes(getAttributes());\n});\n\n// Listen for a custom event to persist the UUID cookie\ndocument.addEventListener(\"growthbookpersist\", () => {\n  persistUUID();\n});\n\nconst fireCallback = (cb: (gb: GrowthBook) => void) => {\n  try {\n    cb && cb(gb);\n  } catch (e) {\n    console.error(\"Uncaught growthbook_queue error\", e);\n  }\n};\n\n// Process any queued callbacks\nif (window.growthbook_queue) {\n  if (Array.isArray(window.growthbook_queue)) {\n    window.growthbook_queue.forEach((cb) => {\n      fireCallback(cb);\n    });\n  }\n}\n// Replace the queue with a function that immediately calls the callback\nwindow.growthbook_queue = {\n  push: (cb: (gb: GrowthBook) => void) => {\n    fireCallback(cb);\n  },\n};\n\n// Store a reference in window to enable more advanced use cases\nexport default gb;\n"],"names":["polyfills","fetch","globalThis","bind","undefined","SubtleCrypto","crypto","subtle","EventSource","getPolyfills","hashFnv32a","str","hval","l","length","i","charCodeAt","hash","seed","value","version","getEqualWeights","n","Array","fill","inRange","range","inNamespace","hashValue","namespace","chooseVariation","ranges","getUrlRegExp","regexString","escaped","replace","RegExp","e","console","error","isURLTargeted","url","targets","hasIncludeRules","isIncluded","match","_evalURLTarget","type","pattern","include","_evalSimpleUrlPart","actual","isPath","regex","test","_evalSimpleUrlTarget","expected","URL","comps","host","pathname","push","searchParams","forEach","v","k","get","some","data","parsed","href","substring","origin","getBucketRanges","numVariations","coverage","weights","equal","totalWeight","reduce","w","sum","cumulative","map","start","getQueryStringOverride","id","search","split","kv","filter","parseInt","base64ToBuf","b","Uint8Array","from","atob","c","decrypt","encryptedString","decryptionKey","Error","key","importKey","name","iv","cipherText","plainTextBuffer","TextDecoder","decode","toString","input","JSON","stringify","paddedVersionString","parts","padStart","join","loadSDKVersion","mergeQueryStrings","oldUrl","newUrl","currUrl","redirectUrl","has","set","isObj","x","getAutoExperimentChangeType","exp","urlPatterns","variations","variation","domMutations","cacheSettings","staleTTL","maxAge","cacheKey","backgroundSync","maxEntries","disableIdleStreams","idleStreamInterval","disableCache","helpers","fetchFeaturesCall","clientKey","headers","fetchRemoteEvalCall","payload","options","method","body","eventSourceCall","startIdleListener","idleTimeout","isBrowser","window","document","onVisibilityChange","visibilityState","clearTimeout","onVisible","setTimeout","onHidden","addEventListener","removeEventListener","stopIdleListener","localStorage","subscribedInstances","Map","cacheInitialized","cache","activeFetches","streams","supportsSSE","Set","refreshFeatures","instance","timeout","skipCache","allowStale","fetchFeaturesWithCache","subscribe","getKey","subs","add","unsubscribe","s","delete","channel","state","disableChannel","enableChannel","updatePersistentCache","setItem","entries","getCacheKey","now","Date","minStaleAt","getTime","initializeCache","existing","staleAt","sse","fetchFeatures","startAutoRefresh","success","source","res","promiseTimeout","apiHost","getApiInfo","baseKey","isRemoteEval","attributes","getAttributes","cacheKeyAttributes","getCacheKeyAttributes","Object","keys","ca","fv","getForcedVariations","getUrl","promise","Promise","resolve","resolved","timer","finish","then","catch","getItem","parse","isArray","cleanupCache","cleanupFn","entriesWithTimestamps","sort","a","entriesToRemoveCount","Math","min","max","size","onNewFeatureData","dateUpdated","instances","refreshInstance","setPayload","getPayload","apiRequestHeaders","getApiHosts","getClientKey","remoteEval","fetcher","forcedVariations","forcedFeatures","getForcedFeatures","ok","status","json","forceSSE","streamingHost","streamingHostRequestHeaders","src","cb","event","errors","onSSEError","readyState","delay","pow","random","includes","onopen","onerror","close","validAttributeName","nullController","revert","elements","mutations","getObserverInit","attr","childList","subtree","characterData","attributeFilter","getElementRecord","element","record","createElementPropertyRecord","el","getCurrentValue","setValue","mutationRunner","currentValue","isDirty","originalValue","virtualValue","_positionTimeout","observer","MutationObserver","parentNode","insertBeforeNode","observe","queueIfNeeded","val","currentVal","runDOMUpdates","htmlMutationRunner","m","mutate","getTransformedHTML","classMutationRunner","Boolean","attrMutationRunner","_loadDOMNodes","parentSelector","insertBeforeSelector","querySelector","positionMutationRunner","selectors","newNodes","getHTMLValue","innerHTML","setHTMLValue","getElementHTMLRecord","elementRecord","html","getElementPosition","parentElement","nextElementSibling","setElementPosition","contains","insertBefore","getElementPositionRecord","position","setClassValue","className","removeAttribute","getClassValue","getElementClassRecord","classes","getAttrValue","attrName","getAttribute","setAttrValue","setAttribute","getElementAttributeRecord","deleteElementPropertyRecord","disconnect","transformContainer","createElement","setPropertyValue","startMutating","mutation","kind","attribute","stopMutating","index","indexOf","splice","refreshElementsSet","existingElements","matchingElements","querySelectorAll","selector","revertMutation","clear","refreshAllElementSets","connectGlobalObserver","documentElement","newMutation","mutatedClassnames","classnames","declarative","action","_regexCache","evalCondition","obj","condition","evalOr","evalAnd","evalConditionValue","getPath","path","current","getRegex","isOperatorObject","op","evalOperatorCondition","getType","t","elemMatch","check","isIn","operator","passed","j","conditions","SDK_VERSION","GrowthBook","constructor","context","_ctx","_renderer","renderer","_trackedExperiments","_completedChangeIds","_trackedFeatures","debug","_subscriptions","_rtQueue","_rtTimer","ready","_assigned","_forcedFeatureValues","_attributeOverrides","_activeAutoExperiments","_triggeredExpKeys","_initialized","_redirectedUrl","_deferredTrackingCalls","_autoExperimentsAllowed","disableExperimentsOnLoad","isGbHost","hostname","features","enableDevMode","_growthbook","dispatchEvent","Event","experiments","_updateAllAutoExperiments","antiFlicker","_setAntiFlicker","stickyBucketService","stickyBucketAssignmentDocs","doc","saveAssignments","refreshStickyBuckets","_payload","decryptPayload","_decryptedPayload","_render","initSync","encryptedExperiments","encryptedFeatures","streaming","init","_refresh","loadFeatures","autoRefresh","subscribeToChanges","_canSubscribe","defaultHost","apiHostRequestHeaders","getFeatures","getExperiments","getDecryptedPayload","setFeatures","setEncryptedFeatures","featuresJSON","setExperiments","setEncryptedExperiments","experimentsJSON","setAttributes","_refreshForRemoteEval","updateAttributes","setAttributeOverrides","overrides","setForcedVariations","vars","setForcedFeatures","setURL","getStickyBucketAssignmentDocs","getCompletedChangeIds","getAllResults","destroy","undo","setRenderer","forceVariation","run","experiment","result","_run","_fireSubscriptions","triggerExperiment","_runAutoExperiment","triggerAutoExperiments","forceRerun","manual","isBlocked","_isAutoExperimentBlockedByContext","_getResult","valueHash","inExperiment","_undoActiveAutoExperiment","changeType","urlRedirect","persistQueryString","_getContextUrl","log","navigate","_getNavigateFunction","navigateDelay","applyDomChangesCallback","_applyDOMChanges","prev","variationId","_trackFeatureUsage","stringifiedValue","onFeatureUsage","on","q","realtimeKey","encodeURIComponent","mode","realtimeInterval","_getFeatureResult","ruleId","ret","off","experimentResult","isOn","evalFeature","isOff","getFeatureValue","defaultValue","feature","_evalFeature","evalCtx","evaluatedFeatures","rules","rule","parentConditions","parentCondition","parentResult","evalObj","evaled","gate","filters","_isFilteredOut","_conditionPasses","_isIncludedInRollout","hashAttribute","disableStickyBucketing","fallbackAttribute","hashVersion","tracks","_track","force","bucketVersion","minBucketVersion","meta","phase","passthrough","_getHashAttribute","r","featureId","enabled","_mergeOverrides","qsOverride","active","assigned","foundStickyBucket","stickyBucketVersionIsBlocked","versionIsBlocked","_getStickyBucketVariation","expKey","expBucketVersion","expHashAttribute","expFallbackAttribute","expMinBucketVersion","expMeta","groups","_hasGroupOverlap","_urlIsValid","qaMode","changed","attrKey","_generateStickyBucketAssignmentDoc","_getStickyBucketExperimentKey","changeId","msg","ctx","getDeferredTrackingCalls","values","setDeferredTrackingCalls","calls","_getTrackKey","fireDeferredTrackingCalls","trackingCallback","call","setTrackingCallback","callback","o","assign","fallback","user","variationIndex","hashUsed","bucket","stickyBucketUsed","location","urlRegex","pathOnly","expGroups","disableVisualExperiments","disableJsInjection","js","disableUrlRedirectExperiments","disableCrossOriginUrlRedirectExperiments","protocol","blockedChangeIds","getRedirectUrl","styleTag","head","appendChild","classList","remove","antiFlickerTimeout","changes","css","script","jsInjectionNonce","nonce","fn","_deriveStickyBucketIdentifierAttributes","_getStickyBucketAttributes","getAllAssignments","_getStickyBucketAssignments","hashKey","fallbackValue","fallbackKey","assignments","blockedKey","variationKey","findIndex","experimentKey","experimentBucketVersion","stickyBucketIdentifierAttributes","attributeName","attributeValue","existingAssignments","newAssignments","StickyBucketService","docs","all","getAssignments","LocalStorageStickyBucketService","opts","prefix","raw","BrowserCookieStickyBucketService","jsCookie","cookieAttributes","dataLayer","currentScript","dataContext","dataset","windowContext","growthbook_config","setCookie","d","COOKIE_DAYS","setTime","cookie","toUTCString","getCookie","genUUID","randomUUID","getRandomValues","COOKIE_NAME","uuidCookieName","uuidKey","uuid","persistUUID","getUUID","persist","getUtmAttributes","utms","sessionStorage","params","URLSearchParams","hasChanges","param","toUpperCase","slice","getDataLayerVariables","item","valueType","getAutoAttributes","useCookies","noAutoCookies","ua","navigator","userAgent","browser","_uuid","persistUuidOnLoad","query","pageTitle","title","deviceType","useStickyBucketService","stickyBucketPrefix","Cookies","gb","p","experiment_id","variation_id","gtag","analytics","track","CustomEvent","noStreaming","currentUrl","setInterval","fireCallback","growthbook_queue"],"mappings":"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"}