{"version":3,"file":"GrowthBook.js","names":["mutate","chooseVariation","decrypt","getAutoExperimentChangeType","getBucketRanges","getQueryStringOverride","getUrlRegExp","hash","inNamespace","inRange","isIncluded","isURLTargeted","loadSDKVersion","mergeQueryStrings","toString","evalCondition","refreshFeatures","startAutoRefresh","subscribe","unsubscribe","isBrowser","window","document","SDK_VERSION","GrowthBook","constructor","context","version","_ctx","_renderer","renderer","_trackedExperiments","Set","_completedChangeIds","_trackedFeatures","debug","_subscriptions","_rtQueue","_rtTimer","ready","_assigned","Map","_forcedFeatureValues","_attributeOverrides","_activeAutoExperiments","_triggeredExpKeys","_initialized","_redirectedUrl","_deferredTrackingCalls","_autoExperimentsAllowed","disableExperimentsOnLoad","remoteEval","decryptionKey","Error","clientKey","isGbHost","URL","apiHost","hostname","match","e","cacheKeyAttributes","features","enableDevMode","_growthbook","dispatchEvent","Event","experiments","_updateAllAutoExperiments","antiFlicker","_setAntiFlicker","stickyBucketService","stickyBucketAssignmentDocs","key","doc","saveAssignments","catch","refreshStickyBuckets","getPayload","setPayload","payload","_payload","data","decryptPayload","_decryptedPayload","_render","initSync","options","encryptedExperiments","encryptedFeatures","streaming","init","success","source","res","_refresh","allowStale","loadFeatures","autoRefresh","subscribeToChanges","_canSubscribe","getApiInfo","getApiHosts","getClientKey","defaultHost","replace","streamingHost","apiRequestHeaders","apiHostRequestHeaders","streamingHostRequestHeaders","getFeatures","getExperiments","getDecryptedPayload","isRemoteEval","getCacheKeyAttributes","timeout","skipCache","instance","disableCache","backgroundSync","console","error","setFeatures","setEncryptedFeatures","encryptedString","subtle","featuresJSON","JSON","parse","setExperiments","setEncryptedExperiments","experimentsJSON","setAttributes","attributes","_refreshForRemoteEval","updateAttributes","setAttributeOverrides","overrides","setForcedVariations","vars","forcedVariations","setForcedFeatures","map","setURL","url","getAttributes","getForcedVariations","getForcedFeatures","getStickyBucketAssignmentDocs","getUrl","getCompletedChangeIds","Array","from","cb","add","delete","getAllResults","destroy","clear","undefined","clearTimeout","forEach","exp","undo","setRenderer","forceVariation","variation","run","experiment","result","_run","_fireSubscriptions","triggerExperiment","filter","_runAutoExperiment","triggerAutoExperiments","forceRerun","existing","get","manual","has","isBlocked","_isAutoExperimentBlockedByContext","process","env","NODE_ENV","log","id","_getResult","valueHash","stringify","value","inExperiment","_undoActiveAutoExperiment","changeType","urlRedirect","urlPatterns","persistQueryString","_getContextUrl","navigate","_getNavigateFunction","setTimeout","navigateDelay","applyDomChangesCallback","_applyDOMChanges","set","keys","v","k","prev","variationId","_trackFeatureUsage","stringifiedValue","onFeatureUsage","fetch","push","on","q","realtimeKey","encodeURIComponent","cache","mode","realtimeInterval","_getFeatureResult","ruleId","ret","off","experimentResult","isOn","evalFeature","isOff","getFeatureValue","defaultValue","feature","_evalFeature","evalCtx","evaluatedFeatures","to","rules","rule","parentConditions","parentCondition","parentResult","evalObj","evaled","condition","gate","filters","_isFilteredOut","_conditionPasses","_isIncludedInRollout","seed","hashAttribute","disableStickyBucketing","fallbackAttribute","range","coverage","hashVersion","tracks","t","_track","force","variations","weights","bucketVersion","minBucketVersion","namespace","meta","ranges","name","phase","passthrough","hashValue","_getHashAttribute","n","some","attribute","r","featureId","numVariations","length","enabled","_mergeOverrides","qsOverride","status","active","assigned","foundStickyBucket","stickyBucketVersionIsBlocked","versionIsBlocked","_getStickyBucketVariation","expKey","expBucketVersion","expHashAttribute","expFallbackAttribute","expMinBucketVersion","expMeta","include","groups","_hasGroupOverlap","_urlIsValid","qaMode","changed","attrKey","_generateStickyBucketAssignmentDoc","_getStickyBucketExperimentKey","changeId","msg","ctx","getDeferredTrackingCalls","values","setDeferredTrackingCalls","calls","c","_getTrackKey","fireDeferredTrackingCalls","trackingCallback","call","setTrackingCallback","callback","o","Object","assign","attr","fallback","user","variationIndex","hashUsed","bucket","stickyBucketUsed","location","href","urlRegex","pathOnly","test","expGroups","i","disableVisualExperiments","disableJsInjection","js","disableUrlRedirectExperiments","current","disableCrossOriginUrlRedirectExperiments","protocol","host","blockedChangeIds","includes","getRedirectUrl","styleTag","createElement","innerHTML","head","appendChild","documentElement","classList","remove","antiFlickerTimeout","changes","css","s","script","jsInjectionNonce","nonce","domMutations","mutation","declarative","revert","fn","_deriveStickyBucketIdentifierAttributes","_getStickyBucketAttributes","getAllAssignments","_getStickyBucketAssignments","hashKey","fallbackValue","fallbackKey","assignments","blockedKey","variationKey","findIndex","m","experimentKey","experimentBucketVersion","stickyBucketIdentifierAttributes","attributeName","attributeValue","existingAssignments","newAssignments","prefetchPayload"],"sources":["../../src/GrowthBook.ts"],"sourcesContent":["import mutate, { DeclarativeMutation } from \"dom-mutator\";\nimport type {\n  ApiHost,\n  Attributes,\n  AutoExperiment,\n  AutoExperimentVariation,\n  ClientKey,\n  Context,\n  Experiment,\n  FeatureApiResponse,\n  FeatureDefinition,\n  FeatureResult,\n  FeatureResultSource,\n  Filter,\n  LoadFeaturesOptions,\n  RealtimeUsageData,\n  RefreshFeaturesOptions,\n  RenderFunction,\n  Result,\n  StickyAssignments,\n  StickyAssignmentsDocument,\n  StickyAttributeKey,\n  StickyExperimentKey,\n  SubscriptionFunction,\n  TrackingCallback,\n  TrackingData,\n  VariationMeta,\n  VariationRange,\n  WidenPrimitives,\n  FeatureEvalContext,\n  InitOptions,\n  InitResponse,\n  InitSyncOptions,\n  PrefetchOptions,\n} from \"./types/growthbook\";\nimport type { ConditionInterface } from \"./types/mongrule\";\nimport {\n  chooseVariation,\n  decrypt,\n  getAutoExperimentChangeType,\n  getBucketRanges,\n  getQueryStringOverride,\n  getUrlRegExp,\n  hash,\n  inNamespace,\n  inRange,\n  isIncluded,\n  isURLTargeted,\n  loadSDKVersion,\n  mergeQueryStrings,\n  toString,\n} from \"./util\";\nimport { evalCondition } from \"./mongrule\";\nimport {\n  refreshFeatures,\n  startAutoRefresh,\n  subscribe,\n  unsubscribe,\n} from \"./feature-repository\";\n\nconst isBrowser =\n  typeof window !== \"undefined\" && typeof document !== \"undefined\";\n\nconst SDK_VERSION = loadSDKVersion();\n\nexport class GrowthBook<\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  AppFeatures extends Record<string, any> = Record<string, any>\n> {\n  // context is technically private, but some tools depend on it so we can't mangle the name\n  // _ctx below is a clone of this property that we use internally\n  private context: Context;\n  public debug: boolean;\n  public ready: boolean;\n  public version: string;\n\n  // Properties and methods that start with \"_\" are mangled by Terser (saves ~150 bytes)\n  private _ctx: Context;\n  private _renderer: null | RenderFunction;\n  private _redirectedUrl: string;\n  private _trackedExperiments: Set<string>;\n  private _completedChangeIds: Set<string>;\n  private _trackedFeatures: Record<string, string>;\n  private _subscriptions: Set<SubscriptionFunction>;\n  private _rtQueue: RealtimeUsageData[];\n  private _rtTimer: number;\n  private _assigned: Map<\n    string,\n    {\n      // eslint-disable-next-line\n      experiment: Experiment<any>;\n      // eslint-disable-next-line\n      result: Result<any>;\n    }\n  >;\n  // eslint-disable-next-line\n  private _forcedFeatureValues: Map<string, any>;\n  private _attributeOverrides: Attributes;\n  private _activeAutoExperiments: Map<\n    AutoExperiment,\n    { valueHash: string; undo: () => void }\n  >;\n  private _triggeredExpKeys: Set<string>;\n  private _initialized: boolean;\n  private _deferredTrackingCalls: Map<string, TrackingData>;\n\n  private _payload: FeatureApiResponse | undefined;\n  private _decryptedPayload: FeatureApiResponse | undefined;\n\n  private _autoExperimentsAllowed: boolean;\n\n  constructor(context?: Context) {\n    context = context || {};\n    // These properties are all initialized in the constructor instead of above\n    // This saves ~80 bytes in the final output\n    this.version = SDK_VERSION;\n    this._ctx = this.context = context;\n    this._renderer = context.renderer || null;\n    this._trackedExperiments = new Set();\n    this._completedChangeIds = new Set();\n    this._trackedFeatures = {};\n    this.debug = !!context.debug;\n    this._subscriptions = new Set();\n    this._rtQueue = [];\n    this._rtTimer = 0;\n    this.ready = false;\n    this._assigned = new Map();\n    this._forcedFeatureValues = new Map();\n    this._attributeOverrides = {};\n    this._activeAutoExperiments = new Map();\n    this._triggeredExpKeys = new Set();\n    this._initialized = false;\n    this._redirectedUrl = \"\";\n    this._deferredTrackingCalls = new Map();\n    this._autoExperimentsAllowed = !context.disableExperimentsOnLoad;\n\n    if (context.remoteEval) {\n      if (context.decryptionKey) {\n        throw new Error(\"Encryption is not available for remoteEval\");\n      }\n      if (!context.clientKey) {\n        throw new Error(\"Missing clientKey\");\n      }\n      let isGbHost = false;\n      try {\n        isGbHost = !!new URL(context.apiHost || \"\").hostname.match(\n          /growthbook\\.io$/i\n        );\n      } catch (e) {\n        // ignore invalid URLs\n      }\n      if (isGbHost) {\n        throw new Error(\"Cannot use remoteEval on GrowthBook Cloud\");\n      }\n    } else {\n      if (context.cacheKeyAttributes) {\n        throw new Error(\"cacheKeyAttributes are only used for remoteEval\");\n      }\n    }\n\n    if (context.features) {\n      this.ready = true;\n    }\n\n    if (isBrowser && context.enableDevMode) {\n      window._growthbook = this;\n      document.dispatchEvent(new Event(\"gbloaded\"));\n    }\n\n    if (context.experiments) {\n      this.ready = true;\n      this._updateAllAutoExperiments();\n    } else if (context.antiFlicker) {\n      this._setAntiFlicker();\n    }\n\n    // Hydrate sticky bucket service\n    if (this._ctx.stickyBucketService && this._ctx.stickyBucketAssignmentDocs) {\n      for (const key in this._ctx.stickyBucketAssignmentDocs) {\n        const doc = this._ctx.stickyBucketAssignmentDocs[key];\n        if (doc) {\n          this._ctx.stickyBucketService.saveAssignments(doc).catch(() => {\n            // Ignore hydration errors\n          });\n        }\n      }\n    }\n\n    // Legacy - passing in features/experiments into the constructor instead of using init\n    if (this.ready) {\n      this.refreshStickyBuckets(this.getPayload());\n    }\n  }\n\n  public async setPayload(payload: FeatureApiResponse): Promise<void> {\n    this._payload = payload;\n    const data = await this.decryptPayload(payload);\n    this._decryptedPayload = data;\n    await this.refreshStickyBuckets(data);\n    if (data.features) {\n      this._ctx.features = data.features;\n    }\n    if (data.experiments) {\n      this._ctx.experiments = data.experiments;\n      this._updateAllAutoExperiments();\n    }\n    this.ready = true;\n    this._render();\n  }\n\n  public initSync(options: InitSyncOptions): GrowthBook {\n    this._initialized = true;\n\n    const payload = options.payload;\n\n    if (payload.encryptedExperiments || payload.encryptedFeatures) {\n      throw new Error(\"initSync does not support encrypted payloads\");\n    }\n\n    if (\n      this._ctx.stickyBucketService &&\n      !this._ctx.stickyBucketAssignmentDocs\n    ) {\n      throw new Error(\n        \"initSync requires you to pass stickyBucketAssignmentDocs into the GrowthBook constructor\"\n      );\n    }\n\n    this._payload = payload;\n    this._decryptedPayload = payload;\n    if (payload.features) {\n      this._ctx.features = payload.features;\n    }\n    if (payload.experiments) {\n      this._ctx.experiments = payload.experiments;\n      this._updateAllAutoExperiments();\n    }\n\n    this.ready = true;\n\n    if (options.streaming) {\n      if (!this._ctx.clientKey) {\n        throw new Error(\"Must specify clientKey to enable streaming\");\n      }\n      startAutoRefresh(this, true);\n      subscribe(this);\n    }\n\n    return this;\n  }\n\n  public async init(options?: InitOptions): Promise<InitResponse> {\n    this._initialized = true;\n\n    options = options || {};\n    if (options.payload) {\n      await this.setPayload(options.payload);\n      if (options.streaming) {\n        if (!this._ctx.clientKey) {\n          throw new Error(\"Must specify clientKey to enable streaming\");\n        }\n        startAutoRefresh(this, true);\n        subscribe(this);\n      }\n\n      return {\n        success: true,\n        source: \"init\",\n      };\n    } else {\n      const { data, ...res } = await this._refresh({\n        ...options,\n        allowStale: true,\n      });\n      if (options.streaming) {\n        subscribe(this);\n      }\n\n      await this.setPayload(data || {});\n      return res;\n    }\n  }\n\n  /** @deprecated Use {@link init} */\n  public async loadFeatures(options?: LoadFeaturesOptions): Promise<void> {\n    this._initialized = true;\n\n    options = options || {};\n    if (options.autoRefresh) {\n      // interpret deprecated autoRefresh option as subscribeToChanges\n      this._ctx.subscribeToChanges = true;\n    }\n    const { data } = await this._refresh({\n      ...options,\n      allowStale: true,\n    });\n    await this.setPayload(data || {});\n\n    if (this._canSubscribe()) {\n      subscribe(this);\n    }\n  }\n\n  public async refreshFeatures(\n    options?: RefreshFeaturesOptions\n  ): Promise<void> {\n    const res = await this._refresh({\n      ...(options || {}),\n      allowStale: false,\n    });\n    if (res.data) {\n      await this.setPayload(res.data);\n    }\n  }\n\n  public getApiInfo(): [ApiHost, ClientKey] {\n    return [this.getApiHosts().apiHost, this.getClientKey()];\n  }\n  public getApiHosts(): {\n    apiHost: string;\n    streamingHost: string;\n    apiRequestHeaders?: Record<string, string>;\n    streamingHostRequestHeaders?: Record<string, string>;\n  } {\n    const defaultHost = this._ctx.apiHost || \"https://cdn.growthbook.io\";\n    return {\n      apiHost: defaultHost.replace(/\\/*$/, \"\"),\n      streamingHost: (this._ctx.streamingHost || defaultHost).replace(\n        /\\/*$/,\n        \"\"\n      ),\n      apiRequestHeaders: this._ctx.apiHostRequestHeaders,\n      streamingHostRequestHeaders: this._ctx.streamingHostRequestHeaders,\n    };\n  }\n  public getClientKey(): string {\n    return this._ctx.clientKey || \"\";\n  }\n  public getPayload(): FeatureApiResponse {\n    return (\n      this._payload || {\n        features: this.getFeatures(),\n        experiments: this.getExperiments(),\n      }\n    );\n  }\n  public getDecryptedPayload(): FeatureApiResponse {\n    return this._decryptedPayload || this.getPayload();\n  }\n\n  public isRemoteEval(): boolean {\n    return this._ctx.remoteEval || false;\n  }\n\n  public getCacheKeyAttributes(): (keyof Attributes)[] | undefined {\n    return this._ctx.cacheKeyAttributes;\n  }\n\n  private async _refresh({\n    timeout,\n    skipCache,\n    allowStale,\n    streaming,\n  }: RefreshFeaturesOptions & {\n    allowStale?: boolean;\n    streaming?: boolean;\n  }) {\n    if (!this._ctx.clientKey) {\n      throw new Error(\"Missing clientKey\");\n    }\n    // Trigger refresh in feature repository\n    return refreshFeatures({\n      instance: this,\n      timeout,\n      skipCache: skipCache || this._ctx.disableCache,\n      allowStale,\n      backgroundSync: streaming ?? this._ctx.backgroundSync ?? true,\n    });\n  }\n\n  private _render() {\n    if (this._renderer) {\n      try {\n        this._renderer();\n      } catch (e) {\n        console.error(\"Failed to render\", e);\n      }\n    }\n  }\n\n  /** @deprecated Use {@link setPayload} */\n  public setFeatures(features: Record<string, FeatureDefinition>) {\n    this._ctx.features = features;\n    this.ready = true;\n    this._render();\n  }\n\n  /** @deprecated Use {@link setPayload} */\n  public async setEncryptedFeatures(\n    encryptedString: string,\n    decryptionKey?: string,\n    subtle?: SubtleCrypto\n  ): Promise<void> {\n    const featuresJSON = await decrypt(\n      encryptedString,\n      decryptionKey || this._ctx.decryptionKey,\n      subtle\n    );\n    this.setFeatures(\n      JSON.parse(featuresJSON) as Record<string, FeatureDefinition>\n    );\n  }\n\n  /** @deprecated Use {@link setPayload} */\n  public setExperiments(experiments: AutoExperiment[]): void {\n    this._ctx.experiments = experiments;\n    this.ready = true;\n    this._updateAllAutoExperiments();\n  }\n\n  /** @deprecated Use {@link setPayload} */\n  public async setEncryptedExperiments(\n    encryptedString: string,\n    decryptionKey?: string,\n    subtle?: SubtleCrypto\n  ): Promise<void> {\n    const experimentsJSON = await decrypt(\n      encryptedString,\n      decryptionKey || this._ctx.decryptionKey,\n      subtle\n    );\n    this.setExperiments(JSON.parse(experimentsJSON) as AutoExperiment[]);\n  }\n\n  public async decryptPayload(\n    data: FeatureApiResponse,\n    decryptionKey?: string,\n    subtle?: SubtleCrypto\n  ): Promise<FeatureApiResponse> {\n    data = { ...data };\n    if (data.encryptedFeatures) {\n      data.features = JSON.parse(\n        await decrypt(\n          data.encryptedFeatures,\n          decryptionKey || this._ctx.decryptionKey,\n          subtle\n        )\n      );\n      delete data.encryptedFeatures;\n    }\n    if (data.encryptedExperiments) {\n      data.experiments = JSON.parse(\n        await decrypt(\n          data.encryptedExperiments,\n          decryptionKey || this._ctx.decryptionKey,\n          subtle\n        )\n      );\n      delete data.encryptedExperiments;\n    }\n    return data;\n  }\n\n  public async setAttributes(attributes: Attributes) {\n    this._ctx.attributes = attributes;\n    if (this._ctx.stickyBucketService) {\n      await this.refreshStickyBuckets();\n    }\n    if (this._ctx.remoteEval) {\n      await this._refreshForRemoteEval();\n      return;\n    }\n    this._render();\n    this._updateAllAutoExperiments();\n  }\n\n  public async updateAttributes(attributes: Attributes) {\n    return this.setAttributes({ ...this._ctx.attributes, ...attributes });\n  }\n\n  public async setAttributeOverrides(overrides: Attributes) {\n    this._attributeOverrides = overrides;\n    if (this._ctx.stickyBucketService) {\n      await this.refreshStickyBuckets();\n    }\n    if (this._ctx.remoteEval) {\n      await this._refreshForRemoteEval();\n      return;\n    }\n    this._render();\n    this._updateAllAutoExperiments();\n  }\n\n  public async setForcedVariations(vars: Record<string, number>) {\n    this._ctx.forcedVariations = vars || {};\n    if (this._ctx.remoteEval) {\n      await this._refreshForRemoteEval();\n      return;\n    }\n    this._render();\n    this._updateAllAutoExperiments();\n  }\n\n  // eslint-disable-next-line\n  public setForcedFeatures(map: Map<string, any>) {\n    this._forcedFeatureValues = map;\n    this._render();\n  }\n\n  public async setURL(url: string) {\n    this._ctx.url = url;\n    this._redirectedUrl = \"\";\n    if (this._ctx.remoteEval) {\n      await this._refreshForRemoteEval();\n      this._updateAllAutoExperiments(true);\n      return;\n    }\n    this._updateAllAutoExperiments(true);\n  }\n\n  public getAttributes() {\n    return { ...this._ctx.attributes, ...this._attributeOverrides };\n  }\n\n  public getForcedVariations() {\n    return this._ctx.forcedVariations || {};\n  }\n\n  public getForcedFeatures() {\n    // eslint-disable-next-line\n    return this._forcedFeatureValues || new Map<string, any>();\n  }\n\n  public getStickyBucketAssignmentDocs() {\n    return this._ctx.stickyBucketAssignmentDocs || {};\n  }\n\n  public getUrl() {\n    return this._ctx.url || \"\";\n  }\n\n  public getFeatures() {\n    return this._ctx.features || {};\n  }\n\n  public getExperiments() {\n    return this._ctx.experiments || [];\n  }\n\n  public getCompletedChangeIds(): string[] {\n    return Array.from(this._completedChangeIds);\n  }\n\n  public subscribe(cb: SubscriptionFunction): () => void {\n    this._subscriptions.add(cb);\n    return () => {\n      this._subscriptions.delete(cb);\n    };\n  }\n\n  private _canSubscribe() {\n    return (this._ctx.backgroundSync ?? true) && this._ctx.subscribeToChanges;\n  }\n\n  private async _refreshForRemoteEval() {\n    if (!this._ctx.remoteEval) return;\n    if (!this._initialized) return;\n    const res = await this._refresh({\n      allowStale: false,\n    });\n    if (res.data) {\n      await this.setPayload(res.data);\n    }\n  }\n\n  public getAllResults() {\n    return new Map(this._assigned);\n  }\n\n  public destroy() {\n    // Release references to save memory\n    this._subscriptions.clear();\n    this._assigned.clear();\n    this._trackedExperiments.clear();\n    this._completedChangeIds.clear();\n    this._deferredTrackingCalls.clear();\n    this._trackedFeatures = {};\n    this._rtQueue = [];\n    this._payload = undefined;\n    if (this._rtTimer) {\n      clearTimeout(this._rtTimer);\n    }\n    unsubscribe(this);\n\n    if (isBrowser && window._growthbook === this) {\n      delete window._growthbook;\n    }\n\n    // Undo any active auto experiments\n    this._activeAutoExperiments.forEach((exp) => {\n      exp.undo();\n    });\n    this._activeAutoExperiments.clear();\n    this._triggeredExpKeys.clear();\n  }\n\n  public setRenderer(renderer: null | RenderFunction) {\n    this._renderer = renderer;\n  }\n\n  public forceVariation(key: string, variation: number) {\n    this._ctx.forcedVariations = this._ctx.forcedVariations || {};\n    this._ctx.forcedVariations[key] = variation;\n    if (this._ctx.remoteEval) {\n      this._refreshForRemoteEval();\n      return;\n    }\n    this._updateAllAutoExperiments();\n    this._render();\n  }\n\n  public run<T>(experiment: Experiment<T>): Result<T> {\n    const result = this._run(experiment, null);\n    this._fireSubscriptions(experiment, result);\n    return result;\n  }\n\n  public triggerExperiment(key: string) {\n    this._triggeredExpKeys.add(key);\n    if (!this._ctx.experiments) return null;\n    const experiments = this._ctx.experiments.filter((exp) => exp.key === key);\n    return experiments\n      .map((exp) => {\n        return this._runAutoExperiment(exp);\n      })\n      .filter((res) => res !== null);\n  }\n\n  public triggerAutoExperiments() {\n    this._autoExperimentsAllowed = true;\n    this._updateAllAutoExperiments(true);\n  }\n\n  private _runAutoExperiment(experiment: AutoExperiment, forceRerun?: boolean) {\n    const existing = this._activeAutoExperiments.get(experiment);\n\n    // If this is a manual experiment and it's not already running, skip\n    if (\n      experiment.manual &&\n      !this._triggeredExpKeys.has(experiment.key) &&\n      !existing\n    )\n      return null;\n\n    // Check if this particular experiment is blocked by context settings\n    // For example, if all visualEditor experiments are disabled\n    const isBlocked = this._isAutoExperimentBlockedByContext(experiment);\n    if (isBlocked) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Auto experiment blocked\", { id: experiment.key });\n    }\n\n    // Run the experiment (if blocked exclude)\n    const result = isBlocked\n      ? this._getResult(experiment, -1, false, \"\")\n      : this.run(experiment);\n\n    // A hash to quickly tell if the assigned value changed\n    const valueHash = JSON.stringify(result.value);\n\n    // If the changes are already active, no need to re-apply them\n    if (\n      !forceRerun &&\n      result.inExperiment &&\n      existing &&\n      existing.valueHash === valueHash\n    ) {\n      return result;\n    }\n\n    // Undo any existing changes\n    if (existing) this._undoActiveAutoExperiment(experiment);\n\n    // Apply new changes\n    if (result.inExperiment) {\n      const changeType = getAutoExperimentChangeType(experiment);\n\n      if (\n        changeType === \"redirect\" &&\n        result.value.urlRedirect &&\n        experiment.urlPatterns\n      ) {\n        const url = experiment.persistQueryString\n          ? mergeQueryStrings(this._getContextUrl(), result.value.urlRedirect)\n          : result.value.urlRedirect;\n\n        if (isURLTargeted(url, experiment.urlPatterns)) {\n          this.log(\n            \"Skipping redirect because original URL matches redirect URL\",\n            {\n              id: experiment.key,\n            }\n          );\n          return result;\n        }\n        this._redirectedUrl = url;\n        const navigate = this._getNavigateFunction();\n        if (navigate) {\n          if (isBrowser) {\n            this._setAntiFlicker();\n            window.setTimeout(() => {\n              try {\n                navigate(url);\n              } catch (e) {\n                console.error(e);\n              }\n            }, this._ctx.navigateDelay ?? 100);\n          } else {\n            try {\n              navigate(url);\n            } catch (e) {\n              console.error(e);\n            }\n          }\n        }\n      } else if (changeType === \"visual\") {\n        const undo = this._ctx.applyDomChangesCallback\n          ? this._ctx.applyDomChangesCallback(result.value)\n          : this._applyDOMChanges(result.value);\n        if (undo) {\n          this._activeAutoExperiments.set(experiment, {\n            undo,\n            valueHash,\n          });\n        }\n      }\n    }\n\n    return result;\n  }\n\n  private _undoActiveAutoExperiment(exp: AutoExperiment) {\n    const data = this._activeAutoExperiments.get(exp);\n    if (data) {\n      data.undo();\n      this._activeAutoExperiments.delete(exp);\n    }\n  }\n\n  private _updateAllAutoExperiments(forceRerun?: boolean) {\n    if (!this._autoExperimentsAllowed) return;\n\n    const experiments = this._ctx.experiments || [];\n\n    // Stop any experiments that are no longer defined\n    const keys = new Set(experiments);\n    this._activeAutoExperiments.forEach((v, k) => {\n      if (!keys.has(k)) {\n        v.undo();\n        this._activeAutoExperiments.delete(k);\n      }\n    });\n\n    // Re-run all new/updated experiments\n    for (const exp of experiments) {\n      const result = this._runAutoExperiment(exp, forceRerun);\n\n      // Once you're in a redirect experiment, break out of the loop and don't run any further experiments\n      if (\n        result?.inExperiment &&\n        getAutoExperimentChangeType(exp) === \"redirect\"\n      ) {\n        break;\n      }\n    }\n  }\n\n  private _fireSubscriptions<T>(experiment: Experiment<T>, result: Result<T>) {\n    const key = experiment.key;\n\n    // If assigned variation has changed, fire subscriptions\n    const prev = this._assigned.get(key);\n    // TODO: what if the experiment definition has changed?\n    if (\n      !prev ||\n      prev.result.inExperiment !== result.inExperiment ||\n      prev.result.variationId !== result.variationId\n    ) {\n      this._assigned.set(key, { experiment, result });\n      this._subscriptions.forEach((cb) => {\n        try {\n          cb(experiment, result);\n        } catch (e) {\n          console.error(e);\n        }\n      });\n    }\n  }\n\n  private _trackFeatureUsage(key: string, res: FeatureResult): void {\n    // Don't track feature usage that was forced via an override\n    if (res.source === \"override\") return;\n\n    // Only track a feature once, unless the assigned value changed\n    const stringifiedValue = JSON.stringify(res.value);\n    if (this._trackedFeatures[key] === stringifiedValue) return;\n    this._trackedFeatures[key] = stringifiedValue;\n\n    // Fire user-supplied callback\n    if (this._ctx.onFeatureUsage) {\n      try {\n        this._ctx.onFeatureUsage(key, res);\n      } catch (e) {\n        // Ignore feature usage callback errors\n      }\n    }\n\n    // In browser environments, queue up feature usage to be tracked in batches\n    if (!isBrowser || !window.fetch) return;\n    this._rtQueue.push({\n      key,\n      on: res.on,\n    });\n    if (!this._rtTimer) {\n      this._rtTimer = window.setTimeout(() => {\n        // Reset the queue\n        this._rtTimer = 0;\n        const q = [...this._rtQueue];\n        this._rtQueue = [];\n\n        // Skip logging if a real-time usage key is not configured\n        if (!this._ctx.realtimeKey) return;\n\n        window\n          .fetch(\n            `https://rt.growthbook.io/?key=${\n              this._ctx.realtimeKey\n            }&events=${encodeURIComponent(JSON.stringify(q))}`,\n\n            {\n              cache: \"no-cache\",\n              mode: \"no-cors\",\n            }\n          )\n          .catch(() => {\n            // TODO: retry in case of network errors?\n          });\n      }, this._ctx.realtimeInterval || 2000);\n    }\n  }\n\n  private _getFeatureResult<T>(\n    key: string,\n    value: T,\n    source: FeatureResultSource,\n    ruleId?: string,\n    experiment?: Experiment<T>,\n    result?: Result<T>\n  ): FeatureResult<T> {\n    const ret: FeatureResult = {\n      value,\n      on: !!value,\n      off: !value,\n      source,\n      ruleId: ruleId || \"\",\n    };\n    if (experiment) ret.experiment = experiment;\n    if (result) ret.experimentResult = result;\n\n    // Track the usage of this feature in real-time\n    this._trackFeatureUsage(key, ret);\n\n    return ret;\n  }\n\n  public isOn<K extends string & keyof AppFeatures = string>(key: K): boolean {\n    return this.evalFeature(key).on;\n  }\n\n  public isOff<K extends string & keyof AppFeatures = string>(key: K): boolean {\n    return this.evalFeature(key).off;\n  }\n\n  public getFeatureValue<\n    V extends AppFeatures[K],\n    K extends string & keyof AppFeatures = string\n  >(key: K, defaultValue: V): WidenPrimitives<V> {\n    const value = this.evalFeature<WidenPrimitives<V>, K>(key).value;\n    return value === null ? (defaultValue as WidenPrimitives<V>) : value;\n  }\n\n  /**\n   * @deprecated Use {@link evalFeature}\n   * @param id\n   */\n  // eslint-disable-next-line\n  public feature<\n    V extends AppFeatures[K],\n    K extends string & keyof AppFeatures = string\n  >(id: K): FeatureResult<V | null> {\n    return this.evalFeature(id);\n  }\n\n  public evalFeature<\n    V extends AppFeatures[K],\n    K extends string & keyof AppFeatures = string\n  >(id: K): FeatureResult<V | null> {\n    return this._evalFeature(id);\n  }\n\n  private _evalFeature<\n    V extends AppFeatures[K],\n    K extends string & keyof AppFeatures = string\n  >(id: K, evalCtx?: FeatureEvalContext): FeatureResult<V | null> {\n    evalCtx = evalCtx || { evaluatedFeatures: new Set() };\n\n    if (evalCtx.evaluatedFeatures.has(id)) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\n          `evalFeature: circular dependency detected: ${evalCtx.id} -> ${id}`,\n          { from: evalCtx.id, to: id }\n        );\n      return this._getFeatureResult(id, null, \"cyclicPrerequisite\");\n    }\n    evalCtx.evaluatedFeatures.add(id);\n    evalCtx.id = id;\n\n    // Global override\n    if (this._forcedFeatureValues.has(id)) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Global override\", {\n          id,\n          value: this._forcedFeatureValues.get(id),\n        });\n      return this._getFeatureResult(\n        id,\n        this._forcedFeatureValues.get(id),\n        \"override\"\n      );\n    }\n\n    // Unknown feature id\n    if (!this._ctx.features || !this._ctx.features[id]) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Unknown feature\", { id });\n      return this._getFeatureResult(id, null, \"unknownFeature\");\n    }\n\n    // Get the feature\n    const feature: FeatureDefinition<V> = this._ctx.features[id];\n\n    // Loop through the rules\n    if (feature.rules) {\n      rules: for (const rule of feature.rules) {\n        // If there are prerequisite flag(s), evaluate them\n        if (rule.parentConditions) {\n          for (const parentCondition of rule.parentConditions) {\n            const parentResult = this._evalFeature(parentCondition.id, evalCtx);\n            // break out for cyclic prerequisites\n            if (parentResult.source === \"cyclicPrerequisite\") {\n              return this._getFeatureResult(id, null, \"cyclicPrerequisite\");\n            }\n\n            const evalObj = { value: parentResult.value };\n            const evaled = evalCondition(\n              evalObj,\n              parentCondition.condition || {}\n            );\n            if (!evaled) {\n              // blocking prerequisite eval failed: feature evaluation fails\n              if (parentCondition.gate) {\n                process.env.NODE_ENV !== \"production\" &&\n                  this.log(\"Feature blocked by prerequisite\", { id, rule });\n                return this._getFeatureResult(id, null, \"prerequisite\");\n              }\n              // non-blocking prerequisite eval failed: break out of parentConditions loop, jump to the next rule\n              process.env.NODE_ENV !== \"production\" &&\n                this.log(\"Skip rule because prerequisite evaluation fails\", {\n                  id,\n                  rule,\n                });\n              continue rules;\n            }\n          }\n        }\n\n        // If there are filters for who is included (e.g. namespaces)\n        if (rule.filters && this._isFilteredOut(rule.filters)) {\n          process.env.NODE_ENV !== \"production\" &&\n            this.log(\"Skip rule because of filters\", {\n              id,\n              rule,\n            });\n          continue;\n        }\n\n        // Feature value is being forced\n        if (\"force\" in rule) {\n          // If it's a conditional rule, skip if the condition doesn't pass\n          if (rule.condition && !this._conditionPasses(rule.condition)) {\n            process.env.NODE_ENV !== \"production\" &&\n              this.log(\"Skip rule because of condition ff\", {\n                id,\n                rule,\n              });\n            continue;\n          }\n\n          // If this is a percentage rollout, skip if not included\n          if (\n            !this._isIncludedInRollout(\n              rule.seed || id,\n              rule.hashAttribute,\n              this._ctx.stickyBucketService && !rule.disableStickyBucketing\n                ? rule.fallbackAttribute\n                : undefined,\n              rule.range,\n              rule.coverage,\n              rule.hashVersion\n            )\n          ) {\n            process.env.NODE_ENV !== \"production\" &&\n              this.log(\"Skip rule because user not included in rollout\", {\n                id,\n                rule,\n              });\n            continue;\n          }\n\n          process.env.NODE_ENV !== \"production\" &&\n            this.log(\"Force value from rule\", {\n              id,\n              rule,\n            });\n\n          // If this was a remotely evaluated experiment, fire the tracking callbacks\n          if (rule.tracks) {\n            rule.tracks.forEach((t) => {\n              this._track(t.experiment, t.result);\n            });\n          }\n\n          return this._getFeatureResult(id, rule.force as V, \"force\", rule.id);\n        }\n        if (!rule.variations) {\n          process.env.NODE_ENV !== \"production\" &&\n            this.log(\"Skip invalid rule\", {\n              id,\n              rule,\n            });\n\n          continue;\n        }\n\n        // For experiment rules, run an experiment\n        const exp: Experiment<V> = {\n          variations: rule.variations as [V, V, ...V[]],\n          key: rule.key || id,\n        };\n        if (\"coverage\" in rule) exp.coverage = rule.coverage;\n        if (rule.weights) exp.weights = rule.weights;\n        if (rule.hashAttribute) exp.hashAttribute = rule.hashAttribute;\n        if (rule.fallbackAttribute)\n          exp.fallbackAttribute = rule.fallbackAttribute;\n        if (rule.disableStickyBucketing)\n          exp.disableStickyBucketing = rule.disableStickyBucketing;\n        if (rule.bucketVersion !== undefined)\n          exp.bucketVersion = rule.bucketVersion;\n        if (rule.minBucketVersion !== undefined)\n          exp.minBucketVersion = rule.minBucketVersion;\n        if (rule.namespace) exp.namespace = rule.namespace;\n        if (rule.meta) exp.meta = rule.meta;\n        if (rule.ranges) exp.ranges = rule.ranges;\n        if (rule.name) exp.name = rule.name;\n        if (rule.phase) exp.phase = rule.phase;\n        if (rule.seed) exp.seed = rule.seed;\n        if (rule.hashVersion) exp.hashVersion = rule.hashVersion;\n        if (rule.filters) exp.filters = rule.filters;\n        if (rule.condition) exp.condition = rule.condition;\n\n        // Only return a value if the user is part of the experiment\n        const res = this._run(exp, id);\n        this._fireSubscriptions(exp, res);\n        if (res.inExperiment && !res.passthrough) {\n          return this._getFeatureResult(\n            id,\n            res.value,\n            \"experiment\",\n            rule.id,\n            exp,\n            res\n          );\n        }\n      }\n    }\n\n    process.env.NODE_ENV !== \"production\" &&\n      this.log(\"Use default value\", {\n        id,\n        value: feature.defaultValue,\n      });\n\n    // Fall back to using the default value\n    return this._getFeatureResult(\n      id,\n      feature.defaultValue === undefined ? null : feature.defaultValue,\n      \"defaultValue\"\n    );\n  }\n\n  private _isIncludedInRollout(\n    seed: string,\n    hashAttribute: string | undefined,\n    fallbackAttribute: string | undefined,\n    range: VariationRange | undefined,\n    coverage: number | undefined,\n    hashVersion: number | undefined\n  ): boolean {\n    if (!range && coverage === undefined) return true;\n\n    if (!range && coverage === 0) return false;\n\n    const { hashValue } = this._getHashAttribute(\n      hashAttribute,\n      fallbackAttribute\n    );\n    if (!hashValue) {\n      return false;\n    }\n\n    const n = hash(seed, hashValue, hashVersion || 1);\n    if (n === null) return false;\n\n    return range\n      ? inRange(n, range)\n      : coverage !== undefined\n      ? n <= coverage\n      : true;\n  }\n\n  private _conditionPasses(condition: ConditionInterface): boolean {\n    return evalCondition(this.getAttributes(), condition);\n  }\n\n  private _isFilteredOut(filters: Filter[]): boolean {\n    return filters.some((filter) => {\n      const { hashValue } = this._getHashAttribute(filter.attribute);\n      if (!hashValue) return true;\n      const n = hash(filter.seed, hashValue, filter.hashVersion || 2);\n      if (n === null) return true;\n      return !filter.ranges.some((r) => inRange(n, r));\n    });\n  }\n\n  private _run<T>(\n    experiment: Experiment<T>,\n    featureId: string | null\n  ): Result<T> {\n    const key = experiment.key;\n    const numVariations = experiment.variations.length;\n\n    // 1. If experiment has less than 2 variations, return immediately\n    if (numVariations < 2) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Invalid experiment\", { id: key });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 2. If the context is disabled, return immediately\n    if (this._ctx.enabled === false) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Context disabled\", { id: key });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 2.5. Merge in experiment overrides from the context\n    experiment = this._mergeOverrides(experiment);\n\n    // 2.6 New, more powerful URL targeting\n    if (\n      experiment.urlPatterns &&\n      !isURLTargeted(this._getContextUrl(), experiment.urlPatterns)\n    ) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of url targeting\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 3. If a variation is forced from a querystring, return the forced variation\n    const qsOverride = getQueryStringOverride(\n      key,\n      this._getContextUrl(),\n      numVariations\n    );\n    if (qsOverride !== null) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Force via querystring\", {\n          id: key,\n          variation: qsOverride,\n        });\n      return this._getResult(experiment, qsOverride, false, featureId);\n    }\n\n    // 4. If a variation is forced in the context, return the forced variation\n    if (this._ctx.forcedVariations && key in this._ctx.forcedVariations) {\n      const variation = this._ctx.forcedVariations[key];\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Force via dev tools\", {\n          id: key,\n          variation,\n        });\n      return this._getResult(experiment, variation, false, featureId);\n    }\n\n    // 5. Exclude if a draft experiment or not active\n    if (experiment.status === \"draft\" || experiment.active === false) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because inactive\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 6. Get the hash attribute and return if empty\n    const { hashAttribute, hashValue } = this._getHashAttribute(\n      experiment.hashAttribute,\n      this._ctx.stickyBucketService && !experiment.disableStickyBucketing\n        ? experiment.fallbackAttribute\n        : undefined\n    );\n    if (!hashValue) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because missing hashAttribute\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    let assigned = -1;\n\n    let foundStickyBucket = false;\n    let stickyBucketVersionIsBlocked = false;\n    if (this._ctx.stickyBucketService && !experiment.disableStickyBucketing) {\n      const { variation, versionIsBlocked } = this._getStickyBucketVariation({\n        expKey: experiment.key,\n        expBucketVersion: experiment.bucketVersion,\n        expHashAttribute: experiment.hashAttribute,\n        expFallbackAttribute: experiment.fallbackAttribute,\n        expMinBucketVersion: experiment.minBucketVersion,\n        expMeta: experiment.meta,\n      });\n      foundStickyBucket = variation >= 0;\n      assigned = variation;\n      stickyBucketVersionIsBlocked = !!versionIsBlocked;\n    }\n\n    // Some checks are not needed if we already have a sticky bucket\n    if (!foundStickyBucket) {\n      // 7. Exclude if user is filtered out (used to be called \"namespace\")\n      if (experiment.filters) {\n        if (this._isFilteredOut(experiment.filters)) {\n          process.env.NODE_ENV !== \"production\" &&\n            this.log(\"Skip because of filters\", {\n              id: key,\n            });\n          return this._getResult(experiment, -1, false, featureId);\n        }\n      } else if (\n        experiment.namespace &&\n        !inNamespace(hashValue, experiment.namespace)\n      ) {\n        process.env.NODE_ENV !== \"production\" &&\n          this.log(\"Skip because of namespace\", {\n            id: key,\n          });\n        return this._getResult(experiment, -1, false, featureId);\n      }\n\n      // 7.5. Exclude if experiment.include returns false or throws\n      if (experiment.include && !isIncluded(experiment.include)) {\n        process.env.NODE_ENV !== \"production\" &&\n          this.log(\"Skip because of include function\", {\n            id: key,\n          });\n        return this._getResult(experiment, -1, false, featureId);\n      }\n\n      // 8. Exclude if condition is false\n      if (\n        experiment.condition &&\n        !this._conditionPasses(experiment.condition)\n      ) {\n        process.env.NODE_ENV !== \"production\" &&\n          this.log(\"Skip because of condition exp\", {\n            id: key,\n          });\n        return this._getResult(experiment, -1, false, featureId);\n      }\n\n      // 8.05. Exclude if prerequisites are not met\n      if (experiment.parentConditions) {\n        for (const parentCondition of experiment.parentConditions) {\n          const parentResult = this._evalFeature(parentCondition.id);\n          // break out for cyclic prerequisites\n          if (parentResult.source === \"cyclicPrerequisite\") {\n            return this._getResult(experiment, -1, false, featureId);\n          }\n\n          const evalObj = { value: parentResult.value };\n          if (!evalCondition(evalObj, parentCondition.condition || {})) {\n            process.env.NODE_ENV !== \"production\" &&\n              this.log(\"Skip because prerequisite evaluation fails\", {\n                id: key,\n              });\n            return this._getResult(experiment, -1, false, featureId);\n          }\n        }\n      }\n\n      // 8.1. Exclude if user is not in a required group\n      if (\n        experiment.groups &&\n        !this._hasGroupOverlap(experiment.groups as string[])\n      ) {\n        process.env.NODE_ENV !== \"production\" &&\n          this.log(\"Skip because of groups\", {\n            id: key,\n          });\n        return this._getResult(experiment, -1, false, featureId);\n      }\n    }\n\n    // 8.2. Old style URL targeting\n    if (experiment.url && !this._urlIsValid(experiment.url as RegExp)) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of url\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 9. Get the variation from the sticky bucket or get bucket ranges and choose variation\n    const n = hash(\n      experiment.seed || key,\n      hashValue,\n      experiment.hashVersion || 1\n    );\n    if (n === null) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of invalid hash version\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    if (!foundStickyBucket) {\n      const ranges =\n        experiment.ranges ||\n        getBucketRanges(\n          numVariations,\n          experiment.coverage === undefined ? 1 : experiment.coverage,\n          experiment.weights\n        );\n      assigned = chooseVariation(n, ranges);\n    }\n\n    // 9.5 Unenroll if any prior sticky buckets are blocked by version\n    if (stickyBucketVersionIsBlocked) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because sticky bucket version is blocked\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId, undefined, true);\n    }\n\n    // 10. Return if not in experiment\n    if (assigned < 0) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because of coverage\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 11. Experiment has a forced variation\n    if (\"force\" in experiment) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Force variation\", {\n          id: key,\n          variation: experiment.force,\n        });\n      return this._getResult(\n        experiment,\n        experiment.force === undefined ? -1 : experiment.force,\n        false,\n        featureId\n      );\n    }\n\n    // 12. Exclude if in QA mode\n    if (this._ctx.qaMode) {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because QA mode\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 12.5. Exclude if experiment is stopped\n    if (experiment.status === \"stopped\") {\n      process.env.NODE_ENV !== \"production\" &&\n        this.log(\"Skip because stopped\", {\n          id: key,\n        });\n      return this._getResult(experiment, -1, false, featureId);\n    }\n\n    // 13. Build the result object\n    const result = this._getResult(\n      experiment,\n      assigned,\n      true,\n      featureId,\n      n,\n      foundStickyBucket\n    );\n\n    // 13.5. Persist sticky bucket\n    if (this._ctx.stickyBucketService && !experiment.disableStickyBucketing) {\n      const {\n        changed,\n        key: attrKey,\n        doc,\n      } = this._generateStickyBucketAssignmentDoc(\n        hashAttribute,\n        toString(hashValue),\n        {\n          [this._getStickyBucketExperimentKey(\n            experiment.key,\n            experiment.bucketVersion\n          )]: result.key,\n        }\n      );\n      if (changed) {\n        // update local docs\n        this._ctx.stickyBucketAssignmentDocs =\n          this._ctx.stickyBucketAssignmentDocs || {};\n        this._ctx.stickyBucketAssignmentDocs[attrKey] = doc;\n        // save doc\n        this._ctx.stickyBucketService.saveAssignments(doc);\n      }\n    }\n\n    // 14. Fire the tracking callback\n    this._track(experiment, result);\n\n    // 14.1 Keep track of completed changeIds\n    \"changeId\" in experiment &&\n      experiment.changeId &&\n      this._completedChangeIds.add(experiment.changeId as string);\n\n    // 15. Return the result\n    process.env.NODE_ENV !== \"production\" &&\n      this.log(\"In experiment\", {\n        id: key,\n        variation: result.variationId,\n      });\n    return result;\n  }\n\n  log(msg: string, ctx: Record<string, unknown>) {\n    if (!this.debug) return;\n    if (this._ctx.log) this._ctx.log(msg, ctx);\n    else console.log(msg, ctx);\n  }\n\n  public getDeferredTrackingCalls(): TrackingData[] {\n    return Array.from(this._deferredTrackingCalls.values());\n  }\n\n  public setDeferredTrackingCalls(calls: TrackingData[]) {\n    this._deferredTrackingCalls = new Map(\n      calls\n        .filter((c) => c && c.experiment && c.result)\n        .map((c) => {\n          return [this._getTrackKey(c.experiment, c.result), c];\n        })\n    );\n  }\n\n  public fireDeferredTrackingCalls() {\n    if (!this._ctx.trackingCallback) return;\n\n    this._deferredTrackingCalls.forEach((call: TrackingData) => {\n      if (!call || !call.experiment || !call.result) {\n        console.error(\"Invalid deferred tracking call\", { call: call });\n      } else {\n        this._track(call.experiment, call.result);\n      }\n    });\n\n    this._deferredTrackingCalls.clear();\n  }\n\n  public setTrackingCallback(callback: TrackingCallback) {\n    this._ctx.trackingCallback = callback;\n    this.fireDeferredTrackingCalls();\n  }\n\n  private _getTrackKey(\n    experiment: Experiment<unknown>,\n    result: Result<unknown>\n  ) {\n    return (\n      result.hashAttribute +\n      result.hashValue +\n      experiment.key +\n      result.variationId\n    );\n  }\n\n  private _track<T>(experiment: Experiment<T>, result: Result<T>) {\n    const k = this._getTrackKey(experiment, result);\n\n    if (!this._ctx.trackingCallback) {\n      // Add to deferred tracking if it hasn't already been added\n      if (!this._deferredTrackingCalls.has(k)) {\n        this._deferredTrackingCalls.set(k, { experiment, result });\n      }\n      return;\n    }\n\n    // Make sure a tracking callback is only fired once per unique experiment\n    if (this._trackedExperiments.has(k)) return;\n    this._trackedExperiments.add(k);\n\n    try {\n      this._ctx.trackingCallback(experiment, result);\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  private _mergeOverrides<T>(experiment: Experiment<T>): Experiment<T> {\n    const key = experiment.key;\n    const o = this._ctx.overrides;\n    if (o && o[key]) {\n      experiment = Object.assign({}, experiment, o[key]);\n      if (typeof experiment.url === \"string\") {\n        experiment.url = getUrlRegExp(\n          // eslint-disable-next-line\n          experiment.url as any\n        );\n      }\n    }\n\n    return experiment;\n  }\n\n  private _getHashAttribute(attr?: string, fallback?: string) {\n    let hashAttribute = attr || \"id\";\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    let hashValue: any = \"\";\n\n    if (this._attributeOverrides[hashAttribute]) {\n      hashValue = this._attributeOverrides[hashAttribute];\n    } else if (this._ctx.attributes) {\n      hashValue = this._ctx.attributes[hashAttribute] || \"\";\n    } else if (this._ctx.user) {\n      hashValue = this._ctx.user[hashAttribute] || \"\";\n    }\n\n    // if no match, try fallback\n    if (!hashValue && fallback) {\n      if (this._attributeOverrides[fallback]) {\n        hashValue = this._attributeOverrides[fallback];\n      } else if (this._ctx.attributes) {\n        hashValue = this._ctx.attributes[fallback] || \"\";\n      } else if (this._ctx.user) {\n        hashValue = this._ctx.user[fallback] || \"\";\n      }\n      if (hashValue) {\n        hashAttribute = fallback;\n      }\n    }\n\n    return { hashAttribute, hashValue };\n  }\n\n  private _getResult<T>(\n    experiment: Experiment<T>,\n    variationIndex: number,\n    hashUsed: boolean,\n    featureId: string | null,\n    bucket?: number,\n    stickyBucketUsed?: boolean\n  ): Result<T> {\n    let inExperiment = true;\n    // If assigned variation is not valid, use the baseline and mark the user as not in the experiment\n    if (variationIndex < 0 || variationIndex >= experiment.variations.length) {\n      variationIndex = 0;\n      inExperiment = false;\n    }\n\n    const { hashAttribute, hashValue } = this._getHashAttribute(\n      experiment.hashAttribute,\n      this._ctx.stickyBucketService && !experiment.disableStickyBucketing\n        ? experiment.fallbackAttribute\n        : undefined\n    );\n\n    const meta: Partial<VariationMeta> = experiment.meta\n      ? experiment.meta[variationIndex]\n      : {};\n\n    const res: Result<T> = {\n      key: meta.key || \"\" + variationIndex,\n      featureId,\n      inExperiment,\n      hashUsed,\n      variationId: variationIndex,\n      value: experiment.variations[variationIndex],\n      hashAttribute,\n      hashValue,\n      stickyBucketUsed: !!stickyBucketUsed,\n    };\n\n    if (meta.name) res.name = meta.name;\n    if (bucket !== undefined) res.bucket = bucket;\n    if (meta.passthrough) res.passthrough = meta.passthrough;\n\n    return res;\n  }\n\n  private _getContextUrl() {\n    return this._ctx.url || (isBrowser ? window.location.href : \"\");\n  }\n\n  private _urlIsValid(urlRegex: RegExp): boolean {\n    const url = this._getContextUrl();\n    if (!url) return false;\n\n    const pathOnly = url.replace(/^https?:\\/\\//, \"\").replace(/^[^/]*\\//, \"/\");\n\n    if (urlRegex.test(url)) return true;\n    if (urlRegex.test(pathOnly)) return true;\n    return false;\n  }\n\n  private _hasGroupOverlap(expGroups: string[]): boolean {\n    const groups = this._ctx.groups || {};\n    for (let i = 0; i < expGroups.length; i++) {\n      if (groups[expGroups[i]]) return true;\n    }\n    return false;\n  }\n\n  private _isAutoExperimentBlockedByContext(\n    experiment: AutoExperiment\n  ): boolean {\n    const changeType = getAutoExperimentChangeType(experiment);\n    if (changeType === \"visual\") {\n      if (this._ctx.disableVisualExperiments) return true;\n\n      if (this._ctx.disableJsInjection) {\n        if (experiment.variations.some((v) => v.js)) {\n          return true;\n        }\n      }\n    } else if (changeType === \"redirect\") {\n      if (this._ctx.disableUrlRedirectExperiments) return true;\n\n      // Validate URLs\n      try {\n        const current = new URL(this._getContextUrl());\n        for (const v of experiment.variations) {\n          if (!v || !v.urlRedirect) continue;\n          const url = new URL(v.urlRedirect);\n\n          // If we're blocking cross origin redirects, block if the protocol or host is different\n          if (this._ctx.disableCrossOriginUrlRedirectExperiments) {\n            if (url.protocol !== current.protocol) return true;\n            if (url.host !== current.host) return true;\n          }\n        }\n      } catch (e) {\n        // Problem parsing one of the URLs\n        this.log(\"Error parsing current or redirect URL\", {\n          id: experiment.key,\n          error: e,\n        });\n        return true;\n      }\n    } else {\n      // Block any unknown changeTypes\n      return true;\n    }\n\n    if (\n      experiment.changeId &&\n      (this._ctx.blockedChangeIds || []).includes(experiment.changeId)\n    ) {\n      return true;\n    }\n\n    return false;\n  }\n\n  public getRedirectUrl(): string {\n    return this._redirectedUrl;\n  }\n\n  private _getNavigateFunction():\n    | null\n    | ((url: string) => void | Promise<void>) {\n    if (this._ctx.navigate) {\n      return this._ctx.navigate;\n    } else if (isBrowser) {\n      return (url: string) => {\n        window.location.replace(url);\n      };\n    }\n    return null;\n  }\n\n  private _setAntiFlicker() {\n    if (!this._ctx.antiFlicker || !isBrowser) return;\n    try {\n      const styleTag = document.createElement(\"style\");\n      styleTag.innerHTML =\n        \".gb-anti-flicker { opacity: 0 !important; pointer-events: none; }\";\n      document.head.appendChild(styleTag);\n      document.documentElement.classList.add(\"gb-anti-flicker\");\n\n      // Fallback if GrowthBook fails to load in specified time or 3.5 seconds\n      setTimeout(() => {\n        document.documentElement.classList.remove(\"gb-anti-flicker\");\n      }, this._ctx.antiFlickerTimeout ?? 3500);\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  private _applyDOMChanges(changes: AutoExperimentVariation) {\n    if (!isBrowser) return;\n    const undo: (() => void)[] = [];\n    if (changes.css) {\n      const s = document.createElement(\"style\");\n      s.innerHTML = changes.css;\n      document.head.appendChild(s);\n      undo.push(() => s.remove());\n    }\n    if (changes.js) {\n      const script = document.createElement(\"script\");\n      script.innerHTML = changes.js;\n      if (this._ctx.jsInjectionNonce) {\n        script.nonce = this._ctx.jsInjectionNonce;\n      }\n      document.head.appendChild(script);\n      undo.push(() => script.remove());\n    }\n    if (changes.domMutations) {\n      changes.domMutations.forEach((mutation) => {\n        undo.push(mutate.declarative(mutation as DeclarativeMutation).revert);\n      });\n    }\n    return () => {\n      undo.forEach((fn) => fn());\n    };\n  }\n\n  private _deriveStickyBucketIdentifierAttributes(data?: FeatureApiResponse) {\n    const attributes = new Set<string>();\n    const features = data && data.features ? data.features : this.getFeatures();\n    const experiments =\n      data && data.experiments ? data.experiments : this.getExperiments();\n    Object.keys(features).forEach((id) => {\n      const feature = features[id];\n      if (feature.rules) {\n        for (const rule of feature.rules) {\n          if (rule.variations) {\n            attributes.add(rule.hashAttribute || \"id\");\n            if (rule.fallbackAttribute) {\n              attributes.add(rule.fallbackAttribute);\n            }\n          }\n        }\n      }\n    });\n    experiments.map((experiment) => {\n      attributes.add(experiment.hashAttribute || \"id\");\n      if (experiment.fallbackAttribute) {\n        attributes.add(experiment.fallbackAttribute);\n      }\n    });\n    return Array.from(attributes);\n  }\n\n  public async refreshStickyBuckets(data?: FeatureApiResponse) {\n    if (this._ctx.stickyBucketService) {\n      const attributes = this._getStickyBucketAttributes(data);\n      this._ctx.stickyBucketAssignmentDocs = await this._ctx.stickyBucketService.getAllAssignments(\n        attributes\n      );\n    }\n  }\n\n  private _getStickyBucketAssignments(\n    expHashAttribute: string,\n    expFallbackAttribute?: string\n  ): StickyAssignments {\n    if (!this._ctx.stickyBucketAssignmentDocs) return {};\n    const { hashAttribute, hashValue } = this._getHashAttribute(\n      expHashAttribute\n    );\n    const hashKey = `${hashAttribute}||${toString(hashValue)}`;\n\n    const {\n      hashAttribute: fallbackAttribute,\n      hashValue: fallbackValue,\n    } = this._getHashAttribute(expFallbackAttribute);\n    const fallbackKey = fallbackValue\n      ? `${fallbackAttribute}||${toString(fallbackValue)}`\n      : null;\n\n    const assignments: StickyAssignments = {};\n    if (fallbackKey && this._ctx.stickyBucketAssignmentDocs[fallbackKey]) {\n      Object.assign(\n        assignments,\n        this._ctx.stickyBucketAssignmentDocs[fallbackKey].assignments || {}\n      );\n    }\n    if (this._ctx.stickyBucketAssignmentDocs[hashKey]) {\n      Object.assign(\n        assignments,\n        this._ctx.stickyBucketAssignmentDocs[hashKey].assignments || {}\n      );\n    }\n    return assignments;\n  }\n\n  private _getStickyBucketVariation({\n    expKey,\n    expBucketVersion,\n    expHashAttribute,\n    expFallbackAttribute,\n    expMinBucketVersion,\n    expMeta,\n  }: {\n    expKey: string;\n    expBucketVersion?: number;\n    expHashAttribute?: string;\n    expFallbackAttribute?: string;\n    expMinBucketVersion?: number;\n    expMeta?: VariationMeta[];\n  }): {\n    variation: number;\n    versionIsBlocked?: boolean;\n  } {\n    expBucketVersion = expBucketVersion || 0;\n    expMinBucketVersion = expMinBucketVersion || 0;\n    expHashAttribute = expHashAttribute || \"id\";\n    expMeta = expMeta || [];\n    const id = this._getStickyBucketExperimentKey(expKey, expBucketVersion);\n    const assignments = this._getStickyBucketAssignments(\n      expHashAttribute,\n      expFallbackAttribute\n    );\n\n    // users with any blocked bucket version (0 to minExperimentBucketVersion) are excluded from the test\n    if (expMinBucketVersion > 0) {\n      for (let i = 0; i <= expMinBucketVersion; i++) {\n        const blockedKey = this._getStickyBucketExperimentKey(expKey, i);\n        if (assignments[blockedKey] !== undefined) {\n          return {\n            variation: -1,\n            versionIsBlocked: true,\n          };\n        }\n      }\n    }\n    const variationKey = assignments[id];\n    if (variationKey === undefined)\n      // no assignment found\n      return { variation: -1 };\n    const variation = expMeta.findIndex((m) => m.key === variationKey);\n    if (variation < 0)\n      // invalid assignment, treat as \"no assignment found\"\n      return { variation: -1 };\n\n    return { variation };\n  }\n\n  private _getStickyBucketExperimentKey(\n    experimentKey: string,\n    experimentBucketVersion?: number\n  ): StickyExperimentKey {\n    experimentBucketVersion = experimentBucketVersion || 0;\n    return `${experimentKey}__${experimentBucketVersion}`;\n  }\n\n  private _getStickyBucketAttributes(\n    data?: FeatureApiResponse\n  ): Record<string, string> {\n    const attributes: Record<string, string> = {};\n    this._ctx.stickyBucketIdentifierAttributes = !this._ctx\n      .stickyBucketIdentifierAttributes\n      ? this._deriveStickyBucketIdentifierAttributes(data)\n      : this._ctx.stickyBucketIdentifierAttributes;\n    this._ctx.stickyBucketIdentifierAttributes.forEach((attr) => {\n      const { hashValue } = this._getHashAttribute(attr);\n      attributes[attr] = toString(hashValue);\n    });\n    return attributes;\n  }\n\n  private _generateStickyBucketAssignmentDoc(\n    attributeName: string,\n    attributeValue: string,\n    assignments: StickyAssignments\n  ): {\n    key: StickyAttributeKey;\n    doc: StickyAssignmentsDocument;\n    changed: boolean;\n  } {\n    const key = `${attributeName}||${attributeValue}`;\n    const existingAssignments =\n      this._ctx.stickyBucketAssignmentDocs &&\n      this._ctx.stickyBucketAssignmentDocs[key]\n        ? this._ctx.stickyBucketAssignmentDocs[key].assignments || {}\n        : {};\n    const newAssignments = { ...existingAssignments, ...assignments };\n    const changed =\n      JSON.stringify(existingAssignments) !== JSON.stringify(newAssignments);\n\n    return {\n      key,\n      doc: {\n        attributeName,\n        attributeValue,\n        assignments: newAssignments,\n      },\n      changed,\n    };\n  }\n}\n\nexport async function prefetchPayload(options: PrefetchOptions) {\n  // Create a temporary instance, just to fetch the payload\n  const instance = new GrowthBook(options);\n\n  await refreshFeatures({\n    instance,\n    skipCache: options.skipCache,\n    allowStale: false,\n    backgroundSync: options.streaming,\n  });\n\n  instance.destroy();\n}\n"],"mappings":"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"}