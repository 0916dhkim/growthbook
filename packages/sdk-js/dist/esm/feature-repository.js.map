{"version":3,"file":"feature-repository.js","names":["getPolyfills","cacheSettings","staleTTL","maxAge","cacheKey","backgroundSync","maxEntries","disableIdleStreams","idleStreamInterval","disableCache","polyfills","helpers","fetchFeaturesCall","host","clientKey","headers","fetch","fetchRemoteEvalCall","payload","options","method","body","JSON","stringify","eventSourceCall","EventSource","startIdleListener","idleTimeout","isBrowser","window","document","onVisibilityChange","visibilityState","clearTimeout","onVisible","setTimeout","onHidden","addEventListener","removeEventListener","stopIdleListener","globalThis","localStorage","e","subscribedInstances","Map","cacheInitialized","cache","activeFetches","streams","supportsSSE","Set","setPolyfills","overrides","Object","assign","configureCache","clearAutoRefresh","clearCache","clear","updatePersistentCache","refreshFeatures","instance","timeout","skipCache","allowStale","fetchFeaturesWithCache","subscribe","key","getKey","subs","get","add","set","unsubscribe","forEach","s","delete","channel","state","disableChannel","enableChannel","setItem","Array","from","entries","getCacheKey","now","Date","minStaleAt","getTime","initializeCache","existing","undefined","staleAt","sse","fetchFeatures","startAutoRefresh","data","success","source","res","promiseTimeout","error","Error","apiHost","getApiInfo","baseKey","isRemoteEval","attributes","getAttributes","cacheKeyAttributes","getCacheKeyAttributes","keys","ca","fv","getForcedVariations","url","getUrl","promise","Promise","resolve","resolved","timer","finish","then","catch","value","getItem","parsed","parse","isArray","cleanupCache","cleanupFn","entriesWithTimestamps","map","sort","a","b","entriesToRemoveCount","Math","min","max","size","i","onNewFeatureData","version","dateUpdated","has","instances","refreshInstance","setPayload","getPayload","apiRequestHeaders","getApiHosts","getClientKey","remoteEval","fetcher","forcedVariations","forcedFeatures","getForcedFeatures","ok","status","json","process","env","NODE_ENV","log","message","forceSSE","streamingHost","streamingHostRequestHeaders","src","cb","event","type","errors","onSSEError","readyState","delay","pow","random","includes","onopen","onerror","close","destroyChannel"],"sources":["../../src/feature-repository.ts"],"sourcesContent":["import {\n  Attributes,\n  CacheSettings,\n  FeatureApiResponse,\n  FetchResponse,\n  Helpers,\n  Polyfills,\n} from \"./types/growthbook\";\nimport { getPolyfills } from \"./util\";\nimport type { GrowthBook } from \".\";\n\ntype CacheEntry = {\n  data: FeatureApiResponse;\n  sse?: boolean;\n  version: string;\n  staleAt: Date;\n};\ntype ScopedChannel = {\n  src: EventSource | null;\n  cb: (event: MessageEvent<string>) => void;\n  host: string;\n  clientKey: string;\n  headers?: Record<string, string>;\n  errors: number;\n  state: \"active\" | \"idle\" | \"disabled\";\n};\n\n// Config settings\nconst cacheSettings: CacheSettings = {\n  // Consider a fetch stale after 1 minute\n  staleTTL: 1000 * 60,\n  // Max time to keep a fetch in cache (24 hours default)\n  maxAge: 1000 * 60 * 60 * 24,\n  cacheKey: \"gbFeaturesCache\",\n  backgroundSync: true,\n  maxEntries: 10,\n  disableIdleStreams: false,\n  idleStreamInterval: 20000,\n  disableCache: false,\n};\n\nconst polyfills = getPolyfills();\n\nexport const helpers: Helpers = {\n  fetchFeaturesCall: ({ host, clientKey, headers }) => {\n    return (polyfills.fetch as typeof globalThis.fetch)(\n      `${host}/api/features/${clientKey}`,\n      { headers }\n    );\n  },\n  fetchRemoteEvalCall: ({ host, clientKey, payload, headers }) => {\n    const options = {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\", ...headers },\n      body: JSON.stringify(payload),\n    };\n    return (polyfills.fetch as typeof globalThis.fetch)(\n      `${host}/api/eval/${clientKey}`,\n      options\n    );\n  },\n  eventSourceCall: ({ host, clientKey, headers }) => {\n    if (headers) {\n      return new polyfills.EventSource(`${host}/sub/${clientKey}`, {\n        headers,\n      });\n    }\n    return new polyfills.EventSource(`${host}/sub/${clientKey}`);\n  },\n  startIdleListener: () => {\n    let idleTimeout: number | undefined;\n    const isBrowser =\n      typeof window !== \"undefined\" && typeof document !== \"undefined\";\n    if (!isBrowser) return;\n    const onVisibilityChange = () => {\n      if (document.visibilityState === \"visible\") {\n        window.clearTimeout(idleTimeout);\n        onVisible();\n      } else if (document.visibilityState === \"hidden\") {\n        idleTimeout = window.setTimeout(\n          onHidden,\n          cacheSettings.idleStreamInterval\n        );\n      }\n    };\n    document.addEventListener(\"visibilitychange\", onVisibilityChange);\n    return () =>\n      document.removeEventListener(\"visibilitychange\", onVisibilityChange);\n  },\n  stopIdleListener: () => {\n    // No-op, replaced by startIdleListener\n  },\n};\n\ntry {\n  if (globalThis.localStorage) {\n    polyfills.localStorage = globalThis.localStorage;\n  }\n} catch (e) {\n  // Ignore localStorage errors\n}\n\n// Global state\nconst subscribedInstances: Map<string, Set<GrowthBook>> = new Map();\nlet cacheInitialized = false;\nconst cache: Map<string, CacheEntry> = new Map();\nconst activeFetches: Map<string, Promise<FetchResponse>> = new Map();\nconst streams: Map<string, ScopedChannel> = new Map();\nconst supportsSSE: Set<string> = new Set();\n\n// Public functions\nexport function setPolyfills(overrides: Partial<Polyfills>): void {\n  Object.assign(polyfills, overrides);\n}\nexport function configureCache(overrides: Partial<CacheSettings>): void {\n  Object.assign(cacheSettings, overrides);\n  if (!cacheSettings.backgroundSync) {\n    clearAutoRefresh();\n  }\n}\n\nexport async function clearCache(): Promise<void> {\n  cache.clear();\n  activeFetches.clear();\n  clearAutoRefresh();\n  cacheInitialized = false;\n  await updatePersistentCache();\n}\n\n// Get or fetch features and refresh the SDK instance\nexport async function refreshFeatures({\n  instance,\n  timeout,\n  skipCache,\n  allowStale,\n  backgroundSync,\n}: {\n  instance: GrowthBook;\n  timeout?: number;\n  skipCache?: boolean;\n  allowStale?: boolean;\n  backgroundSync?: boolean;\n}): Promise<FetchResponse> {\n  if (!backgroundSync) {\n    cacheSettings.backgroundSync = false;\n  }\n\n  return fetchFeaturesWithCache({\n    instance,\n    allowStale,\n    timeout,\n    skipCache,\n  });\n}\n\n// Subscribe a GrowthBook instance to feature changes\nexport function subscribe(instance: GrowthBook): void {\n  const key = getKey(instance);\n  const subs = subscribedInstances.get(key) || new Set();\n  subs.add(instance);\n  subscribedInstances.set(key, subs);\n}\nexport function unsubscribe(instance: GrowthBook): void {\n  subscribedInstances.forEach((s) => s.delete(instance));\n}\n\nexport function onHidden() {\n  streams.forEach((channel) => {\n    if (!channel) return;\n    channel.state = \"idle\";\n    disableChannel(channel);\n  });\n}\n\nexport function onVisible() {\n  streams.forEach((channel) => {\n    if (!channel) return;\n    if (channel.state !== \"idle\") return;\n    enableChannel(channel);\n  });\n}\n\n// Private functions\n\nasync function updatePersistentCache() {\n  try {\n    if (!polyfills.localStorage) return;\n    await polyfills.localStorage.setItem(\n      cacheSettings.cacheKey,\n      JSON.stringify(Array.from(cache.entries()))\n    );\n  } catch (e) {\n    // Ignore localStorage errors\n  }\n}\n\n// SWR wrapper for fetching features. May indirectly or directly start SSE streaming.\nasync function fetchFeaturesWithCache({\n  instance,\n  allowStale,\n  timeout,\n  skipCache,\n}: {\n  instance: GrowthBook;\n  allowStale?: boolean;\n  timeout?: number;\n  skipCache?: boolean;\n}): Promise<FetchResponse> {\n  const key = getKey(instance);\n  const cacheKey = getCacheKey(instance);\n  const now = new Date();\n\n  const minStaleAt = new Date(\n    now.getTime() - cacheSettings.maxAge + cacheSettings.staleTTL\n  );\n\n  await initializeCache();\n  const existing =\n    !cacheSettings.disableCache && !skipCache ? cache.get(cacheKey) : undefined;\n  if (\n    existing &&\n    (allowStale || existing.staleAt > now) &&\n    existing.staleAt > minStaleAt\n  ) {\n    // Restore from cache whether SSE is supported\n    if (existing.sse) supportsSSE.add(key);\n\n    // Reload features in the background if stale\n    if (existing.staleAt < now) {\n      fetchFeatures(instance);\n    }\n    // Otherwise, if we don't need to refresh now, start a background sync\n    else {\n      startAutoRefresh(instance);\n    }\n    return { data: existing.data, success: true, source: \"cache\" };\n  } else {\n    const res = await promiseTimeout(fetchFeatures(instance), timeout);\n    return (\n      res || {\n        data: null,\n        success: false,\n        source: \"timeout\",\n        error: new Error(\"Timeout\"),\n      }\n    );\n  }\n}\n\nfunction getKey(instance: GrowthBook): string {\n  const [apiHost, clientKey] = instance.getApiInfo();\n  return `${apiHost}||${clientKey}`;\n}\n\nfunction getCacheKey(instance: GrowthBook): string {\n  const baseKey = getKey(instance);\n  if (!instance.isRemoteEval()) return baseKey;\n\n  const attributes = instance.getAttributes();\n  const cacheKeyAttributes =\n    instance.getCacheKeyAttributes() || Object.keys(instance.getAttributes());\n  const ca: Attributes = {};\n  cacheKeyAttributes.forEach((key) => {\n    ca[key] = attributes[key];\n  });\n\n  const fv = instance.getForcedVariations();\n  const url = instance.getUrl();\n\n  return `${baseKey}||${JSON.stringify({\n    ca,\n    fv,\n    url,\n  })}`;\n}\n\n// Guarantee the promise always resolves within {timeout} ms\n// Resolved value will be `null` when there's an error or it takes too long\n// Note: The promise will continue running in the background, even if the timeout is hit\nfunction promiseTimeout<T>(\n  promise: Promise<T>,\n  timeout?: number\n): Promise<T | null> {\n  return new Promise((resolve) => {\n    let resolved = false;\n    let timer: NodeJS.Timeout | undefined;\n    const finish = (data?: T) => {\n      if (resolved) return;\n      resolved = true;\n      timer && clearTimeout(timer);\n      resolve(data || null);\n    };\n\n    if (timeout) {\n      timer = setTimeout(() => finish(), timeout);\n    }\n\n    promise.then((data) => finish(data)).catch(() => finish());\n  });\n}\n\n// Populate cache from localStorage (if available)\nasync function initializeCache(): Promise<void> {\n  if (cacheInitialized) return;\n  cacheInitialized = true;\n  try {\n    if (polyfills.localStorage) {\n      const value = await polyfills.localStorage.getItem(\n        cacheSettings.cacheKey\n      );\n      if (!cacheSettings.disableCache && value) {\n        const parsed: [string, CacheEntry][] = JSON.parse(value);\n        if (parsed && Array.isArray(parsed)) {\n          parsed.forEach(([key, data]) => {\n            cache.set(key, {\n              ...data,\n              staleAt: new Date(data.staleAt),\n            });\n          });\n        }\n        cleanupCache();\n      }\n    }\n  } catch (e) {\n    // Ignore localStorage errors\n  }\n  if (!cacheSettings.disableIdleStreams) {\n    const cleanupFn = helpers.startIdleListener();\n    if (cleanupFn) {\n      helpers.stopIdleListener = cleanupFn;\n    }\n  }\n}\n\n// Enforce the maxEntries limit\nfunction cleanupCache() {\n  const entriesWithTimestamps = Array.from(cache.entries())\n    .map(([key, value]) => ({\n      key,\n      staleAt: value.staleAt.getTime(),\n    }))\n    .sort((a, b) => a.staleAt - b.staleAt);\n\n  const entriesToRemoveCount = Math.min(\n    Math.max(0, cache.size - cacheSettings.maxEntries),\n    cache.size\n  );\n\n  for (let i = 0; i < entriesToRemoveCount; i++) {\n    cache.delete(entriesWithTimestamps[i].key);\n  }\n}\n\n// Called whenever new features are fetched from the API\nfunction onNewFeatureData(\n  key: string,\n  cacheKey: string,\n  data: FeatureApiResponse\n): void {\n  // If contents haven't changed, ignore the update, extend the stale TTL\n  const version = data.dateUpdated || \"\";\n  const staleAt = new Date(Date.now() + cacheSettings.staleTTL);\n  const existing = !cacheSettings.disableCache\n    ? cache.get(cacheKey)\n    : undefined;\n  if (existing && version && existing.version === version) {\n    existing.staleAt = staleAt;\n    updatePersistentCache();\n    return;\n  }\n\n  if (!cacheSettings.disableCache) {\n    // Update in-memory cache\n    cache.set(cacheKey, {\n      data,\n      version,\n      staleAt,\n      sse: supportsSSE.has(key),\n    });\n    cleanupCache();\n  }\n  // Update local storage (don't await this, just update asynchronously)\n  updatePersistentCache();\n\n  // Update features for all subscribed GrowthBook instances\n  const instances = subscribedInstances.get(key);\n  instances && instances.forEach((instance) => refreshInstance(instance, data));\n}\n\nasync function refreshInstance(\n  instance: GrowthBook,\n  data: FeatureApiResponse | null\n): Promise<void> {\n  await instance.setPayload(data || instance.getPayload());\n}\n\n// Fetch the features payload from helper function or from in-mem injected payload\nasync function fetchFeatures(instance: GrowthBook): Promise<FetchResponse> {\n  const { apiHost, apiRequestHeaders } = instance.getApiHosts();\n  const clientKey = instance.getClientKey();\n  const remoteEval = instance.isRemoteEval();\n  const key = getKey(instance);\n  const cacheKey = getCacheKey(instance);\n\n  let promise = activeFetches.get(cacheKey);\n  if (!promise) {\n    const fetcher: Promise<Response> = remoteEval\n      ? helpers.fetchRemoteEvalCall({\n          host: apiHost,\n          clientKey,\n          payload: {\n            attributes: instance.getAttributes(),\n            forcedVariations: instance.getForcedVariations(),\n            forcedFeatures: Array.from(instance.getForcedFeatures().entries()),\n            url: instance.getUrl(),\n          },\n          headers: apiRequestHeaders,\n        })\n      : helpers.fetchFeaturesCall({\n          host: apiHost,\n          clientKey,\n          headers: apiRequestHeaders,\n        });\n\n    // TODO: auto-retry if status code indicates a temporary error\n    promise = fetcher\n      .then((res) => {\n        if (!res.ok) {\n          throw new Error(`HTTP error: ${res.status}`);\n        }\n        if (res.headers.get(\"x-sse-support\") === \"enabled\") {\n          supportsSSE.add(key);\n        }\n        return res.json();\n      })\n      .then((data: FeatureApiResponse) => {\n        onNewFeatureData(key, cacheKey, data);\n        startAutoRefresh(instance);\n        activeFetches.delete(cacheKey);\n        return { data, success: true, source: \"network\" as const };\n      })\n      .catch((e) => {\n        process.env.NODE_ENV !== \"production\" &&\n          instance.log(\"Error fetching features\", {\n            apiHost,\n            clientKey,\n            error: e ? e.message : null,\n          });\n        activeFetches.delete(cacheKey);\n\n        return {\n          data: null,\n          source: \"error\" as const,\n          success: false,\n          error: e,\n        };\n      });\n    activeFetches.set(cacheKey, promise);\n  }\n  return promise;\n}\n\n// Start SSE streaming, listens to feature payload changes and triggers a refresh or re-fetch\nexport function startAutoRefresh(\n  instance: GrowthBook,\n  forceSSE: boolean = false\n): void {\n  const key = getKey(instance);\n  const cacheKey = getCacheKey(instance);\n  const { streamingHost, streamingHostRequestHeaders } = instance.getApiHosts();\n  const clientKey = instance.getClientKey();\n\n  if (forceSSE) {\n    supportsSSE.add(key);\n  }\n\n  if (\n    cacheSettings.backgroundSync &&\n    supportsSSE.has(key) &&\n    polyfills.EventSource\n  ) {\n    if (streams.has(key)) return;\n    const channel: ScopedChannel = {\n      src: null,\n      host: streamingHost,\n      clientKey,\n      headers: streamingHostRequestHeaders,\n      cb: (event: MessageEvent<string>) => {\n        try {\n          if (event.type === \"features-updated\") {\n            const instances = subscribedInstances.get(key);\n            instances &&\n              instances.forEach((instance) => {\n                fetchFeatures(instance);\n              });\n          } else if (event.type === \"features\") {\n            const json: FeatureApiResponse = JSON.parse(event.data);\n            onNewFeatureData(key, cacheKey, json);\n          }\n          // Reset error count on success\n          channel.errors = 0;\n        } catch (e) {\n          process.env.NODE_ENV !== \"production\" &&\n            instance.log(\"SSE Error\", {\n              streamingHost,\n              clientKey,\n              error: e ? (e as Error).message : null,\n            });\n          onSSEError(channel);\n        }\n      },\n      errors: 0,\n      state: \"active\",\n    };\n    streams.set(key, channel);\n    enableChannel(channel);\n  }\n}\n\nfunction onSSEError(channel: ScopedChannel) {\n  if (channel.state === \"idle\") return;\n  channel.errors++;\n  if (channel.errors > 3 || (channel.src && channel.src.readyState === 2)) {\n    // exponential backoff after 4 errors, with jitter\n    const delay =\n      Math.pow(3, channel.errors - 3) * (1000 + Math.random() * 1000);\n    disableChannel(channel);\n    setTimeout(() => {\n      if ([\"idle\", \"active\"].includes(channel.state)) return;\n      enableChannel(channel);\n    }, Math.min(delay, 300000)); // 5 minutes max\n  }\n}\n\nfunction disableChannel(channel: ScopedChannel) {\n  if (!channel.src) return;\n  channel.src.onopen = null;\n  channel.src.onerror = null;\n  channel.src.close();\n  channel.src = null;\n  if (channel.state === \"active\") {\n    channel.state = \"disabled\";\n  }\n}\n\nfunction enableChannel(channel: ScopedChannel) {\n  channel.src = helpers.eventSourceCall({\n    host: channel.host,\n    clientKey: channel.clientKey,\n    headers: channel.headers,\n  }) as EventSource;\n  channel.state = \"active\";\n  channel.src.addEventListener(\"features\", channel.cb);\n  channel.src.addEventListener(\"features-updated\", channel.cb);\n  channel.src.onerror = () => onSSEError(channel);\n  channel.src.onopen = () => {\n    channel.errors = 0;\n  };\n}\n\nfunction destroyChannel(channel: ScopedChannel, key: string) {\n  disableChannel(channel);\n  streams.delete(key);\n}\n\nfunction clearAutoRefresh() {\n  // Clear list of which keys are auto-updated\n  supportsSSE.clear();\n\n  // Stop listening for any SSE events\n  streams.forEach(destroyChannel);\n\n  // Remove all references to GrowthBook instances\n  subscribedInstances.clear();\n\n  // Run the idle stream cleanup function\n  helpers.stopIdleListener();\n}\n"],"mappings":"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"}